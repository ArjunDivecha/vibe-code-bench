<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Typing Speed Test</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;500;700&family=Poppins:wght@400;600&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background: #f0f4f8;
            font-family: 'Poppins', sans-serif;
            color: #333;
        }

        .container {
            width: 800px;
            max-width: 95%;
            background: #fff;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.05);
        }

        header {
            text-align: center;
            margin-bottom: 2rem;
        }

        h1 {
            font-size: 2rem;
            color: #2c3e50;
            margin-bottom: 0.5rem;
        }

        .stats-bar {
            display: flex;
            justify-content: space-between;
            background: #f8f9fa;
            padding: 1rem 1.5rem;
            border-radius: 8px;
            border: 1px solid #e9ecef;
            margin-bottom: 1.5rem;
        }

        .stat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .stat-label {
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #7f8c8d;
            margin-bottom: 0.2rem;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #2c3e50;
            font-family: 'Roboto Mono', monospace;
        }

        .typing-area {
            position: relative;
        }

        .quote-display {
            font-family: 'Roboto Mono', monospace;
            font-size: 1.3rem;
            line-height: 1.8;
            color: #95a5a6;
            margin-bottom: 1.5rem;
            background: #fff;
            min-height: 150px;
            user-select: none;
            word-break: break-word;
        }

        /* Character States */
        .quote-display span.correct {
            color: #27ae60;
        }

        .quote-display span.incorrect {
            color: #e74c3c;
            background-color: #fadbd8;
            border-radius: 2px;
        }

        .quote-display span.active {
            color: #2c3e50;
            background-color: #d6eaf8;
            border-bottom: 2px solid #3498db;
        }

        .input-field {
            width: 100%;
            height: 60px; /* Reduced height as focus is on display */
            padding: 10px 15px;
            font-family: 'Roboto Mono', monospace;
            font-size: 1.1rem;
            border: 2px solid #dfe6e9;
            border-radius: 8px;
            outline: none;
            transition: border-color 0.3s;
            resize: none;
            color: #2c3e50;
        }

        .input-field:focus {
            border-color: #3498db;
        }

        .controls {
            display: flex;
            justify-content: center;
            margin-top: 2rem;
        }

        button.restart-btn {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 12px 30px;
            font-size: 1rem;
            font-weight: 600;
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.2s, transform 0.1s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        button.restart-btn:hover {
            background-color: #2980b9;
        }

        button.restart-btn:active {
            transform: scale(0.98);
        }

        /* Result Modal/Overlay */
        .result-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
            z-index: 100;
        }

        .result-overlay.show {
            opacity: 1;
            pointer-events: auto;
        }

        .result-box {
            background: white;
            padding: 2.5rem;
            border-radius: 12px;
            text-align: center;
            width: 400px;
            transform: translateY(20px);
            transition: transform 0.3s;
        }

        .result-overlay.show .result-box {
            transform: translateY(0);
        }

        .result-title {
            font-size: 1.8rem;
            margin-bottom: 1.5rem;
            color: #2c3e50;
        }

        .result-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .result-item h3 {
            font-size: 0.9rem;
            color: #7f8c8d;
            margin-bottom: 0.5rem;
        }

        .result-item p {
            font-size: 2rem;
            font-weight: 700;
            color: #2c3e50;
        }

        .hidden {
            display: none;
        }

        @media (max-width: 600px) {
            .stats-bar {
                flex-wrap: wrap;
                gap: 1rem;
            }
            .stat-item {
                flex: 1 1 40%;
            }
        }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>Typing Speed Test</h1>
        <p>Type the text below as accurately and quickly as possible.</p>
    </header>

    <div class="stats-bar">
        <div class="stat-item">
            <span class="stat-label">Time Left</span>
            <span class="stat-value" id="timer">60s</span>
        </div>
        <div class="stat-item">
            <span class="stat-label">WPM</span>
            <span class="stat-value" id="wpm">0</span>
        </div>
        <div class="stat-item">
            <span class="stat-label">CPM</span>
            <span class="stat-value" id="cpm">0</span>
        </div>
        <div class="stat-item">
            <span class="stat-label">Accuracy</span>
            <span class="stat-value" id="accuracy">100%</span>
        </div>
    </div>

    <div class="typing-area">
        <div class="quote-display" id="quote-display">
            <!-- Text will be injected here -->
        </div>
        <textarea class="input-field" id="input-field" placeholder="Start typing here..." spellcheck="false"></textarea>
    </div>

    <div class="controls">
        <button class="restart-btn" onclick="resetTest()">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2.5 2v6h6"></path><path d="M21.5 22v-6h-6"></path><path d="M22 11.5A10 10 0 0 0 3.2 7.2M2 12.5a10 10 0 0 0 18.8 4.2"></path></svg>
            Try Another Text
        </button>
    </div>
</div>

<!-- Result Modal -->
<div class="result-overlay" id="result-overlay">
    <div class="result-box">
        <h2 class="result-title">Test Completed!</h2>
        <div class="result-grid">
            <div class="result-item">
                <h3>WPM</h3>
                <p id="final-wpm">0</p>
            </div>
            <div class="result-item">
                <h3>Accuracy</h3>
                <p id="final-accuracy">0%</p>
            </div>
            <div class="result-item">
                <h3>CPM</h3>
                <p id="final-cpm">0</p>
            </div>
            <div class="result-item">
                <h3>Mistakes</h3>
                <p id="final-mistakes">0</p>
            </div>
        </div>
        <button class="restart-btn" style="width: 100%; justify-content: center;" onclick="closeResultAndReset()">Try Again</button>
    </div>
</div>

<script>
    const paragraphs = [
        "The quick brown fox jumps over the lazy dog. This pangram contains every letter of the English alphabet at least once. It is commonly used for touch-typing practice.",
        "To be, or not to be, that is the question: Whether 'tis nobler in the mind to suffer The slings and arrows of outrageous fortune, Or to take arms against a sea of troubles And by opposing end them.",
        "In the beginning God created the heaven and the earth. And the earth was without form, and void; and darkness was upon the face of the deep. And the Spirit of God moved upon the face of the waters.",
        "It was the best of times, it was the worst of times, it was the age of wisdom, it was the age of foolishness, it was the epoch of belief, it was the epoch of incredulity, it was the season of Light, it was the season of Darkness.",
        "Success is not final, failure is not fatal: it is the courage to continue that counts. Winston Churchill spoke these words to inspire resilience in the face of adversity.",
        "Technology is best when it brings people together. It allows us to connect with friends and family across the globe, share ideas instantly, and collaborate on projects that change the world.",
        "The only way to do great work is to love what you do. If you haven't found it yet, keep looking. Don't settle. As with all matters of the heart, you'll know when you find it.",
        "Life is what happens when you're busy making other plans. We often spend so much time worrying about the future that we forget to enjoy the present moment.",
        "A journey of a thousand miles begins with a single step. Do not be overwhelmed by the size of your goal, but focus on the immediate action you can take to move forward.",
        "Programming is the art of telling another human what one wants the computer to do. It requires logic, creativity, and a lot of patience to debug complex problems."
    ];

    const quoteDisplay = document.getElementById('quote-display');
    const inputField = document.getElementById('input-field');
    const timerTag = document.getElementById('timer');
    const wpmTag = document.getElementById('wpm');
    const cpmTag = document.getElementById('cpm');
    const accuracyTag = document.getElementById('accuracy');
    const resultOverlay = document.getElementById('result-overlay');
    
    // Final Stats Elements
    const finalWpm = document.getElementById('final-wpm');
    const finalAccuracy = document.getElementById('final-accuracy');
    const finalCpm = document.getElementById('final-cpm');
    const finalMistakes = document.getElementById('final-mistakes');

    let timeLeft = 60;
    let timeElapsed = 0;
    let timer = null;
    let isTyping = false;
    let charIndex = 0;
    let mistakes = 0;
    let currentQuote = "";

    function loadParagraph() {
        const randIndex = Math.floor(Math.random() * paragraphs.length);
        currentQuote = paragraphs[randIndex];
        quoteDisplay.innerHTML = "";
        
        // Split characters and wrap in spans
        currentQuote.split("").forEach(char => {
            let span = `<span>${char}</span>`;
            quoteDisplay.innerHTML += span;
        });
        
        // Highlight first character
        quoteDisplay.querySelectorAll("span")[0].classList.add("active");
        
        // Focus input
        document.addEventListener('keydown', () => inputField.focus());
        quoteDisplay.addEventListener('click', () => inputField.focus());
    }

    function initTyping() {
        const characters = quoteDisplay.querySelectorAll("span");
        let typedChar = inputField.value.split("")[charIndex];

        // Start timer on first input
        if (!isTyping) {
            timer = setInterval(initTimer, 1000);
            isTyping = true;
        }

        // Handling backspace or deletion
        if (typedChar == null) { 
            if (charIndex > 0) {
                charIndex--;
                if (characters[charIndex].classList.contains("incorrect")) {
                    mistakes--;
                }
                characters[charIndex].classList.remove("correct", "incorrect");
                characters[charIndex].classList.add("active");
                
                if (characters[charIndex + 1]) {
                    characters[charIndex + 1].classList.remove("active");
                }
            }
            return;
        }

        // Logic for typing forward
        if (characters[charIndex]) {
            characters[charIndex].classList.remove("active");
            
            if (characters[charIndex].innerText === typedChar) {
                characters[charIndex].classList.add("correct");
            } else {
                mistakes++;
                characters[charIndex].classList.add("incorrect");
            }
            
            charIndex++;
            
            if (charIndex < characters.length) {
                characters[charIndex].classList.add("active");
            } else {
                // End of text reached
                clearInterval(timer);
                inputField.value = ""; // Clear for looks, though disabled
                finishTest();
            }
        }

        // Live Stats Update
        // CPM: Characters Typed / Time (min)
        // WPM: (Characters Typed / 5) / Time (min)
        // Accuracy: (Total Typed - Mistakes) / Total Typed * 100
        
        // Avoid division by zero for stats
        let currentTimer = (60 - timeLeft) > 0 ? (60 - timeLeft) : 1; 
        
        let wpm = Math.round(((charIndex - mistakes) / 5) / (currentTimer / 60));
        wpm = wpm < 0 || !wpm || wpm === Infinity ? 0 : wpm;
        
        let accuracy = Math.round(((charIndex - mistakes) / charIndex) * 100);
        accuracy = accuracy < 0 || !accuracy || accuracy === Infinity ? 100 : accuracy;

        wpmTag.innerText = wpm;
        cpmTag.innerText = charIndex - mistakes; // Net characters
        accuracyTag.innerText = accuracy + "%";
    }

    function initTimer() {
        if (timeLeft > 0) {
            timeLeft--;
            timeElapsed++;
            timerTag.innerText = timeLeft + "s";
            
            // Update WPM periodically based on elapsed time
            let wpm = Math.round(((charIndex - mistakes) / 5) / (timeElapsed / 60));
            wpm = wpm < 0 || !wpm || wpm === Infinity ? 0 : wpm;
            wpmTag.innerText = wpm;
        } else {
            clearInterval(timer);
            finishTest();
        }
    }

    function finishTest() {
        inputField.disabled = true;
        
        let wpm = Math.round(((charIndex - mistakes) / 5) / (timeElapsed / 60));
        wpm = wpm < 0 || !wpm || wpm === Infinity ? 0 : wpm;

        let accuracy = Math.round(((charIndex - mistakes) / charIndex) * 100);
        accuracy = accuracy < 0 || !accuracy || accuracy === Infinity ? 0 : accuracy; // 0 if they typed nothing

        finalWpm.innerText = wpm;
        finalAccuracy.innerText = accuracy + "%";
        finalCpm.innerText = charIndex;
        finalMistakes.innerText = mistakes;

        resultOverlay.classList.add("show");
    }

    function resetTest() {
        loadParagraph();
        clearInterval(timer);
        timeLeft = 60;
        timeElapsed = 0;
        charIndex = 0;
        mistakes = 0;
        isTyping = false;
        inputField.value = "";
        inputField.disabled = false;
        
        timerTag.innerText = "60s";
        wpmTag.innerText = 0;
        cpmTag.innerText = 0;
        accuracyTag.innerText = "100%";
        
        resultOverlay.classList.remove("show");
        inputField.focus();
    }
    
    function closeResultAndReset() {
        resetTest();
    }

    inputField.addEventListener("input", initTyping);
    
    // Initialize on load
    loadParagraph();
</script>

</body>
</html>