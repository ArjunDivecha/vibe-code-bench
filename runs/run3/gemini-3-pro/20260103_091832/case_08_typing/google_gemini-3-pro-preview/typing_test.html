<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Typing Speed Test</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;500;700&family=Poppins:wght@400;600&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background: #f0f4f8;
            font-family: 'Poppins', sans-serif;
            color: #333;
        }

        .container {
            width: 800px;
            padding: 30px;
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }

        h1 {
            text-align: center;
            margin-bottom: 25px;
            font-size: 2rem;
            color: #2c3e50;
        }

        .stats-bar {
            display: flex;
            justify-content: space-between;
            margin-bottom: 25px;
            padding: 15px 25px;
            background: #eef2f5;
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }

        .stat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .stat-label {
            font-size: 0.85rem;
            color: #7f8c8d;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #2c3e50;
        }

        .typing-text-display {
            font-family: 'Roboto Mono', monospace;
            font-size: 1.3rem;
            line-height: 1.8;
            letter-spacing: 0.5px;
            background: #fff;
            border: 1px solid #ccc;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 25px;
            height: 250px;
            overflow-y: auto;
            color: #95a5a6;
            user-select: none;
        }

        .typing-text-display span {
            position: relative;
        }

        .typing-text-display span.correct {
            color: #27ae60;
        }

        .typing-text-display span.incorrect {
            color: #e74c3c;
            background: #fadbd8;
            border-radius: 2px;
        }

        .typing-text-display span.active {
            color: #2c3e50;
        }

        .typing-text-display span.active::before {
            content: "";
            position: absolute;
            left: 0;
            bottom: 0;
            height: 2px;
            width: 100%;
            background: #3498db;
            animation: blink 1s infinite;
        }

        @keyframes blink {
            50% { opacity: 0; }
        }

        .input-area {
            position: relative;
        }

        .input-field {
            width: 100%;
            height: 60px;
            padding: 15px;
            font-family: 'Roboto Mono', monospace;
            font-size: 1.1rem;
            border: 2px solid #ddd;
            border-radius: 8px;
            outline: none;
            transition: border-color 0.3s;
            resize: none;
        }

        .input-field:focus {
            border-color: #3498db;
        }

        .controls {
            display: flex;
            justify-content: center;
            margin-top: 25px;
        }

        button {
            padding: 12px 30px;
            font-size: 1rem;
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
            color: #fff;
            background: #3498db;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.3s, transform 0.1s;
        }

        button:hover {
            background: #2980b9;
        }

        button:active {
            transform: scale(0.98);
        }

        /* Results Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
            z-index: 100;
        }

        .modal-overlay.show {
            opacity: 1;
            pointer-events: auto;
        }

        .result-box {
            background: #fff;
            padding: 40px;
            border-radius: 12px;
            text-align: center;
            width: 400px;
            transform: translateY(-20px);
            transition: transform 0.3s;
        }

        .modal-overlay.show .result-box {
            transform: translateY(0);
        }

        .result-title {
            font-size: 1.8rem;
            margin-bottom: 20px;
            color: #2c3e50;
        }

        .result-details {
            margin-bottom: 30px;
        }

        .result-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .result-value {
            font-weight: 700;
            color: #3498db;
        }

        /* Mobile Responsive */
        @media (max-width: 850px) {
            .container {
                width: 95%;
                padding: 20px;
            }
            .typing-text-display {
                font-size: 1.1rem;
            }
        }
    </style>
</head>
<body>

<div class="container">
    <h1>Typing Speed Test</h1>
    
    <div class="stats-bar">
        <div class="stat-item">
            <span class="stat-label">Time Left</span>
            <span class="stat-value" id="timer">30s</span>
        </div>
        <div class="stat-item">
            <span class="stat-label">Mistakes</span>
            <span class="stat-value" id="mistakes">0</span>
        </div>
        <div class="stat-item">
            <span class="stat-label">WPM</span>
            <span class="stat-value" id="wpm">0</span>
        </div>
        <div class="stat-item">
            <span class="stat-label">Accuracy</span>
            <span class="stat-value" id="cpm">100%</span>
        </div>
    </div>

    <div class="typing-text-display" id="text-display">
        <!-- Text will be injected here -->
    </div>

    <div class="input-area">
        <textarea class="input-field" id="input-field" placeholder="Start typing here..."></textarea>
    </div>

    <div class="controls">
        <button id="restart-btn">Try Another Text</button>
    </div>
</div>

<div class="modal-overlay" id="result-modal">
    <div class="result-box">
        <div class="result-title">Test Complete!</div>
        <div class="result-details">
            <div class="result-row">
                <span>Words Per Minute:</span>
                <span class="result-value" id="final-wpm">0</span>
            </div>
            <div class="result-row">
                <span>Accuracy:</span>
                <span class="result-value" id="final-accuracy">0%</span>
            </div>
            <div class="result-row">
                <span>Mistakes:</span>
                <span class="result-value" id="final-mistakes">0</span>
            </div>
        </div>
        <button onclick="resetGame()">Try Again</button>
    </div>
</div>

<script>
    const paragraphs = [
        "The quick brown fox jumps over the lazy dog. This is a classic pangram that contains every letter of the English alphabet. Typing speed tests often use it to evaluate keyboarding skills efficiently.",
        "Technology is rapidly changing the way we live and work. Artificial intelligence, blockchain, and cloud computing are just a few examples of innovations that are reshaping industries across the globe.",
        "A journey of a thousand miles begins with a single step. It is important to stay consistent and persistent when pursuing your goals, no matter how difficult the path may seem at the beginning.",
        "Music has a unique ability to evoke emotions and memories. Whether it is a fast-paced rock song or a soothing classical melody, the power of sound can influence our mood in significant ways.",
        "Nature offers a sanctuary from the hustle and bustle of modern life. Walking through a forest or sitting by the ocean can provide a sense of peace and clarity that is hard to find in a city.",
        "Reading is a gateway to other worlds. Through books, we can travel to distant lands, meet fascinating characters, and explore complex ideas without ever leaving the comfort of our homes.",
        "Cooking is both an art and a science. Understanding the chemical reactions that occur during heating and mixing can help you create delicious meals that delight the senses.",
        "Effective communication is the cornerstone of strong relationships. Listening actively and expressing yourself clearly can prevent misunderstandings and build trust with others.",
        "Space exploration has always captured the human imagination. The idea of traveling to Mars or discovering life on other planets drives scientists and engineers to push the boundaries of technology.",
        "History teaches us valuable lessons about the past. By studying the events and decisions of those who came before us, we can make better choices for our future and society."
    ];

    const textDisplay = document.getElementById("text-display");
    const inputField = document.getElementById("input-field");
    const timerTag = document.getElementById("timer");
    const mistakeTag = document.getElementById("mistakes");
    const wpmTag = document.getElementById("wpm");
    const accuracyTag = document.getElementById("cpm");
    const restartBtn = document.getElementById("restart-btn");
    const resultModal = document.getElementById("result-modal");
    
    // Final stats elements
    const finalWpm = document.getElementById("final-wpm");
    const finalAccuracy = document.getElementById("final-accuracy");
    const finalMistakes = document.getElementById("final-mistakes");

    let timer;
    let maxTime = 30;
    let timeLeft = maxTime;
    let charIndex = 0;
    let mistakes = 0;
    let isTyping = false;

    function loadParagraph() {
        const randIndex = Math.floor(Math.random() * paragraphs.length);
        textDisplay.innerHTML = "";
        // Split characters and wrap in spans
        paragraphs[randIndex].split("").forEach(char => {
            let span = `<span>${char}</span>`;
            textDisplay.innerHTML += span;
        });
        textDisplay.querySelectorAll("span")[0].classList.add("active");
        
        // Focus input so user can start immediately
        document.addEventListener("keydown", () => inputField.focus());
        textDisplay.addEventListener("click", () => inputField.focus());
    }

    function initTyping() {
        let characters = textDisplay.querySelectorAll("span");
        let typedChar = inputField.value.split("")[charIndex];

        // If time is up or completed text
        if (charIndex < characters.length && timeLeft > 0) {
            
            if (!isTyping) {
                timer = setInterval(initTimer, 1000);
                isTyping = true;
            }

            // Handle Backspace
            if (inputField.value.length < charIndex) { 
                // We don't actually support backspace logic in this specific implementation 
                // because we listen to 'input' event and rely on charIndex. 
                // However, standard implementation usually checks inputType.
                // To make it robust, let's adjust logic:
                // If the user presses backspace, the input value length decreases.
                
                // Let's reset the charIndex to the current input length
                charIndex = inputField.value.length;
                
                // Remove styling from the character that was backspaced
                characters[charIndex].classList.remove("correct", "incorrect");
                characters[charIndex].classList.add("active");
                
                // Remove styling from any characters ahead (just in case)
                for (let i = charIndex + 1; i < characters.length; i++) {
                    characters[i].classList.remove("correct", "incorrect", "active");
                }
                
                // Note: We don't decrement mistakes on backspace to penalize errors properly,
                // or we could, but usually "mistakes" counts total errors made.
                
            } else {
                // Normal typing
                // If user typed a char (input length > charIndex)
                if (typedChar == null) {
                    // This happens on backspace usually, handled above if logic is correct.
                    // But if typedChar is undefined, we just return.
                    charIndex--; 
                    if(charIndex < 0) charIndex = 0;
                    return;
                }

                if (characters[charIndex].innerText === typedChar) {
                    characters[charIndex].classList.add("correct");
                } else {
                    mistakes++;
                    characters[charIndex].classList.add("incorrect");
                }
                
                charIndex++;
                
                // Move active class
                characters.forEach(span => span.classList.remove("active"));
                if (charIndex < characters.length) {
                    characters[charIndex].classList.add("active");
                    
                    // Auto scroll if needed
                    // Check if active span is near bottom of container
                    let activeSpan = characters[charIndex];
                    if (activeSpan.offsetTop > textDisplay.scrollTop + textDisplay.offsetHeight - 40) {
                        textDisplay.scrollTop = activeSpan.offsetTop - 50;
                    }
                } else {
                    // Text finished
                    clearInterval(timer);
                    finishGame();
                }
            }
        } else {
            // Prevent further input if time is up
            if(timeLeft <= 0) inputField.value = inputField.value.substring(0, charIndex);
        }

        // Update Stats
        let wpm = Math.round(((charIndex - mistakes) / 5) / (maxTime - timeLeft) * 60);
        wpm = wpm < 0 || !wpm || wpm === Infinity ? 0 : wpm;
        
        mistakeTag.innerText = mistakes;
        wpmTag.innerText = wpm;
        
        let accuracy = Math.round(((charIndex - mistakes) / charIndex) * 100);
        accuracy = accuracy < 0 || !accuracy || accuracy === Infinity ? 100 : accuracy;
        accuracyTag.innerText = accuracy + "%";
    }

    function initTimer() {
        if (timeLeft > 0) {
            timeLeft--;
            timerTag.innerText = timeLeft + "s";
            
            // Recalculate WPM dynamically
            let wpm = Math.round(((charIndex - mistakes) / 5) / ((maxTime - timeLeft) / 60));
            wpmTag.innerText = wpm;
        } else {
            clearInterval(timer);
            finishGame();
        }
    }

    function finishGame() {
        inputField.disabled = true;
        
        // Calculate final stats
        let timeElapsed = maxTime - timeLeft;
        if (timeElapsed === 0) timeElapsed = 1; // prevent divide by zero
        
        let wpm = Math.round(((charIndex - mistakes) / 5) / (timeElapsed / 60));
        wpm = wpm < 0 || !wpm || wpm === Infinity ? 0 : wpm;
        
        let accuracy = Math.round(((charIndex - mistakes) / charIndex) * 100);
        accuracy = accuracy < 0 || !accuracy || accuracy === Infinity ? 0 : accuracy;

        finalWpm.innerText = wpm;
        finalAccuracy.innerText = accuracy + "%";
        finalMistakes.innerText = mistakes;
        
        resultModal.classList.add("show");
    }

    function resetGame() {
        loadParagraph();
        clearInterval(timer);
        timeLeft = maxTime;
        charIndex = 0;
        mistakes = 0;
        isTyping = false;
        timerTag.innerText = timeLeft + "s";
        mistakeTag.innerText = 0;
        wpmTag.innerText = 0;
        accuracyTag.innerText = "100%";
        inputField.value = "";
        inputField.disabled = false;
        resultModal.classList.remove("show");
        textDisplay.scrollTop = 0;
    }

    // Handle specific input logic for backspace vs typing
    // The previous initTyping relied on checking value vs charIndex
    // Let's refine the event listener to be more robust
    inputField.addEventListener("input", (e) => {
        // If the user pasted text or something weird happened, we might need adjustments
        // But for a simple speed test, 'input' event covers most.
        
        // Check if backspace was likely pressed (value length < charIndex)
        // Or text added (value length > charIndex)
        
        // We call initTyping which handles the logic based on length comparison
        initTyping();
    });

    restartBtn.addEventListener("click", resetGame);

    // Initialize
    loadParagraph();
</script>

</body>
</html>