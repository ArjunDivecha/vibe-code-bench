<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modern Password Generator</title>
    <style>
        /* CSS Variables & Reset */
        :root {
            --primary: #4f46e5;
            --primary-hover: #4338ca;
            --bg: #f3f4f6;
            --card-bg: #ffffff;
            --text-main: #111827;
            --text-muted: #6b7280;
            --border: #e5e7eb;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        }

        body {
            background-color: var(--bg);
            color: var(--text-main);
            display: flex;
            justify-content: center;
            padding: 2rem;
            min-height: 100vh;
        }

        .container {
            width: 100%;
            max-width: 600px;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        /* Card Styles */
        .card {
            background-color: var(--card-bg);
            border-radius: 1rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            padding: 1.5rem;
        }

        h1 {
            font-size: 1.5rem;
            font-weight: 700;
            text-align: center;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }

        h2 {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--text-main);
        }

        /* Controls */
        .control-group {
            margin-bottom: 1.25rem;
        }

        .label-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        label {
            font-weight: 500;
            font-size: 0.9rem;
        }

        .range-value {
            font-weight: 700;
            color: var(--primary);
        }

        input[type="range"] {
            width: 100%;
            cursor: pointer;
            accent-color: var(--primary);
        }

        .checkbox-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.75rem;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
            user-select: none;
        }

        input[type="checkbox"] {
            width: 1.1rem;
            height: 1.1rem;
            accent-color: var(--primary);
        }

        .number-input-row {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        input[type="number"] {
            padding: 0.5rem;
            border: 1px solid var(--border);
            border-radius: 0.375rem;
            width: 80px;
            font-size: 1rem;
        }

        /* Button */
        .btn-generate {
            width: 100%;
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 0.75rem;
            border-radius: 0.5rem;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .btn-generate:hover {
            background-color: var(--primary-hover);
        }

        /* Output Area */
        .output-list {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .password-item {
            background-color: #f9fafb;
            border: 1px solid var(--border);
            border-radius: 0.5rem;
            padding: 0.75rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: relative;
        }

        .password-text {
            font-family: "Courier New", Courier, monospace;
            font-size: 1.1rem;
            font-weight: 600;
            word-break: break-all;
            margin-right: 1rem;
        }

        .password-actions {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-icon {
            background: none;
            border: none;
            cursor: pointer;
            color: var(--text-muted);
            padding: 0.25rem;
            border-radius: 0.25rem;
            transition: color 0.2s, background-color 0.2s;
        }

        .btn-icon:hover {
            color: var(--primary);
            background-color: #e0e7ff;
        }

        /* Strength Meter */
        .strength-indicator {
            height: 4px;
            border-radius: 2px;
            margin-top: 0.5rem;
            background-color: #e5e7eb;
            width: 100%;
            overflow: hidden;
            position: relative;
        }

        .strength-bar {
            height: 100%;
            width: 0%;
            transition: width 0.3s ease, background-color 0.3s ease;
        }

        .strength-text {
            font-size: 0.75rem;
            margin-top: 0.25rem;
            text-align: right;
            font-weight: 600;
        }

        /* History */
        .history-list {
            max-height: 200px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .history-item {
            font-family: monospace;
            font-size: 0.9rem;
            padding: 0.5rem;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .history-item:hover {
            background-color: #f9fafb;
        }

        .toast {
            position: fixed;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%);
            background-color: var(--text-main);
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 2rem;
            font-size: 0.9rem;
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none;
            z-index: 100;
        }

        .toast.show {
            opacity: 1;
        }

        /* Utility */
        .hidden { display: none; }
    </style>
</head>
<body>

<div class="container">
    <div class="card">
        <h1>Password Generator</h1>
        
        <!-- Controls -->
        <div class="control-group">
            <div class="label-row">
                <label for="length">Password Length</label>
                <span class="range-value" id="length-val">16</span>
            </div>
            <input type="range" id="length" min="8" max="32" value="16">
        </div>

        <div class="control-group">
            <label style="display:block; margin-bottom:0.5rem;">Options</label>
            <div class="checkbox-grid">
                <label class="checkbox-item">
                    <input type="checkbox" id="uppercase" checked> Uppercase
                </label>
                <label class="checkbox-item">
                    <input type="checkbox" id="lowercase" checked> Lowercase
                </label>
                <label class="checkbox-item">
                    <input type="checkbox" id="numbers" checked> Numbers
                </label>
                <label class="checkbox-item">
                    <input type="checkbox" id="symbols" checked> Symbols
                </label>
            </div>
        </div>

        <div class="control-group">
             <div class="label-row">
                <label for="count">Quantity</label>
            </div>
            <div class="number-input-row">
                <input type="number" id="count" min="1" max="20" value="1">
                <span style="font-size: 0.85rem; color: var(--text-muted);">passwords to generate</span>
            </div>
        </div>

        <button class="btn-generate" id="generate-btn">Generate Passwords</button>
    </div>

    <!-- Output Section -->
    <div class="card hidden" id="output-card">
        <h2>Generated Passwords</h2>
        <div class="output-list" id="output-list">
            <!-- Passwords injected here -->
        </div>
    </div>

    <!-- History Section -->
    <div class="card hidden" id="history-card">
        <div class="label-row">
            <h2>History</h2>
            <button class="btn-icon" id="clear-history" title="Clear History" style="font-size:0.8rem;">Clear</button>
        </div>
        <div class="history-list" id="history-list">
            <!-- History injected here -->
        </div>
    </div>
</div>

<div class="toast" id="toast">Copied to clipboard!</div>

<script>
    // Elements
    const lengthSlider = document.getElementById('length');
    const lengthVal = document.getElementById('length-val');
    const chkUpper = document.getElementById('uppercase');
    const chkLower = document.getElementById('lowercase');
    const chkNumbers = document.getElementById('numbers');
    const chkSymbols = document.getElementById('symbols');
    const inputCount = document.getElementById('count');
    const btnGenerate = document.getElementById('generate-btn');
    const outputCard = document.getElementById('output-card');
    const outputList = document.getElementById('output-list');
    const historyCard = document.getElementById('history-card');
    const historyList = document.getElementById('history-list');
    const btnClearHistory = document.getElementById('clear-history');
    const toast = document.getElementById('toast');

    // Charsets
    const CHARS = {
        upper: 'ABCDEFGHIJKLMNOPQRSTUVWXYZ',
        lower: 'abcdefghijklmnopqrstuvwxyz',
        number: '0123456789',
        symbol: '!@#$%^&*()_+~`|}{[]:;?><,./-='
    };

    // State
    let history = [];

    // Init
    loadHistory();
    updateLengthDisplay();

    // Events
    lengthSlider.addEventListener('input', updateLengthDisplay);
    btnGenerate.addEventListener('click', generatePasswords);
    btnClearHistory.addEventListener('click', clearHistory);

    function updateLengthDisplay() {
        lengthVal.textContent = lengthSlider.value;
    }

    function generatePasswords() {
        const length = parseInt(lengthSlider.value);
        const count = parseInt(inputCount.value);
        const useUpper = chkUpper.checked;
        const useLower = chkLower.checked;
        const useNumbers = chkNumbers.checked;
        const useSymbols = chkSymbols.checked;

        if (!useUpper && !useLower && !useNumbers && !useSymbols) {
            showToast('Please select at least one character type.');
            return;
        }

        // Build character pool
        let pool = '';
        if (useUpper) pool += CHARS.upper;
        if (useLower) pool += CHARS.lower;
        if (useNumbers) pool += CHARS.number;
        if (useSymbols) pool += CHARS.symbol;

        const generated = [];

        for (let i = 0; i < count; i++) {
            let password = '';
            // Ensure guaranteed characters
            const guaranteed = [];
            if (useUpper) guaranteed.push(getRandomChar(CHARS.upper));
            if (useLower) guaranteed.push(getRandomChar(CHARS.lower));
            if (useNumbers) guaranteed.push(getRandomChar(CHARS.number));
            if (useSymbols) guaranteed.push(getRandomChar(CHARS.symbol));

            // Fill rest
            while (guaranteed.length < length) {
                guaranteed.push(getRandomChar(pool));
            }

            // Shuffle
            password = shuffleArray(guaranteed).join('');
            generated.push(password);
            addToHistory(password);
        }

        renderOutput(generated);
        renderHistory();
        
        // Scroll to output
        outputCard.classList.remove('hidden');
    }

    function getRandomChar(str) {
        const array = new Uint32Array(1);
        window.crypto.getRandomValues(array);
        return str[array[0] % str.length];
    }

    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    }

    function calculateStrength(password) {
        let score = 0;
        if (password.length > 8) score++;
        if (password.length >= 12) score++;
        if (/[A-Z]/.test(password)) score++;
        if (/[a-z]/.test(password)) score++;
        if (/[0-9]/.test(password)) score++;
        if (/[^A-Za-z0-9]/.test(password)) score++;

        // Normalize to 0-4 range for UI
        // <3: Weak (Red)
        // 3-4: Medium (Yellow)
        // 5-6: Strong (Green)
        
        if (score < 3) return { text: 'Weak', color: 'var(--danger)', percent: '33%' };
        if (score < 5) return { text: 'Medium', color: 'var(--warning)', percent: '66%' };
        return { text: 'Strong', color: 'var(--success)', percent: '100%' };
    }

    function renderOutput(passwords) {
        outputList.innerHTML = '';
        passwords.forEach(pw => {
            const strength = calculateStrength(pw);
            
            const item = document.createElement('div');
            item.className = 'password-item';
            
            const content = document.createElement('div');
            content.style.flex = '1';

            const textRow = document.createElement('div');
            textRow.style.display = 'flex';
            textRow.style.justifyContent = 'space-between';
            textRow.style.alignItems = 'center';

            const pwText = document.createElement('div');
            pwText.className = 'password-text';
            pwText.textContent = pw;

            const btnCopy = document.createElement('button');
            btnCopy.className = 'btn-icon';
            btnCopy.innerHTML = `<svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg>`;
            btnCopy.title = "Copy to clipboard";
            btnCopy.onclick = () => copyToClipboard(pw);

            textRow.appendChild(pwText);
            textRow.appendChild(btnCopy);

            // Strength bar
            const strengthContainer = document.createElement('div');
            strengthContainer.className = 'strength-indicator';
            const bar = document.createElement('div');
            bar.className = 'strength-bar';
            bar.style.width = strength.percent;
            bar.style.backgroundColor = strength.color;
            strengthContainer.appendChild(bar);

            const strengthLabel = document.createElement('div');
            strengthLabel.className = 'strength-text';
            strengthLabel.style.color = strength.color;
            strengthLabel.textContent = strength.text;

            content.appendChild(textRow);
            content.appendChild(strengthContainer);
            content.appendChild(strengthLabel);
            
            item.appendChild(content);
            outputList.appendChild(item);
        });
    }

    function addToHistory(pw) {
        // Add to beginning
        history.unshift(pw);
        // Limit history size
        if (history.length > 20) {
            history.pop();
        }
        // Save to local storage
        localStorage.setItem('pw_gen_history', JSON.stringify(history));
    }

    function loadHistory() {
        const stored = localStorage.getItem('pw_gen_history');
        if (stored) {
            try {
                history = JSON.parse(stored);
                renderHistory();
            } catch (e) {
                console.error("Failed to parse history");
            }
        }
    }

    function renderHistory() {
        if (history.length === 0) {
            historyCard.classList.add('hidden');
            return;
        }
        historyCard.classList.remove('hidden');
        historyList.innerHTML = '';
        history.forEach(pw => {
            const div = document.createElement('div');
            div.className = 'history-item';
            
            const spanPw = document.createElement('span');
            spanPw.textContent = pw;
            
            const spanCopy = document.createElement('span');
            spanCopy.innerHTML = '&#128203;'; // clipboard icon
            spanCopy.style.color = 'var(--text-muted)';
            spanCopy.title = "Copy";

            div.appendChild(spanPw);
            div.appendChild(spanCopy);
            
            div.onclick = () => copyToClipboard(pw);
            historyList.appendChild(div);
        });
    }

    function clearHistory() {
        history = [];
        localStorage.removeItem('pw_gen_history');
        renderHistory();
    }

    function copyToClipboard(text) {
        navigator.clipboard.writeText(text).then(() => {
            showToast('Copied to clipboard!');
        }, () => {
            showToast('Failed to copy');
        });
    }

    let toastTimeout;
    function showToast(msg) {
        toast.textContent = msg;
        toast.classList.add('show');
        clearTimeout(toastTimeout);
        toastTimeout = setTimeout(() => {
            toast.classList.remove('show');
        }, 2000);
    }

</script>

</body>
</html>