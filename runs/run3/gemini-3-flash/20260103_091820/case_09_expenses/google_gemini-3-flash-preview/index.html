<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Expense Tracker</title>
    <style>
        :root {
            --primary: #4f46e5;
            --secondary: #64748b;
            --success: #22c55e;
            --danger: #ef4444;
            --bg: #f8fafc;
            --card: #ffffff;
            --text: #1e293b;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 20px;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .grid {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 20px;
        }

        @media (max-width: 768px) {
            .grid { grid-template-columns: 1fr; }
        }

        .card {
            background: var(--card);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
            margin-bottom: 20px;
        }

        h2 { margin-top: 0; font-size: 1.25rem; color: var(--secondary); }

        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: 600; font-size: 0.9rem; }
        input, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            box-sizing: border-box;
        }

        button {
            width: 100%;
            padding: 10px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: opacity 0.2s;
        }

        button:hover { opacity: 0.9; }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-box {
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-total { background: #eef2ff; color: var(--primary); }
        .stat-count { background: #f0fdf4; color: var(--success); }
        .stat-val { font-size: 1.5rem; font-weight: bold; display: block; }

        .filters {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .filters input, .filters select { width: auto; flex: 1; min-width: 120px; }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            text-align: left;
            padding: 12px;
            border-bottom: 1px solid #f1f5f9;
        }

        th { background: #f8fafc; font-size: 0.85rem; text-transform: uppercase; color: var(--secondary); }

        .category-tag {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: bold;
        }

        .btn-delete {
            color: var(--danger);
            background: none;
            border: none;
            cursor: pointer;
            width: auto;
            padding: 5px;
        }

        /* Simple CSS Pie Chart */
        .chart-container {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .pie {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background: conic-gradient(var(--primary) 0%, #ddd 0%);
            position: relative;
        }

        .legend {
            margin-top: 15px;
            font-size: 0.8rem;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 4px;
        }

        .dot { width: 10px; height: 10px; border-radius: 50%; }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>Expense Tracker</h1>
    </header>

    <div class="grid">
        <!-- Sidebar: Form and Stats -->
        <div class="sidebar">
            <div class="card">
                <h2>Add Expense</h2>
                <form id="expenseForm">
                    <div class="form-group">
                        <label>Amount ($)</label>
                        <input type="number" step="0.01" id="amount" required placeholder="0.00">
                    </div>
                    <div class="form-group">
                        <label>Category</label>
                        <select id="category" required>
                            <option value="Food">Food</option>
                            <option value="Transport">Transport</option>
                            <option value="Entertainment">Entertainment</option>
                            <option value="Bills">Bills</option>
                            <option value="Shopping">Shopping</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Description</label>
                        <input type="text" id="description" required placeholder="e.g. Weekly Groceries">
                    </div>
                    <div class="form-group">
                        <label>Date</label>
                        <input type="date" id="date" required>
                    </div>
                    <button type="submit">Add Expense</button>
                </form>
            </div>

            <div class="card">
                <h2>Summary</h2>
                <div class="stats-grid">
                    <div class="stat-box stat-total">
                        <span class="stat-val" id="totalAmount">$0.00</span>
                        <span>Total Spent</span>
                    </div>
                    <div class="stat-box stat-count">
                        <span class="stat-val" id="totalCount">0</span>
                        <span>Expenses</span>
                    </div>
                </div>
                <div class="chart-container">
                    <div id="pieChart" class="pie"></div>
                </div>
                <div id="legend" class="legend"></div>
            </div>
        </div>

        <!-- Main Content: List and Filtering -->
        <div class="main">
            <div class="card">
                <h2>Filters</h2>
                <div class="filters">
                    <select id="filterCategory">
                        <option value="All">All Categories</option>
                        <option value="Food">Food</option>
                        <option value="Transport">Transport</option>
                        <option value="Entertainment">Entertainment</option>
                        <option value="Bills">Bills</option>
                        <option value="Shopping">Shopping</option>
                        <option value="Other">Other</option>
                    </select>
                    <input type="date" id="filterStart" placeholder="Start Date">
                    <input type="date" id="filterEnd" placeholder="End Date">
                    <button id="clearFilters" style="width: auto; background: var(--secondary);">Clear</button>
                </div>
            </div>

            <div class="card">
                <h2>Expense History</h2>
                <div style="overflow-x: auto;">
                    <table id="expenseTable">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Category</th>
                                <th>Description</th>
                                <th>Amount</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody id="expenseList">
                            <!-- Rows injected here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // State management
    let expenses = JSON.parse(localStorage.getItem('expenses')) || [];
    const colors = {
        'Food': '#f87171',
        'Transport': '#60a5fa',
        'Entertainment': '#fbbf24',
        'Bills': '#a78bfa',
        'Shopping': '#4ade80',
        'Other': '#94a3b8'
    };

    // DOM Elements
    const expenseForm = document.getElementById('expenseForm');
    const expenseList = document.getElementById('expenseList');
    const totalAmountEl = document.getElementById('totalAmount');
    const totalCountEl = document.getElementById('totalCount');
    const pieChart = document.getElementById('pieChart');
    const legend = document.getElementById('legend');
    
    // Filter Elements
    const filterCat = document.getElementById('filterCategory');
    const filterStart = document.getElementById('filterStart');
    const filterEnd = document.getElementById('filterEnd');
    const clearBtn = document.getElementById('clearFilters');

    // Initialize Date Input to Today
    document.getElementById('date').valueAsDate = new Date();

    function save() {
        localStorage.setItem('expenses', JSON.stringify(expenses));
        render();
    }

    function addExpense(e) {
        e.preventDefault();
        const expense = {
            id: Date.now(),
            amount: parseFloat(document.getElementById('amount').value),
            category: document.getElementById('category').value,
            description: document.getElementById('description').value,
            date: document.getElementById('date').value
        };
        expenses.push(expense);
        expenseForm.reset();
        document.getElementById('date').valueAsDate = new Date();
        save();
    }

    function deleteExpense(id) {
        expenses = expenses.filter(e => e.id !== id);
        save();
    }

    function render() {
        const catFilter = filterCat.value;
        const start = filterStart.value;
        const end = filterEnd.value;

        // Filter logic
        const filtered = expenses.filter(exp => {
            const matchCat = catFilter === 'All' || exp.category === catFilter;
            const matchStart = !start || exp.date >= start;
            const matchEnd = !end || exp.date <= end;
            return matchCat && matchStart && matchEnd;
        }).sort((a, b) => new Date(b.date) - new Date(a.date));

        // Render Table
        expenseList.innerHTML = filtered.map(exp => `
            <tr>
                <td>${exp.date}</td>
                <td><span class="category-tag" style="background: ${colors[exp.category]}33; color: ${colors[exp.category]}">${exp.category}</span></td>
                <td>${exp.description}</td>
                <td>$${exp.amount.toFixed(2)}</td>
                <td><button class="btn-delete" onclick="deleteExpense(${exp.id})">âœ•</button></td>
            </tr>
        `).join('');

        // Calculate Totals
        const total = filtered.reduce((sum, exp) => sum + exp.amount, 0);
        totalAmountEl.innerText = `$${total.toFixed(2)}`;
        totalCountEl.innerText = filtered.length;

        updateChart(filtered);
    }

    function updateChart(data) {
        const totals = {};
        let totalVal = 0;
        
        // Group by category
        data.forEach(exp => {
            totals[exp.category] = (totals[exp.category] || 0) + exp.amount;
            totalVal += exp.amount;
        });

        // Create Pie Chart segments
        let currentPercent = 0;
        const segments = [];
        const legendHtml = [];

        Object.keys(colors).forEach(cat => {
            const val = totals[cat] || 0;
            if (val > 0) {
                const percent = (val / totalVal) * 100;
                segments.push(`${colors[cat]} ${currentPercent}% ${currentPercent + percent}%`);
                currentPercent += percent;
                
                legendHtml.push(`
                    <div class="legend-item">
                        <div class="dot" style="background: ${colors[cat]}"></div>
                        <span>${cat}: $${val.toFixed(2)} (${Math.round(percent)}%)</span>
                    </div>
                `);
            }
        });

        pieChart.style.background = segments.length > 0 
            ? `conic-gradient(${segments.join(', ')})` 
            : '#e2e8f0';
        
        legend.innerHTML = legendHtml.join('');
    }

    // Event Listeners
    expenseForm.addEventListener('submit', addExpense);
    [filterCat, filterStart, filterEnd].forEach(el => el.addEventListener('change', render));
    clearBtn.addEventListener('click', () => {
        filterCat.value = 'All';
        filterStart.value = '';
        filterEnd.value = '';
        render();
    });

    // Initial load
    render();
</script>

</body>
</html>