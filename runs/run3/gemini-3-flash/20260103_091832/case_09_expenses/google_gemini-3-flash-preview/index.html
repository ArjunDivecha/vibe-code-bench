<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personal Expense Tracker</title>
    <style>
        :root {
            --primary: #4f46e5;
            --primary-hover: #4338ca;
            --bg: #f8fafc;
            --card: #ffffff;
            --text: #1e293b;
            --text-muted: #64748b;
            --border: #e2e8f0;
            --danger: #ef4444;
            --success: #22c55e;
        }

        * { box-sizing: border-box; font-family: 'Segoe UI', system-ui, sans-serif; }
        body { background-color: var(--bg); color: var(--text); margin: 0; padding: 20px; line-height: 1.5; }
        .container { max-width: 1000px; margin: 0 auto; display: grid; grid-template-columns: 1fr 350px; gap: 24px; }
        
        @media (max-width: 850px) {
            .container { grid-template-columns: 1fr; }
        }

        h1, h2, h3 { margin-top: 0; color: var(--text); }
        .card { background: var(--card); padding: 24px; border-radius: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); border: 1px solid var(--border); margin-bottom: 20px; }

        /* Form Styling */
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: 600; font-size: 0.9rem; }
        input, select { 
            width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 6px; 
            font-size: 1rem; outline: none; transition: border-color 0.2s;
        }
        input:focus, select:focus { border-color: var(--primary); }
        button { 
            cursor: pointer; padding: 10px 16px; border-radius: 6px; border: none; 
            font-weight: 600; transition: background 0.2s; 
        }
        .btn-primary { background: var(--primary); color: white; width: 100%; }
        .btn-primary:hover { background: var(--primary-hover); }
        
        /* Stats Styling */
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px; }
        .stat-card { background: var(--bg); padding: 15px; border-radius: 8px; text-align: center; border: 1px solid var(--border); }
        .stat-val { font-size: 1.5rem; font-weight: bold; color: var(--primary); }
        .stat-label { font-size: 0.8rem; color: var(--text-muted); text-transform: uppercase; }

        /* Table/List Styling */
        .filters { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; align-items: flex-end; }
        .filters .form-group { margin-bottom: 0; flex: 1; min-width: 150px; }
        
        .expense-table-container { overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; text-align: left; }
        th { padding: 12px; border-bottom: 2px solid var(--border); color: var(--text-muted); font-size: 0.85rem; }
        td { padding: 12px; border-bottom: 1px solid var(--border); font-size: 0.95rem; }
        .cat-tag { 
            padding: 2px 8px; border-radius: 12px; font-size: 0.75rem; font-weight: bold; 
            text-transform: uppercase; display: inline-block;
        }
        .delete-btn { color: var(--danger); background: none; border: none; padding: 4px; cursor: pointer; }
        .delete-btn:hover { text-decoration: underline; }

        /* Chart Styling */
        .chart-container { display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .pie-chart { transform: rotate(-90deg); border-radius: 50%; }
        .legend { margin-top: 20px; width: 100%; }
        .legend-item { display: flex; align-items: center; margin-bottom: 5px; font-size: 0.85rem; }
        .legend-color { width: 12px; height: 12px; border-radius: 2px; margin-right: 8px; }

        .empty-state { text-align: center; color: var(--text-muted); padding: 40px 0; }
    </style>
</head>
<body>

    <header style="margin-bottom: 30px; text-align: center;">
        <h1>Expense Tracker</h1>
        <p style="color: var(--text-muted);">Manage your personal finances efficiently</p>
    </header>

    <div class="container">
        <!-- Sidebar: Add & Summary -->
        <aside>
            <div class="card">
                <h3>Add New Expense</h3>
                <form id="expense-form">
                    <div class="form-group">
                        <label>Amount ($)</label>
                        <input type="number" id="amount" step="0.01" required placeholder="0.00">
                    </div>
                    <div class="form-group">
                        <label>Category</label>
                        <select id="category" required>
                            <option value="Food">Food</option>
                            <option value="Transport">Transport</option>
                            <option value="Entertainment">Entertainment</option>
                            <option value="Bills">Bills</option>
                            <option value="Shopping">Shopping</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Description</label>
                        <input type="text" id="description" required placeholder="What was it for?">
                    </div>
                    <div class="form-group">
                        <label>Date</label>
                        <input type="date" id="date" required>
                    </div>
                    <button type="submit" class="btn-primary">Add Expense</button>
                </form>
            </div>

            <div class="card chart-container">
                <h3>Spending Breakdown</h3>
                <div id="chart-wrapper">
                    <!-- SVG Chart will be injected here -->
                </div>
                <div id="legend" class="legend"></div>
            </div>
        </aside>

        <!-- Main Content: List and Filters -->
        <main>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">Total Spending</div>
                    <div class="stat-val" id="total-amount">$0.00</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Transactions</div>
                    <div class="stat-val" id="total-count">0</div>
                </div>
            </div>

            <div class="card">
                <div class="filters">
                    <div class="form-group">
                        <label>Filter Category</label>
                        <select id="filter-category">
                            <option value="All">All Categories</option>
                            <option value="Food">Food</option>
                            <option value="Transport">Transport</option>
                            <option value="Entertainment">Entertainment</option>
                            <option value="Bills">Bills</option>
                            <option value="Shopping">Shopping</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>From</label>
                        <input type="date" id="filter-from">
                    </div>
                    <div class="form-group">
                        <label>To</label>
                        <input type="date" id="filter-to">
                    </div>
                </div>

                <div class="expense-table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Description</th>
                                <th>Category</th>
                                <th>Amount</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="expense-list">
                            <!-- Rows injected here -->
                        </tbody>
                    </table>
                    <div id="empty-msg" class="empty-state" style="display: none;">
                        No expenses found for the selected filters.
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // State Management
        let expenses = JSON.parse(localStorage.getItem('expenses')) || [];
        const CATEGORY_COLORS = {
            'Food': '#f59e0b',
            'Transport': '#3b82f6',
            'Entertainment': '#a855f7',
            'Bills': '#ef4444',
            'Shopping': '#ec4899',
            'Other': '#64748b'
        };

        // DOM Elements
        const expenseForm = document.getElementById('expense-form');
        const expenseList = document.getElementById('expense-list');
        const totalAmountEl = document.getElementById('total-amount');
        const totalCountEl = document.getElementById('total-count');
        const filterCategory = document.getElementById('filter-category');
        const filterFrom = document.getElementById('filter-from');
        const filterTo = document.getElementById('filter-to');
        const emptyMsg = document.getElementById('empty-msg');
        const chartWrapper = document.getElementById('chart-wrapper');
        const legendEl = document.getElementById('legend');

        // Initialize date to today
        document.getElementById('date').valueAsDate = new Date();

        // Functions
        function saveExpenses() {
            localStorage.setItem('expenses', JSON.stringify(expenses));
            render();
        }

        function addExpense(e) {
            e.preventDefault();
            const newExpense = {
                id: Date.now(),
                amount: parseFloat(document.getElementById('amount').value),
                category: document.getElementById('category').value,
                description: document.getElementById('description').value,
                date: document.getElementById('date').value
            };
            expenses.push(newExpense);
            expenseForm.reset();
            document.getElementById('date').valueAsDate = new Date();
            saveExpenses();
        }

        function deleteExpense(id) {
            expenses = expenses.filter(exp => exp.id !== id);
            saveExpenses();
        }

        function getFilteredExpenses() {
            const cat = filterCategory.value;
            const from = filterFrom.value;
            const to = filterTo.value;

            return expenses.filter(exp => {
                const matchCat = cat === 'All' || exp.category === cat;
                const matchFrom = !from || exp.date >= from;
                const matchTo = !to || exp.date <= to;
                return matchCat && matchFrom && matchTo;
            }).sort((a, b) => new Date(b.date) - new Date(a.date));
        }

        function render() {
            const filtered = getFilteredExpenses();
            expenseList.innerHTML = '';
            
            let total = 0;
            filtered.forEach(exp => {
                total += exp.amount;
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${exp.date}</td>
                    <td>${exp.description}</td>
                    <td><span class="cat-tag" style="background: ${CATEGORY_COLORS[exp.category]}20; color: ${CATEGORY_COLORS[exp.category]}">${exp.category}</span></td>
                    <td style="font-weight: 600;">$${exp.amount.toFixed(2)}</td>
                    <td><button class="delete-btn" onclick="deleteExpense(${exp.id})">Delete</button></td>
                `;
                expenseList.appendChild(tr);
            });

            totalAmountEl.textContent = `$${total.toFixed(2)}`;
            totalCountEl.textContent = filtered.length;
            emptyMsg.style.display = filtered.length === 0 ? 'block' : 'none';

            renderChart(filtered);
        }

        function renderChart(data) {
            const breakdown = {};
            let total = 0;
            
            // Calculate totals per category
            data.forEach(exp => {
                breakdown[exp.category] = (breakdown[exp.category] || 0) + exp.amount;
                total += exp.amount;
            });

            chartWrapper.innerHTML = '';
            legendEl.innerHTML = '';

            if (total === 0) {
                chartWrapper.innerHTML = '<p style="color: #94a3b8; font-size: 0.9rem;">No data for chart</p>';
                return;
            }

            // Create SVG Pie Chart
            const size = 160;
            const radius = 70;
            const cx = size / 2;
            const cy = size / 2;
            let currentAngle = 0;

            const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
            svg.setAttribute("width", size);
            svg.setAttribute("height", size);
            svg.setAttribute("viewBox", `0 0 ${size} ${size}`);
            svg.classList.add('pie-chart');

            Object.entries(breakdown).forEach(([cat, val]) => {
                const percentage = val / total;
                const angle = percentage * 360;
                
                // SVG arc path calculation
                const x1 = cx + radius * Math.cos(Math.PI * currentAngle / 180);
                const y1 = cy + radius * Math.sin(Math.PI * currentAngle / 180);
                const x2 = cx + radius * Math.cos(Math.PI * (currentAngle + angle) / 180);
                const y2 = cy + radius * Math.sin(Math.PI * (currentAngle + angle) / 180);
                
                const largeArcFlag = angle > 180 ? 1 : 0;
                const pathData = `M ${cx} ${cy} L ${x1} ${y1} A ${radius} ${radius} 0 ${largeArcFlag} 1 ${x2} ${y2} Z`;
                
                const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
                path.setAttribute("d", pathData);
                path.setAttribute("fill", CATEGORY_COLORS[cat]);
                svg.appendChild(path);

                currentAngle += angle;

                // Legend
                const legendItem = document.createElement('div');
                legendItem.className = 'legend-item';
                legendItem.innerHTML = `
                    <div class="legend-color" style="background: ${CATEGORY_COLORS[cat]}"></div>
                    <div style="flex: 1">${cat}</div>
                    <div style="font-weight: 600">$${val.toFixed(2)}</div>
                `;
                legendEl.appendChild(legendItem);
            });

            chartWrapper.appendChild(svg);
        }

        // Event Listeners
        expenseForm.addEventListener('submit', addExpense);
        filterCategory.addEventListener('change', render);
        filterFrom.addEventListener('change', render);
        filterTo.addEventListener('change', render);

        // Initial Render
        render();
    </script>
</body>
</html>