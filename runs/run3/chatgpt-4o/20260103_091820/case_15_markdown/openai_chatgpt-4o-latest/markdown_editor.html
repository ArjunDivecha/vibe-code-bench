<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Markdown Editor</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      display: flex;
      flex-direction: column;
      height: 100vh;
      background-color: #ffffff;
      color: #000000;
    }

    body.dark {
      background-color: #1e1e1e;
      color: #d4d4d4;
    }

    .toolbar {
      display: flex;
      justify-content: space-between;
      padding: 10px;
      background-color: #f0f0f0;
    }

    body.dark .toolbar {
      background-color: #2d2d2d;
    }

    .toolbar button {
      margin-right: 10px;
    }

    .editor-container {
      flex: 1;
      display: flex;
      height: calc(100% - 50px);
    }

    textarea {
      width: 50%;
      height: 100%;
      border: none;
      padding: 10px;
      font-size: 16px;
      resize: none;
      background-color: #ffffff;
      color: #000000;
    }

    body.dark textarea {
      background-color: #1e1e1e;
      color: #ffffff;
    }

    .preview {
      width: 50%;
      height: 100%;
      overflow-y: auto;
      padding: 10px;
      border-left: 1px solid #ccc;
      background-color: #fafafa;
    }

    body.dark .preview {
      background-color: #2a2a2a;
    }

    pre {
      background-color: #eee;
      padding: 10px;
      overflow-x: auto;
    }

    body.dark pre {
      background-color: #3a3a3a;
    }

    blockquote {
      border-left: 4px solid #ccc;
      margin: 1em 0;
      padding-left: 1em;
      color: #666;
    }

    body.dark blockquote {
      border-left-color: #888;
      color: #aaa;
    }
  </style>
</head>
<body>
  <div class="toolbar">
    <div>
      <button onclick="toggleDarkMode()">Toggle Dark Mode</button>
      <button onclick="exportHTML()">Export as HTML</button>
    </div>
    <div>
      <button onclick="saveContent()">Save</button>
      <button onclick="loadContent()">Load</button>
    </div>
  </div>
  <div class="editor-container">
    <textarea id="markdown-input" placeholder="Enter markdown..."></textarea>
    <div class="preview" id="preview"></div>
  </div>

  <script>
    const input = document.getElementById('markdown-input');
    const preview = document.getElementById('preview');

    function escapeHTML(html) {
      return html.replace(/&/g, "&amp;")
                 .replace(/</g, "&lt;")
                 .replace(/>/g, "&gt;");
    }

    function renderMarkdown(md) {
      // Escape HTML
      md = escapeHTML(md);

      // Code blocks ```
      md = md.replace(/```([\s\S]*?)```/g, '<pre><code>$1</code></pre>');

      // Blockquotes >
      md = md.replace(/^> (.*$)/gm, '<blockquote>$1</blockquote>');

      // Headers
      md = md.replace(/^### (.*$)/gm, '<h3>$1</h3>');
      md = md.replace(/^## (.*$)/gm, '<h2>$1</h2>');
      md = md.replace(/^# (.*$)/gm, '<h1>$1</h1>');

      // Bold **text**
      md = md.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');

      // Italic *text*
      md = md.replace(/\*(.*?)\*/g, '<em>$1</em>');

      // Links [text](url)
      md = md.replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2" target="_blank">$1</a>');

      // Ordered list
      md = md.replace(/^\d+\.\s+(.*)/gm, '<ol><li>$1</li></ol>');
      md = md.replace(/<\/ol>\s*<ol>/g, '');

      // Unordered list
      md = md.replace(/^- (.*)/gm, '<ul><li>$1</li></ul>');
      md = md.replace(/<\/ul>\s*<ul>/g, '');

      // Line breaks
      md = md.replace(/\n{2,}/g, '</p><p>');
      md = '<p>' + md + '</p>';
      return md;
    }

    function updatePreview() {
      const md = input.value;
      preview.innerHTML = renderMarkdown(md);
    }

    input.addEventListener('input', updatePreview);

    function toggleDarkMode() {
      document.body.classList.toggle('dark');
    }

    function saveContent() {
      localStorage.setItem('markdownContent', input.value);
    }

    function loadContent() {
      const content = localStorage.getItem('markdownContent');
      if (content !== null) {
        input.value = content;
        updatePreview();
      }
    }

    function exportHTML() {
      const htmlContent = `<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Exported Markdown</title>
</head>
<body>
${preview.innerHTML}
</body>
</html>`;
      const blob = new Blob([htmlContent], { type: 'text/html' });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'markdown_export.html';
      a.click();
    }

    // Initialize on load
    window.onload = () => {
      loadContent();
      updatePreview();
    };
  </script>
</body>
</html>