<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Habit Tracker</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
        }
        .container {
            width: 80%;
            margin: 40px auto;
            background-color: #fff;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        .habit {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        .habit span {
            margin-right: 10px;
        }
        .habit input[type="checkbox"] {
            accent-color: #4CAF50;
        }
        .calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            grid-gap: 10px;
            margin-top: 20px;
        }
        .day {
            background-color: #fff;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 10px;
        }
        .day::before {
            content: attr(data-date);
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Habit Tracker</h1>
        <form id="add-habit">
            <input type="text" id="habit-name" placeholder="Add habit...">
            <button type="submit">Add</button>
        </form>
        <div id="habits">
            <!-- habits will be rendered here -->
        </div>
        <div id="calendar">
            <!-- calendar will be rendered here -->
        </div>
    </div>
    <script>
        // get stored habits and dates from localStorage
        let habits = JSON.parse(localStorage.getItem('habits')) || {};
        let dates = JSON.parse(localStorage.getItem('dates')) || [];
        
        // render habits
        function renderHabits() {
            const habitsDiv = document.getElementById('habits');
            habitsDiv.innerHTML = '';
            for (let habit of Object.keys(habits)) {
                const habitDiv = document.createElement('div');
                habitDiv.classList.add('habit');
                const habitSpan = document.createElement('span');
                habitSpan.textContent = habit;
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.checked = habits[habit];
                checkbox.addEventListener('change', function() {
                    habits[habit] = this.checked;
                    localStorage.setItem('habits', JSON.stringify(habits));
                });
                habitDiv.appendChild(habitSpan);
                habitDiv.appendChild(checkbox);
                habitsDiv.appendChild(habitDiv);
            }
        }
        
        // render calendar
        function renderCalendar() {
            const calendarDiv = document.getElementById('calendar');
            calendarDiv.innerHTML = '';
            const today = new Date();
            const start = new Date(today.getFullYear(), today.getMonth(), today.getDate() - 30);
            for (let i = 0; i < 30; i++) {
                const date = new Date(start.getTime() + i * 24 * 60 * 60 * 1000);
                const dayDiv = document.createElement('div');
                dayDiv.classList.add('day');
                dayDiv.setAttribute('data-date', date.toLocaleDateString());
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.checked = dates.includes(date.toLocaleDateString());
                checkbox.addEventListener('change', function() {
                    if (this.checked) {
                        dates.push(date.toLocaleDateString());
                    } else {
                        dates = dates.filter(d => d !== date.toLocaleDateString());
                    }
                    localStorage.setItem('dates', JSON.stringify(dates));
                });
                dayDiv.appendChild(checkbox);
                calendarDiv.appendChild(dayDiv);
            }
        }
        
        // update streak and completion percentage
        function updateStats() {
            const habitsDiv = document.getElementById('habits');
            const habits = habitsDiv.children;
            for (let i = 0; i < habits.length; i++) {
                const habit = habits[i];
                const checkbox = habit.children[1];
                const completed = checkbox.checked;
                const streak = getStreak(completed, habits, i);
                const completionPercentage = getCompletionPercentage(completed);
                habit.children[0].textContent = `${habit.children[0].textContent} (Streak: ${streak}, Completion: ${completionPercentage}%)`;
            }
        }
        
        // get streak
        function getStreak(completed, habits, index) {
            let streak = 0;
            for (let i = index - 1; i >= 0; i--) {
                const habit = habits[i];
                const checkbox = habit.children[1];
                if (!checkbox.checked) break;
                streak++;
            }
            return streak;
        }
        
        // get completion percentage
        function getCompletionPercentage(completed) {
            return completed ? 100 : 0;
        }
        
        // add event listeners
        document.getElementById('add-habit').addEventListener('submit', function(e) {
            e.preventDefault();
            const habitName = document.getElementById('habit-name').value;
            if (habitName) {
                habits[habitName] = false;
                localStorage.setItem('habits', JSON.stringify(habits));
                renderHabits();
                updateStats();
            }
        });
        document.addEventListener('DOMContentLoaded', function() {
            renderHabits();
            renderCalendar();
            updateStats();
        });
    </script>
</body>
</html>