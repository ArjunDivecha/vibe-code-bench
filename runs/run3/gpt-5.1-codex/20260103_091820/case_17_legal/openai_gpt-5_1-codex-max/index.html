<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Vibe-Law | Legal Case Search Workspace</title>
<style>
:root {
    --bg: #0b1220;
    --panel: #0f1626;
    --panel-2: #111a2d;
    --accent: #3ba6ff;
    --accent-2: #66e0ff;
    --text: #e8edf5;
    --muted: #97a5c0;
    --border: #1e2a40;
    --note: #182235;
    --warning: #ffbf69;
}
* { box-sizing: border-box; }
body {
    margin: 0;
    font-family: "Inter", "Segoe UI", system-ui, -apple-system, sans-serif;
    background: radial-gradient(circle at 20% 20%, rgba(59,166,255,0.08), transparent 28%), radial-gradient(circle at 80% 10%, rgba(102,224,255,0.06), transparent 22%), var(--bg);
    color: var(--text);
    height: 100vh;
    overflow: hidden;
}
header {
    padding: 16px 20px 12px;
    border-bottom: 1px solid var(--border);
    background: linear-gradient(120deg, rgba(59,166,255,0.08), transparent);
    display: flex;
    align-items: center;
    gap: 16px;
}
.brand {
    display: flex;
    align-items: center;
    gap: 10px;
    font-weight: 700;
    letter-spacing: 0.5px;
}
.brand .logo {
    width: 38px;
    height: 38px;
    border-radius: 12px;
    background: linear-gradient(145deg, #3ba6ff, #0e62d6);
    display: grid;
    place-items: center;
    color: #fff;
    font-weight: 800;
    font-size: 18px;
    box-shadow: 0 8px 18px rgba(59,166,255,0.35);
}
.search {
    flex: 1;
    position: relative;
}
.search input {
    width: 100%;
    padding: 12px 14px 12px 40px;
    background: var(--panel);
    border: 1px solid var(--border);
    border-radius: 12px;
    color: var(--text);
    font-size: 14px;
}
.search input:focus { outline: 1px solid var(--accent); }
.search .icon {
    position: absolute;
    left: 12px;
    top: 50%;
    transform: translateY(-50%);
    color: var(--muted);
    pointer-events: none;
}
.app {
    display: grid;
    grid-template-rows: auto 1fr;
    height: 100vh;
}
.content {
    display: grid;
    grid-template-columns: 35% 65%;
    height: calc(100vh - 70px);
}
.results-panel {
    border-right: 1px solid var(--border);
    background: var(--panel);
    overflow-y: auto;
    padding: 12px 14px 80px;
}
.results-panel h3 {
    margin: 4px 0 10px;
    color: var(--muted);
    font-size: 13px;
    letter-spacing: 0.4px;
}
.result-card {
    background: var(--panel-2);
    border: 1px solid var(--border);
    border-radius: 14px;
    padding: 12px;
    margin-bottom: 10px;
    cursor: pointer;
    transition: border-color 0.15s, transform 0.12s;
}
.result-card:hover {
    border-color: rgba(59,166,255,0.6);
    transform: translateY(-1px);
}
.result-card.active {
    border-color: var(--accent);
    box-shadow: 0 6px 16px rgba(59,166,255,0.18);
}
.result-title {
    font-weight: 700;
    margin-bottom: 4px;
}
.meta {
    font-size: 12px;
    color: var(--muted);
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
}
.snippet {
    margin-top: 6px;
    color: #c8d4ed;
    font-size: 13px;
    line-height: 1.4;
}
.detail-panel {
    background: var(--panel-2);
    display: grid;
    grid-template-columns: 68% 32%;
    height: 100%;
    overflow: hidden;
}
.detail-main {
    border-right: 1px solid var(--border);
    padding: 16px 18px;
    display: flex;
    flex-direction: column;
    gap: 12px;
}
.detail-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: 12px;
}
.detail-header h2 {
    margin: 0;
    font-size: 19px;
}
.badge {
    padding: 6px 8px;
    background: rgba(59,166,255,0.15);
    border: 1px solid rgba(59,166,255,0.35);
    border-radius: 10px;
    color: var(--accent-2);
    font-size: 12px;
    font-weight: 700;
}
.tab-bar {
    display: flex;
    gap: 8px;
    align-items: center;
    flex-wrap: wrap;
}
.tab-btn, .action-btn {
    padding: 9px 12px;
    border-radius: 10px;
    border: 1px solid var(--border);
    background: var(--panel);
    color: var(--text);
    cursor: pointer;
    font-weight: 600;
    font-size: 13px;
    transition: border-color 0.12s, background 0.12s;
}
.tab-btn.active {
    background: rgba(59,166,255,0.12);
    border-color: var(--accent);
    color: var(--accent-2);
}
.action-btn {
    background: linear-gradient(135deg, rgba(59,166,255,0.12), rgba(102,224,255,0.08));
}
.action-btn.active {
    border-color: var(--accent);
    box-shadow: 0 6px 16px rgba(59,166,255,0.18);
}
.detail-body {
    background: var(--panel);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 14px;
    flex: 1;
    overflow-y: auto;
    line-height: 1.6;
    color: #dbe5ff;
    min-height: 200px;
}
.detail-body .entity {
    background: rgba(255,191,105,0.2);
    border-bottom: 1px solid rgba(255,191,105,0.5);
    color: #ffd9a0;
    padding: 1px 3px;
    border-radius: 4px;
}
.detail-meta {
    display: flex;
    gap: 14px;
    color: var(--muted);
    font-size: 12px;
    flex-wrap: wrap;
}
.notes-panel {
    padding: 16px;
    background: var(--panel);
    display: flex;
    flex-direction: column;
    gap: 10px;
}
.notes-panel h3 {
    margin: 0;
    font-size: 15px;
}
.note-input {
    background: var(--note);
    border: 1px solid var(--border);
    border-radius: 10px;
    color: var(--text);
    padding: 10px;
    min-height: 60px;
    resize: vertical;
    font-size: 13px;
}
.note-controls {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
}
.note-btn {
    background: var(--panel-2);
    border: 1px solid var(--border);
    color: var(--text);
    border-radius: 9px;
    padding: 8px 10px;
    cursor: pointer;
    font-size: 12px;
    font-weight: 700;
    transition: border-color 0.1s;
}
.note-btn.primary {
    background: linear-gradient(135deg, #3ba6ff33, #0e62d633);
    border-color: var(--accent);
    color: var(--accent-2);
}
.note-btn:hover { border-color: var(--accent); }
.note-card {
    background: var(--note);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 10px;
    margin-bottom: 8px;
}
.note-card .meta-line {
    font-size: 11px;
    color: var(--muted);
    display: flex;
    justify-content: space-between;
}
.empty {
    color: var(--muted);
    text-align: center;
    padding: 14px 6px;
    font-size: 13px;
}
@media (max-width: 1100px) {
    .content { grid-template-columns: 40% 60%; }
}
@media (max-width: 900px) {
    body { overflow: auto; }
    .content { grid-template-columns: 1fr; height: auto; }
    .detail-panel { grid-template-columns: 1fr; height: auto; }
    .notes-panel { border-top: 1px solid var(--border); }
    .results-panel { max-height: 280px; }
}
</style>
</head>
<body>
<div class="app">
    <header>
        <div class="brand">
            <div class="logo">VL</div>
            <div>
                <div style="font-size:15px;">Vibe-Law</div>
                <div style="font-size:12px;color:var(--muted);">Case Intelligence Workspace</div>
            </div>
        </div>
        <div class="search">
            <span class="icon">üîé</span>
            <input id="searchInput" type="text" placeholder="Search case title, court, or keywords...">
        </div>
    </header>
    <div class="content">
        <div class="results-panel">
            <h3>Results</h3>
            <div id="resultsList"></div>
        </div>
        <div class="detail-panel">
            <div class="detail-main">
                <div class="detail-header">
                    <div>
                        <h2 id="detailTitle">Select a case to view details</h2>
                        <div id="detailMeta" class="detail-meta"></div>
                    </div>
                    <div class="badge" id="resultCount">0 cases</div>
                </div>
                <div class="tab-bar">
                    <button class="tab-btn active" data-tab="summary">Summary</button>
                    <button class="tab-btn" data-tab="full">Full Text</button>
                    <button class="action-btn" id="extractBtn">Extract Entities</button>
                    <span id="statusMsg" style="color:var(--muted);font-size:12px;"></span>
                </div>
                <div id="detailBody" class="detail-body">No case selected.</div>
            </div>
            <div class="notes-panel">
                <div style="display:flex;justify-content:space-between;align-items:center;">
                    <h3>Notes</h3>
                    <span style="color:var(--muted);font-size:12px;">Saved locally</span>
                </div>
                <div style="color:var(--muted);font-size:12px;line-height:1.4;">Highlight text in the Summary or Full Text, then click ‚ÄúSave Selection‚Äù.</div>
                <textarea id="noteInput" class="note-input" placeholder="Or type a note manually..."></textarea>
                <div class="note-controls">
                    <button class="note-btn primary" id="saveNoteBtn">Save Typed Note</button>
                    <button class="note-btn" id="saveSelectionBtn">Save Selection</button>
                    <button class="note-btn" id="clearNotesBtn">Clear All</button>
                </div>
                <div id="notesList"></div>
            </div>
        </div>
    </div>
</div>

<script>
const cases = [
    {
        id: "case1",
        title: "State v. Morales",
        court: "Supreme Court of California",
        date: "2023-06-12",
        snippet: "Clarifies how digital location data can be used under California's privacy protections.",
        summary: "The California Supreme Court considered whether warrantless acquisition of historic cell-site data violated Article I, Section 13. The Court held that prolonged tracking without judicial approval is presumptively unreasonable, but allowed limited emergency exceptions.",
        fullText: "On June 12, 2023, the Supreme Court of California in State v. Morales addressed whether law enforcement may obtain fourteen days of historic cell-site data without a warrant. Morales, a resident of Los Angeles County, challenged the search under Article I, Section 13 of the California Constitution and the Fourth Amendment. The Court affirmed suppression of the data, finding no valid exigency and noting that the government had ample time to seek judicial authorization. The opinion distinguishes earlier federal cases and emphasizes California's independent privacy protections. Justice Rivera authored the unanimous opinion.",
        entities: ["Supreme Court of California", "June 12, 2023", "Article I, Section 13", "Los Angeles County", "Justice Rivera", "Morales"]
    },
    {
        id: "case2",
        title: "United States v. Grey Harbor Shipping Co.",
        court: "U.S. Court of Appeals for the Ninth Circuit",
        date: "2022-11-04",
        snippet: "Environmental penalties for repeated ballast water violations along the Pacific coast.",
        summary: "Grey Harbor Shipping challenged civil penalties imposed by the Coast Guard for ballast water violations. The Ninth Circuit upheld the fines, finding adequate notice and rejecting the company's due process claims.",
        fullText: "In 2022, the United States Court of Appeals for the Ninth Circuit reviewed sanctions imposed on Grey Harbor Shipping Co. for recurring ballast water discharge violations near Seattle and Long Beach. The panel held that the Coast Guard afforded Grey Harbor sufficient notice and opportunity to be heard, and that the civil penalties were within statutory limits. Judge Morales concurred in part, urging Congress to modernize ballast water standards.",
        entities: ["Grey Harbor Shipping Co.", "United States Court of Appeals for the Ninth Circuit", "Seattle", "Long Beach", "Coast Guard", "2022"]
    },
    {
        id: "case3",
        title: "Reynolds v. Alder Health Systems",
        court: "Supreme Court of Pennsylvania",
        date: "2021-09-18",
        snippet: "Addresses discoverability of hospital peer review materials in malpractice litigation.",
        summary: "The Court held that peer review documents remained privileged under Pennsylvania's Peer Review Protection Act, even when the hospital voluntarily disclosed summaries to regulators.",
        fullText: "Reynolds alleged negligent postoperative care at Alder Health Systems. During discovery, she sought peer review committee minutes. Alder withheld the materials, citing the Peer Review Protection Act. The Supreme Court of Pennsylvania ruled that the privilege was not waived by limited disclosures to the Department of Health, emphasizing the statutory goal of candid internal review.",
        entities: ["Reynolds", "Alder Health Systems", "Supreme Court of Pennsylvania", "Peer Review Protection Act", "Department of Health"]
    },
    {
        id: "case4",
        title: "People v. Choi",
        court: "New York Court of Appeals",
        date: "2020-02-10",
        snippet: "Limits the use of facial recognition matches as probable cause.",
        summary: "New York's highest court concluded that a facial recognition match alone cannot establish probable cause for arrest and must be corroborated.",
        fullText: "The New York Court of Appeals, on February 10, 2020, vacated the conviction of Daniel Choi after police relied solely on a facial recognition match to secure a warrant. The Court noted the technology's documented error rates and mandated independent corroboration. Judge Stein wrote the opinion, joined by five judges; Judge Garcia dissented.",
        entities: ["February 10, 2020", "New York Court of Appeals", "Daniel Choi", "Judge Stein", "Judge Garcia"]
    },
    {
        id: "case5",
        title: "Garcia v. City of Phoenix",
        court: "Arizona Supreme Court",
        date: "2022-03-07",
        snippet: "Public records request for police disciplinary files and privacy balancing.",
        summary: "The Arizona Supreme Court ordered partial disclosure of police disciplinary findings, applying a balancing test between officer privacy and public oversight.",
        fullText: "Garcia submitted public records requests to the City of Phoenix seeking officer discipline files. The city withheld records citing privacy. The Arizona Supreme Court held that summaries of sustained findings must be produced, with redactions to protect sensitive medical or family data. The Court emphasized the public's oversight interest following high-profile incidents in 2020.",
        entities: ["Arizona Supreme Court", "City of Phoenix", "Garcia", "2020", "public records"]
    },
    {
        id: "case6",
        title: "In re Baxter Data Breach Litigation",
        court: "U.S. District Court, N.D. Illinois",
        date: "2023-01-23",
        snippet: "Class standing in medical device breach affecting patient monitoring data.",
        summary: "The district court found Article III standing based on substantial risk of identity theft after unauthorized access to Baxter's patient monitoring portal.",
        fullText: "Multiple plaintiffs alleged that Baxter's remote patient monitoring platform was breached in August 2022. Judge Ellis of the Northern District of Illinois held that plaintiffs alleged a concrete risk of future harm and costs of mitigation. The court distinguished TransUnion, noting that data was actually accessed. Claims for negligence and breach of implied contract survived.",
        entities: ["Northern District of Illinois", "Judge Ellis", "August 2022", "Baxter", "TransUnion"]
    },
    {
        id: "case7",
        title: "Commonwealth v. Patel",
        court: "Supreme Judicial Court of Massachusetts",
        date: "2021-12-02",
        snippet: "Clarifies when roadside questioning constitutes custodial interrogation.",
        summary: "The Court held that brief roadside questioning about immigration status during a traffic stop was custodial and required Miranda warnings.",
        fullText: "On December 2, 2021, the Supreme Judicial Court considered whether Trooper Lane's questioning of Rishi Patel about immigration status during a routine stop amounted to custodial interrogation. The Court concluded that the questioning, combined with retention of documents and presence of multiple officers, triggered Miranda. Evidence obtained thereafter was suppressed.",
        entities: ["December 2, 2021", "Supreme Judicial Court", "Rishi Patel", "Trooper Lane", "Miranda"]
    },
    {
        id: "case8",
        title: "Harris v. Evergreen University",
        court: "U.S. Court of Appeals for the Fifth Circuit",
        date: "2019-08-16",
        snippet: "Title IX due process requirements for student discipline.",
        summary: "The Fifth Circuit vacated a suspension because Evergreen University denied the student access to key statements and cross-examination.",
        fullText: "In Harris v. Evergreen University, decided August 16, 2019, the Fifth Circuit held that public universities must provide meaningful opportunity to respond to adverse evidence in Title IX hearings. Evergreen withheld witness statements and barred cross-examination. The Court remanded for a new hearing consistent with due process.",
        entities: ["August 16, 2019", "Fifth Circuit", "Evergreen University", "Title IX", "Harris"]
    },
    {
        id: "case9",
        title: "Liu v. Meridian Insurance Co.",
        court: "Supreme Court of Washington",
        date: "2020-10-30",
        snippet: "Bad faith denial of wildfire coverage for small business interruption.",
        summary: "The Court found that Meridian acted in bad faith by denying business interruption claims after the 2020 wildfires without adequate investigation.",
        fullText: "Liu operated a caf√© in Wenatchee, Washington. After 2020 wildfires forced closure, Meridian Insurance denied coverage citing a smoke exclusion. The Supreme Court of Washington held that Meridian failed to investigate and misapplied the policy, constituting bad faith. Treble damages under the Insurance Fair Conduct Act were affirmed.",
        entities: ["Wenatchee", "Supreme Court of Washington", "2020", "Meridian Insurance", "Insurance Fair Conduct Act"]
    },
    {
        id: "case10",
        title: "Fernandez v. Metro Transit Authority",
        court: "U.S. Court of Appeals for the Second Circuit",
        date: "2022-05-19",
        snippet: "ADA reasonable accommodation for subway platform attendants.",
        summary: "The Second Circuit held that the MTA failed to reasonably accommodate Fernandez's visual impairment by denying adaptive technology.",
        fullText: "Fernandez, a platform attendant, requested magnification devices and schedule adjustments. The Metro Transit Authority denied the requests. On May 19, 2022, the Second Circuit reversed summary judgment, finding factual disputes on undue hardship and the essential functions of the position under the ADA.",
        entities: ["May 19, 2022", "Second Circuit", "ADA", "Metro Transit Authority", "Fernandez"]
    },
    {
        id: "case11",
        title: "Santos v. Redwood County",
        court: "Minnesota Supreme Court",
        date: "2021-04-09",
        snippet: "Equal protection challenge to cash-only bail schedule.",
        summary: "The Minnesota Supreme Court held that Redwood County's cash-only bail policy violated equal protection when applied mechanically without individualized findings.",
        fullText: "Santos was arrested for a misdemeanor and offered release only upon posting cash bail pursuant to a county schedule. The Minnesota Supreme Court held that the practice violated equal protection and the state constitution's bail clause. The Court required magistrates to consider non-monetary conditions and defendants' ability to pay.",
        entities: ["Minnesota Supreme Court", "Redwood County", "Santos", "equal protection"]
    },
    {
        id: "case12",
        title: "In re Algonquin Crypto Exchange",
        court: "Delaware Court of Chancery",
        date: "2023-09-01",
        snippet: "Appraisal rights and tokenized equity in a blockchain exchange failure.",
        summary: "Vice Chancellor Hart found that token holders were entitled to appraisal under Delaware law where tokens represented uncertificated stock interests.",
        fullText: "After Algonquin Crypto Exchange collapsed in 2023, minority token holders petitioned for appraisal, arguing that their tokens were the functional equivalent of uncertificated shares. Vice Chancellor Hart agreed, holding that the operating agreement and smart contract tied the tokens to equity. The Court ordered a traditional appraisal process, applying Weinberger and considering discounted cash flow despite the exchange's volatile revenues.",
        entities: ["Delaware Court of Chancery", "Vice Chancellor Hart", "2023", "Weinberger", "Algonquin Crypto Exchange"]
    }
];

let filteredCases = [...cases];
let selectedCaseId = null;
let currentTab = 'summary';
let highlightActive = false;
const notesKey = "vibelaw_notes_v1";
let notesStore = loadNotesStore();

const resultsList = document.getElementById("resultsList");
const detailTitle = document.getElementById("detailTitle");
const detailBody = document.getElementById("detailBody");
const detailMeta = document.getElementById("detailMeta");
const extractBtn = document.getElementById("extractBtn");
const statusMsg = document.getElementById("statusMsg");
const resultCount = document.getElementById("resultCount");
const notesList = document.getElementById("notesList");
const noteInput = document.getElementById("noteInput");

function loadNotesStore() {
    try {
        const stored = localStorage.getItem(notesKey);
        return stored ? JSON.parse(stored) : {};
    } catch {
        return {};
    }
}
function saveNotesStore() {
    localStorage.setItem(notesKey, JSON.stringify(notesStore));
}
function renderResults(list = filteredCases) {
    resultCount.textContent = `${list.length} cases`;
    resultsList.innerHTML = "";
    if (!list.length) {
        resultsList.innerHTML = `<div class="empty">No cases found. Try a different query.</div>`;
        return;
    }
    list.forEach(c => {
        const card = document.createElement("div");
        card.className = "result-card" + (c.id === selectedCaseId ? " active" : "");
        card.innerHTML = `
            <div class="result-title">${c.title}</div>
            <div class="meta"><span>${c.court}</span><span>${formatDate(c.date)}</span></div>
            <div class="snippet">${c.snippet}</div>
        `;
        card.addEventListener("click", () => selectCase(c.id));
        resultsList.appendChild(card);
    });
}
function selectCase(id) {
    selectedCaseId = id;
    highlightActive = false;
    statusMsg.textContent = "";
    extractBtn.classList.remove("active");
    updateActiveResult();
    renderDetail();
    renderNotes();
}
function updateActiveResult() {
    Array.from(document.querySelectorAll(".result-card")).forEach(el => {
        el.classList.toggle("active", el.querySelector(".result-title")?.textContent === (cases.find(c => c.id === selectedCaseId)?.title));
    });
}
function renderDetail() {
    const c = cases.find(x => x.id === selectedCaseId);
    if (!c) {
        detailTitle.textContent = "Select a case to view details";
        detailBody.textContent = "No case selected.";
        detailMeta.innerHTML = "";
        return;
    }
    detailTitle.textContent = c.title;
    detailMeta.innerHTML = `
        <div>üèõÔ∏è ${c.court}</div>
        <div>üìÖ ${formatDate(c.date)}</div>
    `;
    renderText(c);
}
function renderText(c) {
    const raw = currentTab === "summary" ? c.summary : c.fullText;
    if (highlightActive) {
        detailBody.innerHTML = highlightEntities(raw, c);
        statusMsg.textContent = "Entities highlighted.";
    } else {
        detailBody.innerHTML = raw.replace(/\n/g,"<br>");
        statusMsg.textContent = "";
    }
}
function formatDate(d) {
    if (!d) return "";
    try {
        const [y,m,day] = d.split("-");
        const date = new Date(Number(y), Number(m)-1, Number(day));
        return date.toLocaleDateString(undefined, {year:"numeric", month:"short", day:"numeric"});
    } catch {
        return d;
    }
}
function escapeRegExp(str) {
    return str.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
}
function highlightEntities(text, c) {
    let processed = text;
    (c.entities || []).forEach(ent => {
        const regex = new RegExp(escapeRegExp(ent), "g");
        processed = processed.replace(regex, `<span class="entity">${ent}</span>`);
    });
    processed = processed.replace(/\b(20\d{2}|19\d{2})\b/g, '<span class="entity">$1</span>');
    return processed.replace(/\n/g,"<br>");
}
function handleSearch(value) {
    const q = value.trim().toLowerCase();
    if (!q) {
        filteredCases = [...cases];
    } else {
        filteredCases = cases.filter(c =>
            c.title.toLowerCase().includes(q) ||
            c.court.toLowerCase().includes(q) ||
            c.snippet.toLowerCase().includes(q) ||
            c.summary.toLowerCase().includes(q) ||
            c.fullText.toLowerCase().includes(q)
        );
    }
    renderResults();
    if (filteredCases.length && (!selectedCaseId || !filteredCases.find(c => c.id === selectedCaseId))) {
        selectCase(filteredCases[0].id);
    }
}
function renderNotes() {
    const c = cases.find(x => x.id === selectedCaseId);
    notesList.innerHTML = "";
    if (!c) {
        notesList.innerHTML = `<div class="empty">Select a case to view and save notes.</div>`;
        return;
    }
    const list = notesStore[c.id] || [];
    if (!list.length) {
        notesList.innerHTML = `<div class="empty">No notes yet. Highlight text and save a snippet.</div>`;
        return;
    }
    list.forEach(n => {
        const div = document.createElement("div");
        div.className = "note-card";
        const date = new Date(n.ts);
        div.innerHTML = `
            <div class="meta-line"><span>${date.toLocaleString()}</span><button class="note-btn" style="padding:4px 8px;font-size:11px;">Delete</button></div>
            <div style="margin-top:6px;white-space:pre-wrap;">${n.text}</div>
        `;
        div.querySelector("button").addEventListener("click", () => {
            deleteNote(c.id, n.id);
        });
        notesList.appendChild(div);
    });
}
function addNote(text) {
    const c = cases.find(x => x.id === selectedCaseId);
    if (!c) return;
    const t = text.trim();
    if (!t) {
        statusMsg.textContent = "Cannot save empty note.";
        return;
    }
    const entry = { id: Date.now().toString(), text: t, ts: Date.now() };
    if (!notesStore[c.id]) notesStore[c.id] = [];
    notesStore[c.id].unshift(entry);
    saveNotesStore();
    noteInput.value = "";
    renderNotes();
    statusMsg.textContent = "Note saved.";
}
function deleteNote(caseId, noteId) {
    notesStore[caseId] = (notesStore[caseId] || []).filter(n => n.id !== noteId);
    saveNotesStore();
    renderNotes();
}
function clearNotes() {
    const c = cases.find(x => x.id === selectedCaseId);
    if (!c) return;
    if (confirm("Clear all notes for this case?")) {
        notesStore[c.id] = [];
        saveNotesStore();
        renderNotes();
    }
}
document.getElementById("searchInput").addEventListener("input", e => handleSearch(e.target.value));
document.querySelectorAll(".tab-btn").forEach(btn => {
    btn.addEventListener("click", () => {
        document.querySelectorAll(".tab-btn").forEach(b => b.classList.remove("active"));
        btn.classList.add("active");
        currentTab = btn.dataset.tab;
        highlightActive = false;
        extractBtn.classList.remove("active");
        renderDetail();
    });
});
extractBtn.addEventListener("click", () => {
    const c = cases.find(x => x.id === selectedCaseId);
    if (!c) return;
    highlightActive = !highlightActive;
    extractBtn.classList.toggle("active", highlightActive);
    renderText(c);
});
document.getElementById("saveNoteBtn").addEventListener("click", () => {
    addNote(noteInput.value);
});
document.getElementById("saveSelectionBtn").addEventListener("click", () => {
    const selection = window.getSelection();
    const text = selection ? selection.toString() : "";
    if (!text.trim()) {
        statusMsg.textContent = "Select text in the detail view first.";
        return;
    }
    addNote(text);
    selection.removeAllRanges();
});
document.getElementById("clearNotesBtn").addEventListener("click", clearNotes);

function init() {
    renderResults();
    if (filteredCases.length) {
        selectCase(filteredCases[0].id);
    }
}
init();
</script>
</body>
</html>