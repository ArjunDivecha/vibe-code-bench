<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Markdown Editor</title>
<style>
:root {
    --bg: #f4f4f6;
    --panel: #ffffff;
    --text: #1f1f1f;
    --accent: #4b7bec;
    --border: #d0d0d5;
    --muted: #666;
    --code-bg: #f0f0f2;
}
body.dark {
    --bg: #0f1116;
    --panel: #161a21;
    --text: #e6e6ea;
    --accent: #a29bfe;
    --border: #2a2f3a;
    --muted: #9aa0ad;
    --code-bg: #1f2633;
}
* { box-sizing: border-box; }
body {
    margin: 0;
    font-family: "Segoe UI", system-ui, -apple-system, sans-serif;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    display: flex;
    flex-direction: column;
}
header {
    padding: 16px 20px;
    background: var(--panel);
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: center;
    gap: 12px;
    position: sticky;
    top: 0;
    z-index: 10;
}
h1 {
    margin: 0;
    font-size: 18px;
    font-weight: 700;
    letter-spacing: 0.2px;
}
.spacer {
    flex: 1;
}
button {
    border: 1px solid var(--border);
    background: var(--panel);
    color: var(--text);
    padding: 8px 12px;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.15s ease;
    font-weight: 600;
}
button:hover {
    border-color: var(--accent);
    color: var(--accent);
}
button.primary {
    background: var(--accent);
    color: #fff;
    border-color: var(--accent);
}
button.primary:hover {
    filter: brightness(0.95);
}
#container {
    flex: 1;
    display: grid;
    grid-template-columns: 1fr 1fr;
    min-height: 0;
}
.panel {
    padding: 16px;
    background: var(--panel);
    border-right: 1px solid var(--border);
    overflow: auto;
}
.panel:last-child {
    border-right: none;
}
label {
    font-size: 13px;
    color: var(--muted);
    display: block;
    margin-bottom: 8px;
}
#editor {
    width: 100%;
    height: calc(100vh - 120px);
    resize: none;
    border-radius: 10px;
    border: 1px solid var(--border);
    padding: 12px;
    font-family: "Fira Code", "Consolas", monospace;
    font-size: 15px;
    color: var(--text);
    background: var(--bg);
}
#preview {
    min-height: calc(100vh - 120px);
    padding: 12px;
    border-radius: 10px;
    border: 1px solid var(--border);
    background: var(--bg);
    color: var(--text);
}
#preview h1,#preview h2,#preview h3,#preview h4,#preview h5,#preview h6 {
    margin-top: 0;
}
#preview p {
    line-height: 1.6;
}
#preview ul, #preview ol {
    padding-left: 24px;
}
#preview blockquote {
    margin: 12px 0;
    padding: 10px 14px;
    border-left: 4px solid var(--accent);
    background: rgba(75,126,236,0.08);
}
body.dark #preview blockquote {
    background: rgba(162,155,254,0.08);
}
#preview pre {
    background: var(--code-bg);
    padding: 12px;
    border-radius: 8px;
    overflow-x: auto;
}
#preview code {
    font-family: "Fira Code", monospace;
}
.status {
    font-size: 12px;
    color: var(--muted);
}
.controls-group {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
    align-items: center;
}
</style>
</head>
<body>
<header>
    <h1>Markdown Editor</h1>
    <div class="controls-group">
        <button id="saveBtn">Save</button>
        <button id="loadBtn">Load</button>
        <button id="exportBtn" class="primary">Export HTML</button>
    </div>
    <div class="spacer"></div>
    <div class="controls-group">
        <span class="status" id="status">Unsaved</span>
        <button id="themeBtn">Toggle Dark Mode</button>
    </div>
</header>

<div id="container">
    <div class="panel">
        <label for="editor">Markdown</label>
        <textarea id="editor" spellcheck="false"></textarea>
    </div>
    <div class="panel">
        <label>Preview</label>
        <div id="preview"></div>
    </div>
</div>

<script>
(function() {
    const editor = document.getElementById('editor');
    const preview = document.getElementById('preview');
    const saveBtn = document.getElementById('saveBtn');
    const loadBtn = document.getElementById('loadBtn');
    const exportBtn = document.getElementById('exportBtn');
    const status = document.getElementById('status');
    const themeBtn = document.getElementById('themeBtn');
    const STORAGE_KEY = 'markdown-editor-content';
    const THEME_KEY = 'markdown-editor-theme';

    function escapeHtml(str) {
        return str.replace(/&/g, '&amp;')
                  .replace(/</g, '&lt;')
                  .replace(/>/g, '&gt;')
                  .replace(/"/g, '&quot;')
                  .replace(/'/g, '&#39;');
    }

    function parseInline(str) {
        let text = escapeHtml(str);
        text = text.replace(/\[([^\]]+)\]\(([^)]+)\)/g, (m, label, url) => {
            return `<a href="${escapeHtml(url)}" target="_blank" rel="noopener noreferrer">${label}</a>`;
        });
        text = text.replace(/\*\*(.+?)\*\*/g, (m, bold) => `<strong>${bold}</strong>`);
        text = text.replace(/\*(.+?)\*/g, (m, em) => `<em>${em}</em>`);
        return text;
    }

    function markdownToHtml(md) {
        const lines = md.replace(/\r\n?/g, '\n').split('\n');
        const html = [];
        let inCode = false;
        let codeLines = [];
        let listType = null;

        function closeList() {
            if (listType) {
                html.push(listType === 'ul' ? '</ul>' : '</ol>');
                listType = null;
            }
        }

        for (let line of lines) {
            if (line.trim().startsWith('```')) {
                if (inCode) {
                    html.push('<pre><code>' + escapeHtml(codeLines.join('\n')) + '</code></pre>');
                    codeLines = [];
                    inCode = false;
                } else {
                    closeList();
                    inCode = true;
                }
                continue;
            }

            if (inCode) {
                codeLines.push(line);
                continue;
            }

            const bullet = line.match(/^\s*[-+*]\s+(.*)/);
            const ordered = line.match(/^\s*\d+\.\s+(.*)/);

            if (bullet) {
                if (listType !== 'ul') {
                    closeList();
                    listType = 'ul';
                    html.push('<ul>');
                }
                html.push('<li>' + parseInline(bullet[1]) + '</li>');
                continue;
            } else if (ordered) {
                if (listType !== 'ol') {
                    closeList();
                    listType = 'ol';
                    html.push('<ol>');
                }
                html.push('<li>' + parseInline(ordered[1]) + '</li>');
                continue;
            } else {
                closeList();
            }

            if (line.trim() === '') {
                html.push('');
                continue;
            }

            const blockquote = line.match(/^\s*>\s?(.*)/);
            if (blockquote) {
                html.push('<blockquote>' + parseInline(blockquote[1]) + '</blockquote>');
                continue;
            }

            const header = line.match(/^\s{0,3}(#{1,6})\s+(.*)/);
            if (header) {
                const level = header[1].length;
                html.push('<h' + level + '>' + parseInline(header[2]) + '</h' + level + '>');
                continue;
            }

            html.push('<p>' + parseInline(line.trim()) + '</p>');
        }

        if (inCode) {
            html.push('<pre><code>' + escapeHtml(codeLines.join('\n')) + '</code></pre>');
        }
        closeList();
        return html.join('\n');
    }

    function render() {
        const md = editor.value;
        preview.innerHTML = markdownToHtml(md);
        status.textContent = 'Unsaved changes';
    }

    function saveContent() {
        localStorage.setItem(STORAGE_KEY, editor.value);
        status.textContent = 'Saved';
    }

    function loadContent() {
        const saved = localStorage.getItem(STORAGE_KEY);
        if (saved !== null) {
            editor.value = saved;
            render();
            status.textContent = 'Loaded from storage';
        } else {
            status.textContent = 'Nothing saved yet';
        }
    }

    function setTheme(mode) {
        document.body.classList.toggle('dark', mode === 'dark');
        localStorage.setItem(THEME_KEY, mode);
        themeBtn.textContent = mode === 'dark' ? 'Light Mode' : 'Dark Mode';
    }

    function toggleTheme() {
        const isDark = document.body.classList.contains('dark');
        setTheme(isDark ? 'light' : 'dark');
    }

    function exportHtml() {
        const content = markdownToHtml(editor.value);
        const htmlDoc = `<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Exported Markdown</title>
<style>
body { font-family: Arial, sans-serif; padding: 20px; line-height: 1.6; }
pre { background: #f0f0f2; padding: 12px; border-radius: 8px; }
blockquote { border-left: 4px solid #4b7bec; margin: 12px 0; padding: 10px 14px; background: rgba(75,126,236,0.08); }
</style>
</head>
<body>
${content}
</body>
</html>`;
        const blob = new Blob([htmlDoc], { type: 'text/html' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'document.html';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
    }

    editor.addEventListener('input', () => {
        render();
        localStorage.setItem(STORAGE_KEY, editor.value);
    });
    saveBtn.addEventListener('click', saveContent);
    loadBtn.addEventListener('click', loadContent);
    exportBtn.addEventListener('click', exportHtml);
    themeBtn.addEventListener('click', toggleTheme);

    // Initialize theme
    const savedTheme = localStorage.getItem(THEME_KEY) || 'light';
    setTheme(savedTheme);

    const defaultText = `# Welcome to the Markdown Editor

Easily write **bold** or *italic* text, and add [links](https://example.com).

## Lists
- Item one
- Item two
- Item three

1. First
2. Second
3. Third

## Blockquote
> Markdown makes writing notes delightful.

## Code Block
\`\`\`
function hello() {
    console.log("Hello, Markdown!");
}
\`\`\`

Enjoy writing!`;

    // Load saved content if any, otherwise default
    const saved = localStorage.getItem(STORAGE_KEY);
    editor.value = saved !== null ? saved : defaultText;
    render();
})();
</script>
</body>
</html>