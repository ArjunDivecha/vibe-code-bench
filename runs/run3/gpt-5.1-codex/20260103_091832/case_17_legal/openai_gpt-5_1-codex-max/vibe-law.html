<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Vibe-Law | Legal Case Search Workspace</title>
<style>
    :root {
        --bg: #0c1524;
        --bg-alt: #111a2d;
        --panel: #131f32;
        --accent: #4db0ff;
        --accent-2: #7de0c6;
        --text: #e7eefc;
        --muted: #9bb0d3;
        --border: #1f2c44;
        --card: #17263d;
        --danger: #ff6b6b;
    }
    * { box-sizing: border-box; }
    body {
        margin: 0;
        font-family: "Inter", "Segoe UI", system-ui, -apple-system, sans-serif;
        background: radial-gradient(circle at 20% 20%, rgba(77,176,255,0.06), transparent 25%),
                    radial-gradient(circle at 80% 10%, rgba(125,224,198,0.07), transparent 28%),
                    var(--bg);
        color: var(--text);
        min-height: 100vh;
        display: flex;
        flex-direction: column;
    }
    header {
        padding: 18px 24px;
        border-bottom: 1px solid var(--border);
        display: flex;
        align-items: center;
        gap: 14px;
        background: rgba(12,21,36,0.92);
        backdrop-filter: blur(8px);
        position: sticky;
        top: 0;
        z-index: 20;
    }
    .logo {
        font-weight: 800;
        letter-spacing: 0.5px;
        font-size: 1.1rem;
        color: var(--accent);
    }
    .search-box {
        flex: 1;
        position: relative;
    }
    .search-box input {
        width: 100%;
        padding: 12px 14px 12px 42px;
        border-radius: 12px;
        border: 1px solid var(--border);
        background: var(--panel);
        color: var(--text);
        outline: none;
        font-size: 0.98rem;
        transition: border 0.15s, box-shadow 0.15s;
    }
    .search-box input:focus {
        border-color: var(--accent);
        box-shadow: 0 0 0 3px rgba(77,176,255,0.12);
    }
    .search-icon {
        position: absolute;
        left: 14px;
        top: 50%;
        transform: translateY(-50%);
        color: var(--muted);
        font-size: 1rem;
    }
    main {
        display: grid;
        grid-template-columns: 38% 62%;
        flex: 1;
        overflow: hidden;
    }
    @media (max-width: 1000px) {
        main { grid-template-columns: 1fr; }
        .detail { border-left: none; border-top: 1px solid var(--border); }
    }
    .results {
        overflow-y: auto;
        border-right: 1px solid var(--border);
        padding: 14px 16px 120px;
        background: rgba(17,26,45,0.82);
    }
    .result-card {
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: 12px;
        padding: 14px 14px 12px;
        margin-bottom: 12px;
        cursor: pointer;
        transition: border 0.12s, transform 0.12s, box-shadow 0.12s;
    }
    .result-card:hover {
        border-color: var(--accent);
        transform: translateY(-1px);
        box-shadow: 0 10px 30px rgba(0,0,0,0.18);
    }
    .result-card.active {
        border-color: var(--accent-2);
        box-shadow: 0 0 0 2px rgba(125,224,198,0.18);
    }
    .case-title { font-weight: 700; font-size: 1rem; margin-bottom: 4px; }
    .case-meta {
        display: flex;
        gap: 10px;
        font-size: 0.82rem;
        color: var(--muted);
        margin-bottom: 8px;
    }
    .case-snippet {
        font-size: 0.9rem;
        color: #d7e5ff;
        line-height: 1.45;
    }
    .detail {
        padding: 16px 18px 12px;
        overflow: hidden;
        display: flex;
        flex-direction: column;
        background: linear-gradient(160deg, rgba(19,31,50,0.92), rgba(12,21,36,0.96));
    }
    .detail-head {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 8px;
        border-bottom: 1px solid var(--border);
        padding-bottom: 12px;
    }
    .detail-info {
        display: flex;
        flex-direction: column;
        gap: 6px;
    }
    .detail-title { font-size: 1.25rem; font-weight: 800; }
    .detail-meta { display: flex; gap: 12px; color: var(--muted); font-size: 0.88rem;}
    .badge {
        padding: 2px 8px;
        border-radius: 10px;
        background: rgba(77,176,255,0.12);
        color: var(--accent);
        border: 1px solid rgba(77,176,255,0.18);
    }
    .tab-bar {
        display: flex;
        gap: 8px;
        margin: 12px 0;
        border-bottom: 1px solid var(--border);
    }
    .tab {
        padding: 8px 12px;
        border-radius: 8px 8px 0 0;
        border: 1px solid transparent;
        cursor: pointer;
        color: var(--muted);
        font-weight: 600;
        transition: all 0.12s;
    }
    .tab.active {
        color: var(--accent);
        border-color: var(--border);
        border-bottom-color: transparent;
        background: var(--panel);
    }
    .content-area {
        flex: 1;
        position: relative;
        display: grid;
        grid-template-columns: minmax(0, 2fr) 320px;
        gap: 12px;
        min-height: 0;
    }
    @media (max-width: 1100px) {
        .content-area { grid-template-columns: 1fr; }
    }
    .text-pane {
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: 12px;
        padding: 14px;
        overflow-y: auto;
        line-height: 1.6;
        font-size: 0.97rem;
    }
    .text-pane mark {
        background: rgba(255, 221, 87, 0.28);
        color: #ffeaaa;
        padding: 1px 2px;
        border-radius: 4px;
    }
    .actions {
        display: flex;
        gap: 10px;
        align-items: center;
    }
    button {
        border: 1px solid var(--border);
        background: var(--panel);
        color: var(--text);
        padding: 10px 12px;
        border-radius: 10px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.12s;
    }
    button:hover { border-color: var(--accent); color: var(--accent); }
    .notes {
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: 12px;
        display: flex;
        flex-direction: column;
        padding: 12px;
        min-height: 0;
    }
    .notes h3 { margin: 4px 0 8px; font-size: 1rem; }
    .notes textarea {
        width: 100%;
        min-height: 80px;
        border-radius: 10px;
        border: 1px solid var(--border);
        background: var(--panel);
        color: var(--text);
        padding: 10px;
        resize: vertical;
        font-size: 0.94rem;
        outline: none;
    }
    .notes-list {
        margin-top: 8px;
        overflow-y: auto;
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: 8px;
    }
    .note-item {
        border: 1px solid var(--border);
        background: rgba(255,255,255,0.02);
        padding: 10px;
        border-radius: 10px;
        position: relative;
        font-size: 0.9rem;
        color: #e6f0ff;
    }
    .note-item button {
        position: absolute;
        top: 6px;
        right: 6px;
        padding: 4px 8px;
        font-size: 0.75rem;
        color: var(--danger);
        border-color: rgba(255,107,107,0.4);
    }
    .pill {
        display: inline-block;
        padding: 2px 8px;
        border-radius: 10px;
        background: rgba(125,224,198,0.15);
        color: var(--accent-2);
        font-size: 0.78rem;
        border: 1px solid rgba(125,224,198,0.26);
        margin-left: 8px;
    }
    .empty-state {
        color: var(--muted);
        text-align: center;
        margin-top: 30px;
    }
    ::-webkit-scrollbar { width: 10px; height: 10px; }
    ::-webkit-scrollbar-track { background: var(--bg-alt); }
    ::-webkit-scrollbar-thumb { background: #20314e; border-radius: 8px; }
    ::selection { background: rgba(77,176,255,0.25); }
</style>
</head>
<body>
<header>
    <div class="logo">Vibe-Law</div>
    <div class="search-box">
        <span class="search-icon">üîç</span>
        <input id="search" type="text" placeholder="Search case titles, courts, or text..." autocomplete="off">
    </div>
</header>

<main>
    <section class="results" id="results"></section>
    <section class="detail">
        <div class="detail-head">
            <div class="detail-info">
                <div class="detail-title" id="detailTitle">Select a case to view details</div>
                <div class="detail-meta" id="detailMeta"></div>
            </div>
            <div class="actions">
                <button id="extractBtn" disabled>Extract Entities</button>
                <button id="saveSelectionBtn" disabled>Save Selection</button>
            </div>
        </div>
        <div class="tab-bar">
            <div class="tab active" data-tab="summary">Summary</div>
            <div class="tab" data-tab="full">Full Text</div>
        </div>
        <div class="content-area">
            <div class="text-pane" id="textPane"></div>
            <aside class="notes">
                <div style="display:flex;align-items:center;justify-content:space-between;">
                    <h3>Notes</h3>
                    <span class="pill" id="noteCaseLabel">No case</span>
                </div>
                <textarea id="noteInput" placeholder="Type a note or highlight text and click 'Save Selection'..." disabled></textarea>
                <button id="addNoteBtn" disabled style="margin-top:8px;">Add Note</button>
                <div class="notes-list" id="notesList"></div>
            </aside>
        </div>
    </section>
</main>

<script>
const cases = [
    {
        id: 'CL-001',
        title: 'Rivera v. Northwind Logistics',
        court: '2nd Cir.',
        date: '2022-03-18',
        summary: 'Dispute over employment classification of delivery drivers. The panel affirmed that drivers were employees, not contractors, applying the economic reality test.',
        fullText: `Rivera brought a class action alleging misclassification by Northwind Logistics. The district court applied the economic reality test factors: degree of control, opportunity for profit or loss, investment in equipment, skill required, permanence of relationship, and integral nature of the service. The court found Northwind exercised substantial control and the drivers were integral to the business. Judgment affirmed on March 18, 2022.`
    },
    {
        id: 'CL-002',
        title: 'State of Columbia v. Horizon Tech',
        court: 'Supreme Ct. Columbia',
        date: '2021-11-02',
        summary: 'Consumer protection enforcement action regarding data privacy disclosures. Court imposed civil penalties and injunctive relief.',
        fullText: `The Attorney General filed suit on April 14, 2020, alleging deceptive practices under the Columbia Consumer Protection Act. Horizon Tech failed to adequately disclose data collection. On November 02, 2021, the Supreme Court upheld penalties totaling $8.5 million and ordered compliance monitoring for three years.`
    },
    {
        id: 'CL-003',
        title: 'Garcia v. Metro Transit Authority',
        court: 'N.Y. Ct. App.',
        date: '2020-06-30',
        summary: 'Slip-and-fall claim on subway platform. Court reversed for failure to prove notice of hazard.',
        fullText: `Garcia alleged negligence after slipping on a wet platform on June 12, 2017. The MTA moved for summary judgment. The record lacked evidence of actual or constructive notice of the condition. The Court of Appeals reversed the intermediate appellate ruling and dismissed the complaint on June 30, 2020.`
    },
    {
        id: 'CL-004',
        title: 'United States v. Lenox Pharmaceuticals',
        court: '9th Cir.',
        date: '2019-09-10',
        summary: 'False Claims Act case alleging off-label marketing. Verdict for government affirmed.',
        fullText: `Lenox Pharmaceuticals appealed a jury verdict under the False Claims Act. Evidence showed sales representatives promoted off-label uses leading to claims submitted to Medicare and Medicaid. The Ninth Circuit on September 10, 2019, upheld the judgment, finding sufficient scienter and materiality.`
    },
    {
        id: 'CL-005',
        title: 'Patel v. City of Briarwood',
        court: '5th Cir.',
        date: '2018-12-04',
        summary: 'First Amendment retaliation claim by city employee. Court remanded for further fact-finding.',
        fullText: `Patel, a code inspector, alleged termination in retaliation for whistleblowing. The district court granted summary judgment. The Fifth Circuit on December 04, 2018, held disputed facts regarding speech as citizen versus employee required trial.`
    },
    {
        id: 'CL-006',
        title: 'Evergreen Solar v. Helios Components',
        court: 'Del. Ch.',
        date: '2023-01-27',
        summary: 'M&A earn-out dispute. Court enforced measurement provisions and awarded contingent payment.',
        fullText: `The merger agreement included an earn-out based on EBITDA for fiscal year 2022. Helios argued accounting adjustments reduced EBITDA below threshold. The Court of Chancery on January 27, 2023, found the adjustments inconsistent with GAAP and ordered payment of $35 million plus interest.`
    },
    {
        id: 'CL-007',
        title: 'In re Meridian Data Breach Litigation',
        court: 'N.D. Cal.',
        date: '2022-08-15',
        summary: 'Class action settlement arising from data breach. Court approved settlement and fee award.',
        fullText: `Plaintiffs alleged Meridian failed to implement reasonable security controls. After mediation, parties reached settlement providing credit monitoring and cash payments. On August 15, 2022, the district court granted final approval and awarded fees based on the percentage-of-the-fund method.`
    },
    {
        id: 'CL-008',
        title: 'Olsen v. Summit Airlines',
        court: 'D. Mass.',
        date: '2020-02-05',
        summary: 'ADA accommodation claim by pilot. Court granted partial summary judgment for plaintiff.',
        fullText: `Olsen requested modified flight schedules due to medical condition. Summit denied the request citing seniority rules. The court found on February 05, 2020, that reasonable accommodations were not adequately explored, granting partial summary judgment on liability.`
    },
    {
        id: 'CL-009',
        title: 'Harper v. Inland Insurance',
        court: '7th Cir.',
        date: '2021-05-19',
        summary: 'Bad faith denial of coverage. Jury verdict reversed for erroneous jury instruction.',
        fullText: `Harper claimed Inland denied a fire loss claim in bad faith. The trial court instructed the jury on an improper standard. On May 19, 2021, the Seventh Circuit reversed and remanded for a new trial with correct instructions on unreasonable denial.`
    },
    {
        id: 'CL-010',
        title: 'City of Aurora v. Westlake Construction',
        court: 'Colo. Sup. Ct.',
        date: '2019-03-08',
        summary: 'Public contract dispute over delay penalties. Court enforced liquidated damages clause.',
        fullText: `Westlake challenged liquidated damages assessed for project delays. The Colorado Supreme Court on March 08, 2019, upheld the clause as a reasonable forecast of harm and not a penalty, affirming judgment for the City.`
    },
    {
        id: 'CL-011',
        title: 'Khan v. Brightview Health',
        court: '11th Cir.',
        date: '2022-10-12',
        summary: 'Title VII retaliation. Court affirmed summary judgment due to lack of causal connection.',
        fullText: `Khan alleged retaliation following complaints of discrimination. Temporal gap and intervening performance issues broke causal chain. The Eleventh Circuit affirmed on October 12, 2022.`
    },
    {
        id: 'CL-012',
        title: 'Fernandez v. Apex Robotics',
        court: 'Fed. Cir.',
        date: '2023-04-03',
        summary: 'Patent infringement involving robotic grippers. Injunction vacated for lack of likelihood of success.',
        fullText: `Apex moved to dissolve a preliminary injunction. The Federal Circuit on April 03, 2023, held Fernandez failed to show likelihood of success on infringement of claim 12 and vacated the injunction.`
    },
    {
        id: 'CL-013',
        title: 'United States v. Dalton',
        court: 'D.C. Cir.',
        date: '2018-07-21',
        summary: 'Fourth Amendment challenge to cell-site simulators. Evidence suppressed.',
        fullText: `Dalton moved to suppress evidence obtained via a Stingray device without a warrant. The D.C. Circuit on July 21, 2018, held the use constituted a search requiring a warrant and suppressed the resulting evidence.`
    },
    {
        id: 'CL-014',
        title: 'Mendez v. Coastal Resorts',
        court: 'Cal. Ct. App.',
        date: '2021-09-30',
        summary: 'Wage-and-hour claim for unpaid overtime. PAGA penalties reduced as excessive.',
        fullText: `The appellate court on September 30, 2021, affirmed liability for overtime violations but reduced PAGA penalties under the excessive fines clause, remanding for recalculation.`
    },
    {
        id: 'CL-015',
        title: 'Sato v. Harborview Bank',
        court: 'Wash. Sup. Ct.',
        date: '2020-12-11',
        summary: 'Dispute over electronic funds transfer reversal. Bank found liable for violating UCC Article 4A.',
        fullText: `Harborview reversed an electronic funds transfer without authorization. The Washington Supreme Court on December 11, 2020, held the reversal violated UCC Article 4A and awarded consequential damages to Sato.`
    }
];

// Elements
const resultsEl = document.getElementById('results');
const searchEl = document.getElementById('search');
const detailTitleEl = document.getElementById('detailTitle');
const detailMetaEl = document.getElementById('detailMeta');
const textPaneEl = document.getElementById('textPane');
const extractBtn = document.getElementById('extractBtn');
const addNoteBtn = document.getElementById('addNoteBtn');
const noteInput = document.getElementById('noteInput');
const notesList = document.getElementById('notesList');
const noteCaseLabel = document.getElementById('noteCaseLabel');
const saveSelectionBtn = document.getElementById('saveSelectionBtn');
const tabs = document.querySelectorAll('.tab');

let currentCase = null;
let currentTab = 'summary';

function renderResults(list) {
    resultsEl.innerHTML = '';
    if (!list.length) {
        resultsEl.innerHTML = `<div class="empty-state">No cases match your query.</div>`;
        return;
    }
    list.forEach(item => {
        const card = document.createElement('div');
        card.className = 'result-card';
        card.dataset.id = item.id;
        card.innerHTML = `
            <div class="case-title">${item.title}</div>
            <div class="case-meta">
                <span>${item.court}</span>
                <span>‚Ä¢</span>
                <span>${item.date}</span>
            </div>
            <div class="case-snippet">${highlightTerms(item.summary, searchEl.value)}</div>
        `;
        card.addEventListener('click', () => openCase(item.id));
        resultsEl.appendChild(card);
    });
}

function highlightTerms(text, query) {
    if (!query.trim()) return text;
    const escaped = query.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
    try {
        const re = new RegExp(`(${escaped})`, 'gi');
        return text.replace(re, '<mark>$1</mark>');
    } catch {
        return text;
    }
}

function openCase(id) {
    const item = cases.find(c => c.id === id);
    if (!item) return;
    currentCase = item;
    updateActiveCard();
    detailTitleEl.textContent = item.title;
    detailMetaEl.innerHTML = `
        <span class="badge">${item.court}</span>
        <span>${item.date}</span>
        <span class="pill">${item.id}</span>
    `;
    noteCaseLabel.textContent = item.id;
    enableInteractions(true);
    renderText();
    loadNotes();
}

function renderText() {
    if (!currentCase) {
        textPaneEl.innerHTML = `<div class="empty-state">Select a case to view content.</div>`;
        return;
    }
    const content = currentTab === 'summary' ? currentCase.summary : currentCase.fullText;
    textPaneEl.innerHTML = content;
}

function enableInteractions(enable) {
    extractBtn.disabled = !enable;
    addNoteBtn.disabled = !enable;
    noteInput.disabled = !enable;
    saveSelectionBtn.disabled = !enable;
}

function updateActiveCard() {
    document.querySelectorAll('.result-card').forEach(card => {
        card.classList.toggle('active', card.dataset.id === currentCase?.id);
    });
}

function filterResults() {
    const q = searchEl.value.trim().toLowerCase();
    const filtered = cases.filter(c =>
        c.title.toLowerCase().includes(q) ||
        c.court.toLowerCase().includes(q) ||
        c.summary.toLowerCase().includes(q) ||
        c.fullText.toLowerCase().includes(q)
    );
    renderResults(filtered);
}

function extractEntities() {
    if (!currentCase) return;
    const text = currentTab === 'summary' ? currentCase.summary : currentCase.fullText;
    const highlighted = highlightEntities(text);
    textPaneEl.innerHTML = highlighted;
}

function highlightEntities(text) {
    // Simple regex for dates (Month DD, YYYY or YYYY-MM-DD) and capitalized names/organizations
    const datePattern = /\b(?:Jan(?:uary)?|Feb(?:ruary)?|Mar(?:ch)?|Apr(?:il)?|May|Jun(?:e)?|Jul(?:y)?|Aug(?:ust)?|Sep(?:t(?:ember)?)?|Oct(?:ober)?|Nov(?:ember)?|Dec(?:ember)?)[ ]\d{1,2},[ ]\d{4}\b|\b\d{4}-\d{2}-\d{2}\b/g;
    const namePattern = /\b([A-Z][a-z]+(?:\s[A-Z][a-z]+)+)\b/g;
    const uniqueMarks = new Set();
    let result = text.replace(datePattern, m => {
        uniqueMarks.add(m);
        return `<mark>${m}</mark>`;
    });
    result = result.replace(namePattern, m => {
        if (uniqueMarks.has(m)) return m; // prevent double
        uniqueMarks.add(m);
        return `<mark>${m}</mark>`;
    });
    return result;
}

function addNote(fromSelection=false) {
    if (!currentCase) return;
    const key = 'vibelaw-notes';
    const storage = JSON.parse(localStorage.getItem(key) || '{}');
    const noteText = fromSelection ? getSelectionText() : noteInput.value.trim();
    if (!noteText) return;
    const entry = { id: Date.now(), text: noteText, ts: new Date().toISOString() };
    if (!storage[currentCase.id]) storage[currentCase.id] = [];
    storage[currentCase.id].unshift(entry);
    localStorage.setItem(key, JSON.stringify(storage));
    noteInput.value = '';
    loadNotes();
}

function loadNotes() {
    notesList.innerHTML = '';
    const storage = JSON.parse(localStorage.getItem('vibelaw-notes') || '{}');
    const list = storage[currentCase?.id] || [];
    if (!list.length) {
        notesList.innerHTML = `<div class="empty-state" style="font-size:0.9rem;">No notes yet.</div>`;
        return;
    }
    list.forEach(n => {
        const item = document.createElement('div');
        item.className = 'note-item';
        const date = new Date(n.ts).toLocaleString();
        item.innerHTML = `<div style="color:${'var(--muted)'};font-size:0.78rem;margin-bottom:4px;">${date}</div>${n.text}`;
        const del = document.createElement('button');
        del.textContent = 'Delete';
        del.addEventListener('click', () => deleteNote(n.id));
        item.appendChild(del);
        notesList.appendChild(item);
    });
}

function deleteNote(id) {
    if (!currentCase) return;
    const key = 'vibelaw-notes';
    const storage = JSON.parse(localStorage.getItem(key) || '{}');
    storage[currentCase.id] = (storage[currentCase.id] || []).filter(n => n.id !== id);
    localStorage.setItem(key, JSON.stringify(storage));
    loadNotes();
}

function getSelectionText() {
    const sel = window.getSelection();
    return sel ? sel.toString().trim() : '';
}

// Event wiring
searchEl.addEventListener('input', filterResults);
extractBtn.addEventListener('click', extractEntities);
addNoteBtn.addEventListener('click', () => addNote(false));
saveSelectionBtn.addEventListener('click', () => {
    const sel = getSelectionText();
    if (!sel) {
        alert('Highlight text in the detail pane to save.');
        return;
    }
    addNote(true);
});

tabs.forEach(tab => {
    tab.addEventListener('click', () => {
        tabs.forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        currentTab = tab.dataset.tab === 'full' ? 'full' : 'summary';
        renderText();
    });
});

// Initialize
renderResults(cases);
renderText();
</script>
</body>
</html>