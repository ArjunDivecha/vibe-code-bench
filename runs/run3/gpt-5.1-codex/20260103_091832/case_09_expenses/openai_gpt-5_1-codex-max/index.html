<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Expense Tracker</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
    :root {
        --bg: #f5f7fb;
        --card: #ffffff;
        --primary: #4c7cf3;
        --text: #2b2d42;
        --muted: #6b7280;
        --border: #e5e7eb;
    }
    * { box-sizing: border-box; }
    body {
        margin: 0;
        padding: 0;
        background: var(--bg);
        font-family: "Segoe UI", Tahoma, Arial, sans-serif;
        color: var(--text);
    }
    h1, h2, h3, h4 { margin: 0; }
    a { color: inherit; }
    .container {
        max-width: 1100px;
        margin: 0 auto;
        padding: 28px 18px 40px;
    }
    .header {
        display: flex;
        justify-content: space-between;
        align-items: baseline;
        margin-bottom: 18px;
        gap: 12px;
    }
    .header h1 {
        font-size: 28px;
        letter-spacing: -0.2px;
    }
    .badge {
        background: rgba(76,124,243,0.12);
        color: var(--primary);
        padding: 8px 12px;
        border-radius: 12px;
        font-weight: 600;
        font-size: 14px;
    }
    .grid {
        display: grid;
        grid-template-columns: 1.1fr 0.9fr;
        gap: 16px;
    }
    .card {
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: 14px;
        padding: 16px;
        box-shadow: 0 10px 25px rgba(0,0,0,0.02);
    }
    .card h3 {
        margin-bottom: 12px;
        font-size: 17px;
    }
    form label {
        display: block;
        font-size: 13px;
        color: var(--muted);
        margin-bottom: 6px;
    }
    .form-row {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(160px,1fr));
        gap: 12px;
        margin-bottom: 12px;
    }
    input[type="text"],
    input[type="number"],
    input[type="date"],
    select,
    textarea {
        width: 100%;
        padding: 10px 12px;
        border: 1px solid var(--border);
        border-radius: 10px;
        font-size: 14px;
        transition: border 0.15s, box-shadow 0.15s;
        background: #fbfbfe;
    }
    input:focus, select:focus, textarea:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(76,124,243,0.15);
    }
    textarea {
        resize: vertical;
        min-height: 60px;
    }
    .btn {
        padding: 11px 16px;
        border: none;
        border-radius: 10px;
        font-weight: 700;
        cursor: pointer;
        font-size: 14px;
        transition: transform 0.08s ease, box-shadow 0.15s ease;
    }
    .btn-primary {
        background: linear-gradient(135deg, #4c7cf3, #6a9cfb);
        color: white;
        box-shadow: 0 12px 25px rgba(76,124,243,0.25);
    }
    .btn-secondary {
        background: #eef2ff;
        color: #4c7cf3;
        border: 1px solid #dce4ff;
    }
    .btn:hover { transform: translateY(-1px); }
    .btn:active { transform: translateY(0); }
    .filters {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(160px,1fr));
        gap: 10px;
    }
    .stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(180px,1fr));
        gap: 12px;
    }
    .stat-card {
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: 14px;
        padding: 14px;
        box-shadow: 0 10px 25px rgba(0,0,0,0.02);
    }
    .stat-value {
        font-size: 26px;
        font-weight: 800;
        margin-top: 4px;
    }
    .muted { color: var(--muted); }
    table {
        width: 100%;
        border-collapse: collapse;
    }
    thead {
        background: #f8fafc;
    }
    th, td {
        padding: 12px 10px;
        text-align: left;
        border-bottom: 1px solid var(--border);
        font-size: 14px;
    }
    th {
        color: var(--muted);
        font-weight: 700;
    }
    tr:hover td { background: #f8fbff; }
    .empty {
        text-align: center;
        padding: 24px;
        color: var(--muted);
    }
    .breakdown-list {
        list-style: none;
        padding: 0;
        margin: 0;
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(140px,1fr));
        gap: 8px;
    }
    .breakdown-item {
        padding: 10px 12px;
        border-radius: 12px;
        border: 1px solid var(--border);
        background: #fbfbff;
        display: flex;
        align-items: center;
        gap: 8px;
    }
    .color-dot {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        flex-shrink: 0;
    }
    canvas {
        width: 100%;
        max-width: 360px;
        aspect-ratio: 1/1;
    }
    .chart-wrap {
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 12px 0;
    }
    @media (max-width: 800px) {
        .grid { grid-template-columns: 1fr; }
        .header { flex-direction: column; align-items: flex-start; }
    }
</style>
</head>
<body>
<div class="container">
    <div class="header">
        <h1>Expense Tracker</h1>
        <div class="badge">Local Storage · Offline</div>
    </div>

    <div class="grid">
        <div class="card">
            <h3>Add Expense</h3>
            <form id="expense-form">
                <div class="form-row">
                    <div>
                        <label for="amount">Amount ($)</label>
                        <input type="number" id="amount" min="0" step="0.01" required placeholder="e.g. 25.50">
                    </div>
                    <div>
                        <label for="category">Category</label>
                        <select id="category" required>
                            <option value="" disabled selected>Select category</option>
                            <option>Food</option>
                            <option>Transport</option>
                            <option>Entertainment</option>
                            <option>Bills</option>
                            <option>Shopping</option>
                            <option>Other</option>
                        </select>
                    </div>
                    <div>
                        <label for="date">Date</label>
                        <input type="date" id="date" required>
                    </div>
                </div>
                <label for="description">Description</label>
                <textarea id="description" placeholder="Optional details"></textarea>
                <div style="margin-top:12px; display:flex; gap:10px; flex-wrap:wrap;">
                    <button type="submit" class="btn btn-primary">Add Expense</button>
                    <button type="reset" class="btn btn-secondary">Clear</button>
                </div>
            </form>
        </div>
        <div class="card">
            <h3>Filters</h3>
            <div class="filters">
                <div>
                    <label for="filter-category">Category</label>
                    <select id="filter-category">
                        <option value="all">All</option>
                        <option>Food</option>
                        <option>Transport</option>
                        <option>Entertainment</option>
                        <option>Bills</option>
                        <option>Shopping</option>
                        <option>Other</option>
                    </select>
                </div>
                <div>
                    <label for="start-date">Start Date</label>
                    <input type="date" id="start-date">
                </div>
                <div>
                    <label for="end-date">End Date</label>
                    <input type="date" id="end-date">
                </div>
            </div>
            <div style="margin-top:12px;">
                <button id="reset-filters" class="btn btn-secondary" type="button">Reset Filters</button>
            </div>
        </div>
    </div>

    <div style="margin:18px 0 10px;">
        <h3 style="margin:0 0 8px;">Overview</h3>
        <div class="stats">
            <div class="stat-card">
                <div class="muted">Total Spending (filtered)</div>
                <div id="total-spending" class="stat-value">$0.00</div>
            </div>
            <div class="stat-card">
                <div class="muted">Total Items (filtered)</div>
                <div id="total-count" class="stat-value">0</div>
            </div>
            <div class="stat-card">
                <div class="muted">Last Added</div>
                <div id="last-added" class="stat-value" style="font-size:18px;">—</div>
            </div>
        </div>
    </div>

    <div class="grid">
        <div class="card">
            <h3>Breakdown by Category</h3>
            <ul class="breakdown-list" id="breakdown-list"></ul>
        </div>
        <div class="card">
            <h3>Spending Pie Chart</h3>
            <div class="chart-wrap">
                <canvas id="pie-chart" width="320" height="320"></canvas>
            </div>
            <div id="chart-note" class="muted" style="text-align:center;font-size:13px;">Showing filtered expenses</div>
        </div>
    </div>

    <div class="card" style="margin-top:16px;">
        <h3>Expenses</h3>
        <div style="overflow-x:auto;">
            <table>
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Category</th>
                        <th>Description</th>
                        <th style="text-align:right;">Amount ($)</th>
                    </tr>
                </thead>
                <tbody id="expense-body"></tbody>
            </table>
        </div>
    </div>
</div>

<script>
(function() {
    const STORAGE_KEY = 'expense-tracker-data-v1';
    const categoryColors = {
        'Food': '#4c7cf3',
        'Transport': '#f59e0b',
        'Entertainment': '#ec4899',
        'Bills': '#10b981',
        'Shopping': '#8b5cf6',
        'Other': '#6b7280'
    };

    const form = document.getElementById('expense-form');
    const amountEl = document.getElementById('amount');
    const categoryEl = document.getElementById('category');
    const dateEl = document.getElementById('date');
    const descEl = document.getElementById('description');

    const filterCategoryEl = document.getElementById('filter-category');
    const startDateEl = document.getElementById('start-date');
    const endDateEl = document.getElementById('end-date');
    const resetFiltersBtn = document.getElementById('reset-filters');

    const totalSpendingEl = document.getElementById('total-spending');
    const totalCountEl = document.getElementById('total-count');
    const lastAddedEl = document.getElementById('last-added');
    const breakdownListEl = document.getElementById('breakdown-list');
    const expenseBodyEl = document.getElementById('expense-body');
    const pieCanvas = document.getElementById('pie-chart');
    const pieCtx = pieCanvas.getContext('2d');

    let expenses = [];

    function loadExpenses() {
        try {
            const stored = localStorage.getItem(STORAGE_KEY);
            expenses = stored ? JSON.parse(stored) : [];
        } catch (e) {
            expenses = [];
        }
    }

    function saveExpenses() {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(expenses));
    }

    function todayISO() {
        const d = new Date();
        const month = String(d.getMonth() + 1).padStart(2, '0');
        const day = String(d.getDate()).padStart(2, '0');
        return `${d.getFullYear()}-${month}-${day}`;
    }

    function parseDate(val) {
        return val ? new Date(val + 'T00:00:00') : null;
    }

    function getFilteredExpenses() {
        const filterCat = filterCategoryEl.value;
        const start = parseDate(startDateEl.value);
        const end = parseDate(endDateEl.value);
        return expenses.filter(exp => {
            if (filterCat !== 'all' && exp.category !== filterCat) return false;
            const d = parseDate(exp.date);
            if (start && d < start) return false;
            if (end && d > end) return false;
            return true;
        });
    }

    function renderTable(list) {
        expenseBodyEl.innerHTML = '';
        if (list.length === 0) {
            const tr = document.createElement('tr');
            const td = document.createElement('td');
            td.colSpan = 4;
            td.className = 'empty';
            td.textContent = 'No expenses yet.';
            tr.appendChild(td);
            expenseBodyEl.appendChild(tr);
            return;
        }
        const sorted = [...list].sort((a,b) => new Date(b.date) - new Date(a.date));
        sorted.forEach(exp => {
            const tr = document.createElement('tr');
            const d = document.createElement('td');
            d.textContent = exp.date;
            const c = document.createElement('td');
            c.textContent = exp.category;
            const des = document.createElement('td');
            des.textContent = exp.description || '—';
            const amt = document.createElement('td');
            amt.style.textAlign = 'right';
            amt.textContent = exp.amount.toFixed(2);
            tr.append(d,c,des,amt);
            expenseBodyEl.appendChild(tr);
        });
    }

    function renderTotals(list) {
        const total = list.reduce((sum, e) => sum + e.amount, 0);
        totalSpendingEl.textContent = '$' + total.toFixed(2);
        totalCountEl.textContent = list.length;
        if (expenses.length === 0) {
            lastAddedEl.textContent = '—';
        } else {
            const last = expenses[expenses.length - 1];
            lastAddedEl.textContent = `${last.date} · ${last.category}`;
        }
    }

    function renderBreakdown(list) {
        breakdownListEl.innerHTML = '';
        const totals = {};
        Object.keys(categoryColors).forEach(cat => totals[cat] = 0);
        list.forEach(e => totals[e.category] = (totals[e.category] || 0) + e.amount);
        Object.entries(totals).forEach(([cat, val]) => {
            const li = document.createElement('li');
            li.className = 'breakdown-item';
            const dot = document.createElement('span');
            dot.className = 'color-dot';
            dot.style.background = categoryColors[cat] || '#999';
            const label = document.createElement('div');
            label.innerHTML = `<div class="muted" style="font-size:12px;">${cat}</div><div style="font-weight:700;">$${val.toFixed(2)}</div>`;
            li.append(dot, label);
            breakdownListEl.appendChild(li);
        });
        drawPie(totals);
    }

    function drawPie(totals) {
        const values = Object.values(totals);
        const total = values.reduce((a,b)=>a+b,0);
        const ctx = pieCtx;
        ctx.clearRect(0,0,pieCanvas.width, pieCanvas.height);
        if (total === 0) {
            ctx.fillStyle = '#9ca3af';
            ctx.font = '14px Segoe UI';
            ctx.textAlign = 'center';
            ctx.fillText('No data to display', pieCanvas.width/2, pieCanvas.height/2);
            return;
        }
        let startAngle = -Math.PI/2;
        const radius = Math.min(pieCanvas.width, pieCanvas.height)/2 - 10;
        const centerX = pieCanvas.width/2;
        const centerY = pieCanvas.height/2;
        Object.entries(totals).forEach(([cat, val]) => {
            if (val === 0) return;
            const slice = (val / total) * Math.PI * 2;
            const endAngle = startAngle + slice;
            ctx.beginPath();
            ctx.moveTo(centerX, centerY);
            ctx.arc(centerX, centerY, radius, startAngle, endAngle);
            ctx.closePath();
            ctx.fillStyle = categoryColors[cat] || '#ccc';
            ctx.fill();
            startAngle = endAngle;
        });
        // Outline
        ctx.beginPath();
        ctx.arc(centerX, centerY, radius, 0, Math.PI*2);
        ctx.strokeStyle = '#fff';
        ctx.lineWidth = 1.5;
        ctx.stroke();
    }

    function renderAll() {
        const filtered = getFilteredExpenses();
        renderTable(filtered);
        renderTotals(filtered);
        renderBreakdown(filtered);
    }

    function handleSubmit(e) {
        e.preventDefault();
        const amount = parseFloat(amountEl.value);
        const category = categoryEl.value;
        const date = dateEl.value;
        const description = descEl.value.trim();
        if (isNaN(amount) || amount <= 0) {
            alert('Please enter a valid amount greater than zero.');
            return;
        }
        if (!category) {
            alert('Please select a category.');
            return;
        }
        if (!date) {
            alert('Please choose a date.');
            return;
        }
        const expense = { amount, category, date, description };
        expenses.push(expense);
        saveExpenses();
        form.reset();
        dateEl.value = todayISO();
        renderAll();
    }

    function attachEvents() {
        form.addEventListener('submit', handleSubmit);
        [filterCategoryEl, startDateEl, endDateEl].forEach(el => el.addEventListener('change', renderAll));
        resetFiltersBtn.addEventListener('click', () => {
            filterCategoryEl.value = 'all';
            startDateEl.value = '';
            endDateEl.value = '';
            renderAll();
        });
    }

    function init() {
        loadExpenses();
        dateEl.value = todayISO();
        attachEvents();
        renderAll();
    }

    init();
})();
</script>
</body>
</html>