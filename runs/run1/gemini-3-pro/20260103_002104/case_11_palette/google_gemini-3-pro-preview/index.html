<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChromaGen - Color Palette Generator</title>
    <style>
        :root {
            --bg-color: #f0f0f0;
            --text-color: #333;
            --font-main: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            --shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-main);
            background-color: var(--bg-color);
            color: var(--text-color);
            overflow: hidden; /* Prevent scroll */
        }

        /* Main Layout */
        .app {
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        .palette-container {
            display: flex;
            flex: 1;
            width: 100%;
            height: 100%;
        }

        .color-col {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: relative;
            transition: background-color 0.4s ease;
            cursor: pointer;
        }

        .color-col:hover {
            flex: 1.2; /* Subtle expand effect */
            transition: flex 0.3s ease, background-color 0.4s ease;
        }

        .color-info {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            z-index: 2;
            pointer-events: none; /* Let clicks pass to container for copy */
            opacity: 0.9;
        }

        .color-hex {
            font-size: 1.8rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            cursor: pointer;
            pointer-events: auto;
            transition: transform 0.1s;
        }
        
        .color-hex:active {
            transform: scale(0.95);
        }

        .color-name {
            font-size: 1rem;
            font-weight: 500;
            opacity: 0.8;
        }

        .color-rgb {
            font-size: 0.8rem;
            opacity: 0.6;
            font-family: monospace;
        }

        .controls-overlay {
            margin-top: 20px;
            pointer-events: auto;
        }

        .btn-icon {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.5rem;
            color: inherit;
            transition: transform 0.2s, opacity 0.2s;
            opacity: 0.5;
            padding: 10px;
            border-radius: 50%;
            background-color: rgba(255,255,255,0.2);
        }

        .btn-icon:hover {
            opacity: 1;
            transform: scale(1.1);
            background-color: rgba(255,255,255,0.3);
        }

        .btn-icon.locked {
            opacity: 1;
        }

        /* Top Bar / Nav */
        .navbar {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            padding: 20px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 10;
            pointer-events: none; /* Let clicks pass through empty space */
        }

        .nav-left, .nav-right {
            pointer-events: auto;
            background: white;
            padding: 10px 20px;
            border-radius: 30px;
            box-shadow: var(--shadow);
            display: flex;
            gap: 15px;
            align-items: center;
        }

        h1 {
            font-size: 1.2rem;
            font-weight: 700;
            color: #333;
        }

        .btn-main {
            padding: 8px 16px;
            border: none;
            border-radius: 20px;
            background-color: #333;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
            font-size: 0.9rem;
        }

        .btn-main:hover {
            background-color: #555;
        }

        /* Library Panel (Drawer) */
        .library-panel {
            position: fixed;
            top: 0;
            right: 0;
            width: 350px;
            height: 100%;
            background: white;
            box-shadow: -5px 0 15px rgba(0,0,0,0.1);
            transform: translateX(100%);
            transition: transform 0.3s ease-in-out;
            z-index: 20;
            display: flex;
            flex-direction: column;
        }

        .library-panel.active {
            transform: translateX(0);
        }

        .library-header {
            padding: 20px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .library-content {
            padding: 20px;
            overflow-y: auto;
            flex: 1;
        }

        .saved-palette {
            margin-bottom: 20px;
            cursor: pointer;
        }

        .saved-palette-preview {
            display: flex;
            height: 50px;
            border-radius: 8px;
            overflow: hidden;
            border: 1px solid #eee;
        }

        .mini-color {
            flex: 1;
        }

        .saved-palette-info {
            display: flex;
            justify-content: space-between;
            margin-top: 5px;
            font-size: 0.8rem;
            color: #666;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
        }

        .delete-btn {
            color: red;
            cursor: pointer;
        }

        /* Toast Notification */
        .toast {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: #333;
            color: white;
            padding: 12px 24px;
            border-radius: 30px;
            font-weight: 500;
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 30;
            box-shadow: var(--shadow);
        }

        .toast.visible {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }

        /* Icons */
        .icon {
            width: 24px;
            height: 24px;
            fill: currentColor;
        }

        /* Mobile Adjustments */
        @media (max-width: 768px) {
            .palette-container {
                flex-direction: column;
            }
            .color-col:hover {
                flex: 1; /* Disable expand on mobile */
            }
            .navbar {
                padding: 10px;
                flex-direction: column;
                gap: 10px;
                pointer-events: none;
            }
            .nav-left, .nav-right {
                pointer-events: auto;
                width: 100%;
                justify-content: center;
            }
            .color-hex {
                font-size: 1.2rem;
            }
        }
    </style>
</head>
<body>

    <div class="app">
        <nav class="navbar">
            <div class="nav-left">
                <h1>ChromaGen</h1>
                <span style="font-size: 0.8rem; color: #666;">Press Spacebar to generate</span>
            </div>
            <div class="nav-right">
                <button class="btn-main" onclick="saveCurrentPalette()">Save Palette</button>
                <button class="btn-main" onclick="toggleLibrary()">Library</button>
            </div>
        </nav>

        <div class="palette-container" id="palette">
            <!-- Columns generated by JS -->
        </div>
    </div>

    <!-- Library Drawer -->
    <div class="library-panel" id="library">
        <div class="library-header">
            <h2>Saved Palettes</h2>
            <button class="close-btn" onclick="toggleLibrary()">&times;</button>
        </div>
        <div class="library-content" id="library-list">
            <!-- Saved items -->
        </div>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast">Copied to clipboard!</div>

    <script>
        // --- Data & State ---
        
        // Simplified Color Names Database
        const colorNames = [
            { name: "Black", r: 0, g: 0, b: 0 },
            { name: "White", r: 255, g: 255, b: 255 },
            { name: "Red", r: 255, g: 0, b: 0 },
            { name: "Green", r: 0, g: 255, b: 0 },
            { name: "Blue", r: 0, g: 0, b: 255 },
            { name: "Yellow", r: 255, g: 255, b: 0 },
            { name: "Cyan", r: 0, g: 255, b: 255 },
            { name: "Magenta", r: 255, g: 0, b: 255 },
            { name: "Silver", r: 192, g: 192, b: 192 },
            { name: "Gray", r: 128, g: 128, b: 128 },
            { name: "Maroon", r: 128, g: 0, b: 0 },
            { name: "Olive", r: 128, g: 128, b: 0 },
            { name: "Purple", r: 128, g: 0, b: 128 },
            { name: "Teal", r: 0, g: 128, b: 128 },
            { name: "Navy", r: 0, g: 0, b: 128 },
            { name: "Orange", r: 255, g: 165, b: 0 },
            { name: "Gold", r: 255, g: 215, b: 0 },
            { name: "Pink", r: 255, g: 192, b: 203 },
            { name: "Lavender", r: 230, g: 230, b: 250 },
            { name: "Violet", r: 238, g: 130, b: 238 },
            { name: "Coral", r: 255, g: 127, b: 80 },
            { name: "Crimson", r: 220, g: 20, b: 60 },
            { name: "Khaki", r: 240, g: 230, b: 140 },
            { name: "Plum", r: 221, g: 160, b: 221 },
            { name: "Indigo", r: 75, g: 0, b: 130 },
            { name: "Turquoise", r: 64, g: 224, b: 208 },
            { name: "Salmon", r: 250, g: 128, b: 114 },
            { name: "Chocolate", r: 210, g: 105, b: 30 },
            { name: "Tomato", r: 255, g: 99, b: 71 },
            { name: "Lime", r: 50, g: 205, b: 50 },
            { name: "Orchid", r: 218, g: 112, b: 214 },
            { name: "Slate", r: 112, g: 128, b: 144 },
            { name: "Mint", r: 189, g: 252, b: 201 },
            { name: "Beige", r: 245, g: 245, b: 220 },
            { name: "Azure", r: 240, g: 255, b: 255 },
            { name: "Brown", r: 165, g: 42, b: 42 },
            { name: "Aquamarine", r: 127, g: 255, b: 212 },
            { name: "Bisque", r: 255, g: 228, b: 196 },
            { name: "Tan", r: 210, g: 180, b: 140 },
            { name: "Sky Blue", r: 135, g: 206, b: 235 },
            { name: "Royal Blue", r: 65, g: 105, b: 225 },
            { name: "Hot Pink", r: 255, g: 105, b: 180 },
            { name: "Sea Green", r: 46, g: 139, b: 87 }
        ];

        let colors = [];
        const COLUMNS = 5;

        // --- SVGs ---
        const LOCK_ICON = `<svg class="icon" viewBox="0 0 24 24"><path d="M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zm-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2z"/></svg>`;
        const UNLOCK_ICON = `<svg class="icon" viewBox="0 0 24 24"><path d="M12 17c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm6-9h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6h1.9c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zm0 12H6V10h12v10z"/></svg>`;

        // --- Helper Functions ---

        function generateRandomColor() {
            // Using HSL for better distribution, then converting to hex
            // Random Hue 0-360, Saturation 50-100%, Lightness 30-80%
            const h = Math.floor(Math.random() * 360);
            const s = Math.floor(Math.random() * 50) + 50;
            const l = Math.floor(Math.random() * 50) + 30;
            return hslToHex(h, s, l);
        }

        function hslToHex(h, s, l) {
            l /= 100;
            const a = s * Math.min(l, 1 - l) / 100;
            const f = n => {
                const k = (n + h / 30) % 12;
                const color = l - a * Math.max(Math.min(k - 3, 9 - k, 1), -1);
                return Math.round(255 * color).toString(16).padStart(2, '0');
            };
            return `#${f(0)}${f(8)}${f(4)}`;
        }

        function hexToRgb(hex) {
            const r = parseInt(hex.slice(1, 3), 16);
            const g = parseInt(hex.slice(3, 5), 16);
            const b = parseInt(hex.slice(5, 7), 16);
            return { r, g, b };
        }

        // Determine text color (black or white) based on background luminance
        function getContrastYIQ(hexcolor){
            const { r, g, b } = hexToRgb(hexcolor);
            const yiq = ((r*299)+(g*587)+(b*114))/1000;
            return (yiq >= 128) ? '#000000' : '#ffffff';
        }

        function getClosestName(hex) {
            const { r, g, b } = hexToRgb(hex);
            let minDistance = Infinity;
            let closestName = "Color";

            for (const color of colorNames) {
                // Euclidean distance
                const dist = Math.sqrt(
                    Math.pow(r - color.r, 2) +
                    Math.pow(g - color.g, 2) +
                    Math.pow(b - color.b, 2)
                );
                if (dist < minDistance) {
                    minDistance = dist;
                    closestName = color.name;
                }
            }
            return closestName;
        }

        // --- Core Logic ---

        function init() {
            // Initialize with random colors
            for (let i = 0; i < COLUMNS; i++) {
                colors.push({
                    hex: generateRandomColor(),
                    locked: false
                });
            }
            renderPalette();
            renderLibrary(); // Load saved palettes
        }

        function renderPalette() {
            const container = document.getElementById('palette');
            container.innerHTML = '';

            colors.forEach((color, index) => {
                const colDiv = document.createElement('div');
                colDiv.className = 'color-col';
                colDiv.style.backgroundColor = color.hex;
                
                const textColor = getContrastYIQ(color.hex);
                colDiv.style.color = textColor;

                const rgb = hexToRgb(color.hex);
                const rgbString = `rgb(${rgb.r}, ${rgb.g}, ${rgb.b})`;
                const name = getClosestName(color.hex);

                colDiv.innerHTML = `
                    <div class="color-info">
                        <h2 class="color-hex" onclick="copyToClipboard('${color.hex}')">${color.hex}</h2>
                        <span class="color-name">${name}</span>
                        <span class="color-rgb">${rgbString}</span>
                    </div>
                    <div class="controls-overlay">
                        <button class="btn-icon ${color.locked ? 'locked' : ''}" onclick="toggleLock(${index})">
                            ${color.locked ? LOCK_ICON : UNLOCK_ICON}
                        </button>
                    </div>
                `;

                // Add click event for background (excluding controls)
                colDiv.addEventListener('click', (e) => {
                    // If clicked element is not a button or the hex text (which has its own handler)
                    if (e.target.tagName !== 'BUTTON' && !e.target.closest('button') && !e.target.classList.contains('color-hex')) {
                        copyToClipboard(color.hex);
                    }
                });

                container.appendChild(colDiv);
            });
        }

        function generateNewPalette() {
            colors = colors.map(color => {
                if (color.locked) return color;
                return { ...color, hex: generateRandomColor() };
            });
            renderPalette();
        }

        function toggleLock(index) {
            colors[index].locked = !colors[index].locked;
            renderPalette();
        }

        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                showToast(`Copied ${text} to clipboard!`);
            });
        }

        function showToast(msg) {
            const toast = document.getElementById('toast');
            toast.innerText = msg;
            toast.classList.add('visible');
            setTimeout(() => {
                toast.classList.remove('visible');
            }, 2000);
        }

        // --- Library / Storage ---

        function saveCurrentPalette() {
            const saved = JSON.parse(localStorage.getItem('chromaGenPalettes') || '[]');
            const newPalette = {
                id: Date.now(),
                colors: colors.map(c => c.hex),
                date: new Date().toLocaleDateString()
            };
            saved.unshift(newPalette); // Add to top
            localStorage.setItem('chromaGenPalettes', JSON.stringify(saved));
            renderLibrary();
            showToast('Palette saved to Library!');
            
            // Open library to show confirmation implicitly
            const lib = document.getElementById('library');
            if(!lib.classList.contains('active')) {
                toggleLibrary();
            }
        }

        function renderLibrary() {
            const list = document.getElementById('library-list');
            const saved = JSON.parse(localStorage.getItem('chromaGenPalettes') || '[]');
            
            list.innerHTML = '';
            
            if (saved.length === 0) {
                list.innerHTML = '<p style="text-align:center; color:#999; margin-top:20px;">No saved palettes yet.</p>';
                return;
            }

            saved.forEach(p => {
                const item = document.createElement('div');
                item.className = 'saved-palette';
                
                let previewHTML = '<div class="saved-palette-preview">';
                p.colors.forEach(c => {
                    previewHTML += `<div class="mini-color" style="background-color: ${c}"></div>`;
                });
                previewHTML += '</div>';

                item.innerHTML = `
                    ${previewHTML}
                    <div class="saved-palette-info">
                        <span>${p.date}</span>
                        <span class="delete-btn" onclick="deletePalette(${p.id}, event)">Delete</span>
                    </div>
                `;

                // Load palette on click
                item.addEventListener('click', () => {
                   loadPalette(p.colors);
                });

                list.appendChild(item);
            });
        }

        function toggleLibrary() {
            document.getElementById('library').classList.toggle('active');
        }

        function deletePalette(id, e) {
            e.stopPropagation(); // Prevent loading the palette
            const saved = JSON.parse(localStorage.getItem('chromaGenPalettes') || '[]');
            const updated = saved.filter(p => p.id !== id);
            localStorage.setItem('chromaGenPalettes', JSON.stringify(updated));
            renderLibrary();
        }

        function loadPalette(hexArray) {
            // Unlock all and set colors
             colors = hexArray.map(hex => ({
                hex: hex,
                locked: false
            }));
            renderPalette();
            // Close library on mobile or small screens for better UX
            if(window.innerWidth < 768) {
                toggleLibrary();
            }
        }

        // --- Event Listeners ---

        document.addEventListener('keydown', (e) => {
            if (e.code === 'Space') {
                e.preventDefault(); // Prevent scroll
                generateNewPalette();
            }
        });

        // Init App
        init();

    </script>
</body>
</html>