<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Typing Speed Test</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }

        body {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background: #17A2B8;
        }

        .wrapper {
            width: 700px;
            padding: 35px;
            background: #fff;
            border-radius: 10px;
            box-shadow: 0 10px 15px rgba(0,0,0,0.05);
        }

        .wrapper .input-field {
            opacity: 0;
            z-index: -999;
            position: absolute;
        }

        .wrapper .content-box {
            border-radius: 10px;
            border: 1px solid #bfbfbf;
            padding: 20px;
        }

        .content-box .typing-text {
            max-height: 250px;
            overflow-y: auto;
            font-size: 21px;
            text-align: justify;
            letter-spacing: 1px;
            line-height: 1.6;
            color: #646669;
        }

        .typing-text::-webkit-scrollbar {
            width: 0;
        }

        .typing-text p {
            user-select: none;
        }

        .typing-text p span {
            position: relative;
        }

        .typing-text p span.correct {
            color: #56964f;
        }

        .typing-text p span.incorrect {
            color: #cb3439;
            background: #ffc0c2;
            border-radius: 4px;
        }

        .typing-text p span.active {
            color: #17A2B8;
        }

        .typing-text p span.active::before {
            position: absolute;
            content: "";
            height: 2px;
            width: 100%;
            bottom: 0;
            left: 0;
            opacity: 0;
            border-radius: 5px;
            background: #17A2B8;
            animation: blink 1s ease-in-out infinite;
        }

        @keyframes blink {
            50% { opacity: 1; }
        }

        .content-box .content {
            margin-top: 20px;
            display: flex;
            padding: 12px 0;
            flex-wrap: wrap;
            align-items: center;
            justify-content: space-between;
            border-top: 1px solid #bfbfbf;
        }

        .content button {
            outline: none;
            border: none;
            width: 105px;
            color: #fff;
            padding: 8px 0;
            font-size: 16px;
            cursor: pointer;
            border-radius: 5px;
            background: #17A2B8;
            transition: transform 0.3s ease;
        }

        .content button:active {
            transform: scale(0.97);
        }

        .content .result-details {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            width: calc(100% - 140px);
            justify-content: space-between;
        }

        .result-details li {
            display: flex;
            height: 20px;
            list-style: none;
            position: relative;
            align-items: center;
        }

        .result-details li:not(:last-child) {
            margin-right: 20px;
            border-right: 1px solid #bfbfbf;
            padding-right: 20px;
        }

        .result-details li p {
            font-size: 19px;
        }

        .result-details li span {
            display: block;
            font-size: 20px;
            margin-left: 10px;
        }

        li span b {
            font-weight: 500;
        }

        li:not(:first-child) span {
            font-weight: 500;
        }

        /* Visible Input Area styling */
        .visible-input-container {
            margin-top: 20px;
            width: 100%;
        }
        
        .visible-input {
            width: 100%;
            padding: 10px;
            font-size: 18px;
            border: 2px solid #ccc;
            border-radius: 5px;
            outline: none;
            transition: border-color 0.3s;
        }

        .visible-input:focus {
            border-color: #17A2B8;
        }

        /* Modal for results */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.5);
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background-color: #fefefe;
            padding: 30px;
            border-radius: 10px;
            text-align: center;
            width: 400px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .modal h2 {
            margin-bottom: 20px;
            color: #17A2B8;
        }

        .modal p {
            font-size: 18px;
            margin: 10px 0;
        }

        .modal button {
            margin-top: 20px;
            width: 100%;
            padding: 10px;
            background: #17A2B8;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 18px;
            cursor: pointer;
        }

    </style>
</head>
<body>
    <div class="wrapper">
        <h2 style="margin-bottom: 15px; color: #333;">Typing Speed Test</h2>
        <!-- Hidden input for capturing keystrokes if we wanted a purely visual overlay, 
             but we will use the visible input below as the driver. -->
        
        <div class="content-box">
            <div class="typing-text">
                <p id="paragraph"></p>
            </div>
            <div class="content">
                <ul class="result-details">
                    <li class="time">
                        <p>Time Left:</p>
                        <span><b id="time">30</b>s</span>
                    </li>
                    <li class="mistake">
                        <p>Mistakes:</p>
                        <span id="mistakes">0</span>
                    </li>
                    <li class="wpm">
                        <p>WPM:</p>
                        <span id="wpm">0</span>
                    </li>
                    <li class="accuracy">
                        <p>Accuracy:</p>
                        <span id="accuracy">100%</span>
                    </li>
                </ul>
                <button id="reset-btn">Try Again</button>
            </div>
        </div>

        <div class="visible-input-container">
            <input type="text" id="input-field" class="visible-input" placeholder="Start typing here..." autocomplete="off">
        </div>
    </div>

    <div id="result-modal" class="modal">
        <div class="modal-content">
            <h2>Time's Up!</h2>
            <p>WPM: <b id="final-wpm">0</b></p>
            <p>Accuracy: <b id="final-accuracy">0%</b></p>
            <p>Mistakes: <b id="final-mistakes">0</b></p>
            <button onclick="resetGame()">Try Again</button>
        </div>
    </div>

    <script>
        const paragraphs = [
            "The art of programming is the skill of controlling complexity. The great software developer creates bridges between the abstract ideas and the concrete realization.",
            "Nature sounds are often used for relaxation and meditation. The sound of rain falling on leaves or the gentle flow of a river can help calm the mind and reduce stress.",
            "To be successful in life, you must be willing to make sacrifices. Success does not come easy, and it often requires long hours of hard work and dedication.",
            "Space exploration has always fascinated humanity. Looking up at the stars, we wonder if there is life elsewhere in the universe and what secrets the cosmos holds.",
            "Coffee is one of the most popular beverages in the world. Many people start their day with a hot cup of coffee to wake up and get ready for the challenges ahead.",
            "Artificial intelligence is rapidly changing the world. From self-driving cars to intelligent assistants, AI is becoming an integral part of our daily lives.",
            "Reading books is a great way to expand your knowledge and imagination. It allows you to travel to different worlds and experience lives different from your own.",
            "Healthy eating habits are essential for a long and happy life. Consuming a balanced diet rich in fruits and vegetables can prevent many chronic diseases.",
            "Music has the power to evoke strong emotions. It can make us feel happy, sad, energetic, or relaxed, depending on the rhythm and melody.",
            "Traveling allows you to experience new cultures and meet new people. It broadens your perspective and helps you appreciate the diversity of the world."
        ];

        const typingText = document.querySelector(".typing-text p");
        const inpField = document.querySelector("#input-field");
        const timeTag = document.querySelector("#time");
        const mistakeTag = document.querySelector("#mistakes");
        const wpmTag = document.querySelector("#wpm");
        const accuracyTag = document.querySelector("#accuracy");
        const resetBtn = document.querySelector("#reset-btn");
        const modal = document.getElementById("result-modal");

        let timer;
        let maxTime = 30;
        let timeLeft = maxTime;
        let charIndex = 0;
        let mistakes = 0;
        let isTyping = 0;

        function loadParagraph() {
            const randIndex = Math.floor(Math.random() * paragraphs.length);
            typingText.innerHTML = "";
            paragraphs[randIndex].split("").forEach(char => {
                let span = `<span>${char}</span>`;
                typingText.innerHTML += span;
            });
            typingText.querySelectorAll("span")[0].classList.add("active");
            
            // Focus input so user can start immediately
            inpField.focus(); 
            
            // Add click listener to text area to focus input
            document.querySelector(".typing-text").addEventListener("click", () => inpField.focus());
        }

        function initTyping() {
            let characters = typingText.querySelectorAll("span");
            let typedChar = inpField.value.split("")[charIndex];

            if(charIndex < characters.length && timeLeft > 0) {
                if(!isTyping) {
                    timer = setInterval(initTimer, 1000);
                    isTyping = true;
                }
                
                // Handle backspace
                if(typedChar == null) {
                    if(charIndex > 0) {
                        charIndex--;
                        if(characters[charIndex].classList.contains("incorrect")) {
                            mistakes--;
                        }
                        characters[charIndex].classList.remove("correct", "incorrect");
                    }
                } else {
                    if(characters[charIndex].innerText === typedChar) {
                        characters[charIndex].classList.add("correct");
                    } else {
                        mistakes++;
                        characters[charIndex].classList.add("incorrect");
                    }
                    charIndex++;
                }

                characters.forEach(span => span.classList.remove("active"));
                if(characters[charIndex]) {
                    characters[charIndex].classList.add("active");
                }

                // Stats calculation
                let wpm = Math.round(((charIndex - mistakes)  / 5) / (maxTime - timeLeft) * 60);
                wpm = wpm < 0 || !wpm || wpm === Infinity ? 0 : wpm;
                
                let accuracy = Math.round(((charIndex - mistakes) / charIndex) * 100);
                accuracy = accuracy < 0 || !accuracy || accuracy === Infinity ? 0 : accuracy;

                wpmTag.innerText = wpm;
                mistakeTag.innerText = mistakes;
                accuracyTag.innerText = accuracy + "%";

                // Check for completion
                if (charIndex === characters.length) {
                    endGame();
                }

            } else {
                clearInterval(timer);
                inpField.value = "";
            }
        }

        // Handle case where user pastes text or types very fast - 
        // actually standard input event handles one char at a time usually, but let's ensure sync.
        // For this simple implementation, we assume 1 char at a time or backspace.
        // To handle fast typing/pasting better, we should compare the whole string.
        
        // Let's rewrite initTyping to be more robust by comparing values directly
        function handleInput() {
            const characters = typingText.querySelectorAll("span");
            const typedVal = inpField.value;
            const typedLength = typedVal.length;

            if (!isTyping && typedLength > 0) {
                timer = setInterval(initTimer, 1000);
                isTyping = true;
            }

            // If user pasted or typed, we need to update UI based on current input length
            // But we need to track mistakes cumulatively? 
            // Standard typing tests often just check current state.
            // Let's stick to the previous logic but adapted for the input event which gives the full value.
            
            // Reset classes
            characters.forEach(span => span.classList.remove("correct", "incorrect", "active"));

            let currMistakes = 0;
            
            // Loop through typed characters
            for (let i = 0; i < typedLength; i++) {
                if (i < characters.length) {
                    const char = characters[i].innerText;
                    const typed = typedVal[i];
                    
                    if (char === typed) {
                        characters[i].classList.add("correct");
                    } else {
                        currMistakes++;
                        characters[i].classList.add("incorrect");
                    }
                }
            }
            
            // Set active
            if (typedLength < characters.length) {
                characters[typedLength].classList.add("active");
                // Scroll into view if needed
                characters[typedLength].scrollIntoView({
                    behavior: 'smooth',
                    block: 'center',
                    inline: 'nearest' // prevents horizontal scrolling
                });
            }

            mistakes = currMistakes; // Update global mistakes count
            charIndex = typedLength;

            // Stats
            const timeElapsed = maxTime - timeLeft;
            let wpm = 0;
            if (timeElapsed > 0) {
                // Standard WPM: (All typed entries / 5) / Time (min)
                // Gross WPM = (All typed / 5) / Time
                // Net WPM = Gross - (Uncorrected Errors / Time)
                // Let's use simple formula: (Correct chars / 5) / Time
                const correctChars = charIndex - mistakes;
                wpm = Math.round((correctChars / 5) / (timeElapsed / 60));
            }
            
            let accuracy = 0;
            if (charIndex > 0) {
                accuracy = Math.round(((charIndex - mistakes) / charIndex) * 100);
            }

            wpmTag.innerText = wpm;
            mistakeTag.innerText = mistakes;
            accuracyTag.innerText = accuracy + "%";

            if (charIndex >= characters.length) {
                endGame();
            }
        }

        function initTimer() {
            if(timeLeft > 0) {
                timeLeft--;
                timeTag.innerText = timeLeft;
                
                // Update WPM in real time even if not typing
                const timeElapsed = maxTime - timeLeft;
                if (timeElapsed > 0 && charIndex > 0) {
                     const correctChars = charIndex - mistakes;
                     let wpm = Math.round((correctChars / 5) / (timeElapsed / 60));
                     wpmTag.innerText = wpm;
                }
            } else {
                endGame();
            }
        }

        function endGame() {
            clearInterval(timer);
            inpField.disabled = true;
            
            // Show Modal
            document.getElementById("final-wpm").innerText = wpmTag.innerText;
            document.getElementById("final-accuracy").innerText = accuracyTag.innerText;
            document.getElementById("final-mistakes").innerText = mistakeTag.innerText;
            modal.style.display = "flex";
        }

        function resetGame() {
            loadParagraph();
            clearInterval(timer);
            timeLeft = maxTime;
            charIndex = mistakes = isTyping = 0;
            inpField.value = "";
            timeTag.innerText = timeLeft;
            wpmTag.innerText = 0;
            mistakeTag.innerText = 0;
            accuracyTag.innerText = "100%";
            inpField.disabled = false;
            modal.style.display = "none";
        }

        loadParagraph();
        inpField.addEventListener("input", handleInput);
        resetBtn.addEventListener("click", resetGame);
    </script>
</body>
</html>