<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Habit Tracker</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
:root{
  --bg:#0f172a;
  --card:#111827;
  --accent1:#22d3ee;
  --accent2:#a855f7;
  --text:#e5e7eb;
  --muted:#94a3b8;
  --success:#34d399;
  --danger:#f87171;
}
*{box-sizing:border-box;}
body{
  margin:0;
  font-family: "Inter", system-ui, -apple-system, sans-serif;
  background: radial-gradient(circle at 20% 20%, rgba(34,211,238,0.15), transparent 25%),
              radial-gradient(circle at 80% 0%, rgba(168,85,247,0.15), transparent 25%),
              radial-gradient(circle at 50% 80%, rgba(52,211,153,0.12), transparent 25%),
              var(--bg);
  color:var(--text);
  min-height:100vh;
}
.container{
  max-width:1100px;
  margin:0 auto;
  padding:32px 20px 60px;
}
header{
  display:flex;
  align-items:center;
  gap:12px;
  flex-wrap:wrap;
}
.title{
  font-size:32px;
  font-weight:800;
  letter-spacing:-0.5px;
}
.badge{
  background:linear-gradient(135deg,var(--accent1),var(--accent2));
  padding:6px 12px;
  border-radius:999px;
  font-weight:600;
  color:#0b1224;
  box-shadow:0 10px 30px rgba(34,211,238,0.25);
}
.card{
  background:rgba(17,24,39,0.82);
  border:1px solid rgba(255,255,255,0.04);
  border-radius:16px;
  padding:18px;
  box-shadow:0 18px 50px rgba(0,0,0,0.25);
  backdrop-filter:blur(6px);
}
.section{
  margin-top:16px;
}
.input-row{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
}
input[type="text"]{
  flex:1;
  min-width:200px;
  padding:12px 14px;
  border-radius:12px;
  border:1px solid rgba(255,255,255,0.06);
  background:rgba(255,255,255,0.04);
  color:var(--text);
  outline:none;
  font-size:15px;
}
input[type="text"]:focus{
  border-color:var(--accent1);
  box-shadow:0 0 0 2px rgba(34,211,238,0.15);
}
button{
  border:none;
  padding:12px 16px;
  border-radius:12px;
  font-weight:700;
  font-size:15px;
  cursor:pointer;
  background:linear-gradient(135deg,var(--accent1),var(--accent2));
  color:#0b1224;
  box-shadow:0 10px 30px rgba(34,211,238,0.25);
  transition:transform 0.1s ease, box-shadow 0.2s ease;
}
button:hover{transform:translateY(-1px);}
button:active{transform:translateY(0);}
.secondary{
  background:rgba(255,255,255,0.05);
  color:var(--text);
  box-shadow:none;
}
.stats{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(180px,1fr));
  gap:12px;
  margin-top:16px;
}
.stat{
  padding:14px;
  border-radius:14px;
  background:rgba(255,255,255,0.03);
  border:1px solid rgba(255,255,255,0.04);
}
.stat .label{color:var(--muted); font-size:13px;}
.stat .value{font-size:20px; font-weight:800;}
.stat small{color:var(--muted);}
.table-wrapper{
  margin-top:18px;
  overflow-x:auto;
}
table{
  width:100%;
  border-collapse:collapse;
  min-width:760px;
}
th,td{
  text-align:center;
}
thead th{
  font-size:12px;
  color:var(--muted);
  padding:6px 4px;
}
tbody td:first-child, thead th:first-child{
  position:sticky;
  left:0;
  z-index:2;
  background:rgba(17,24,39,0.96);
}
tbody td:first-child{
  text-align:left;
  padding-left:10px;
}
.habit-name{
  font-weight:700;
}
.meta{
  font-size:12px;
  color:var(--muted);
}
.day-cell{
  width:26px;
  height:26px;
  margin:3px auto;
  border-radius:8px;
  border:1px solid rgba(255,255,255,0.08);
  background:rgba(255,255,255,0.03);
  cursor:pointer;
  transition:all 0.12s ease;
}
.day-cell.done{
  background:linear-gradient(135deg,var(--accent1),var(--accent2));
  border-color:rgba(34,211,238,0.55);
  box-shadow:0 8px 16px rgba(168,85,247,0.15);
}
.day-cell:hover{transform:scale(1.05);}
.day-label{
  display:block;
  font-size:11px;
  color:var(--muted);
}
.progress{
  margin-top:6px;
  background:rgba(255,255,255,0.06);
  border-radius:999px;
  height:7px;
  overflow:hidden;
}
.progress .bar{
  height:100%;
  border-radius:999px;
  background:linear-gradient(135deg,var(--success),var(--accent1));
}
.empty{
  padding:20px;
  text-align:center;
  color:var(--muted);
}
.actions{
  display:flex;
  gap:8px;
  align-items:center;
}
.remove{
  background:rgba(248,113,113,0.12);
  color:#fecdd3;
}
.info-row{
  margin-top:12px;
  display:flex;
  gap:10px;
  align-items:center;
  flex-wrap:wrap;
  color:var(--muted);
  font-size:13px;
}
.legend{
  display:flex;
  gap:8px;
  align-items:center;
}
.swatch{
  width:18px; height:18px;
  border-radius:6px;
  border:1px solid rgba(255,255,255,0.08);
}
</style>
</head>
<body>
<div class="container">
  <header>
    <div class="title">Habit Tracker</div>
    <div class="badge">30-day view</div>
  </header>

  <div class="section card">
    <div class="input-row">
      <input type="text" id="habitInput" placeholder="Add a habit (e.g., Exercise, Read, Meditate)" maxlength="60">
      <button id="addHabitBtn">Add Habit</button>
      <button class="secondary" id="clearDataBtn" title="Remove all habits & history">Reset</button>
    </div>
    <div class="stats" id="topStats"></div>
  </div>

  <div class="section card">
    <div class="table-wrapper" id="tableWrapper">
      <!-- table injected -->
    </div>
    <div class="info-row">
      <div class="legend"><div class="swatch" style="background:linear-gradient(135deg,var(--accent1),var(--accent2));"></div>Completed</div>
      <div class="legend"><div class="swatch" style="background:rgba(255,255,255,0.03);"></div>Missed/blank</div>
      <div>Click any square to toggle. Streak counts backward from today.</div>
    </div>
  </div>
</div>

<script>
(function(){
  const STORAGE_KEY = 'habit_tracker_data_v1';
  const DAY_COUNT = 30;

  const elements = {
    input: document.getElementById('habitInput'),
    addBtn: document.getElementById('addHabitBtn'),
    clearBtn: document.getElementById('clearDataBtn'),
    tableWrapper: document.getElementById('tableWrapper'),
    topStats: document.getElementById('topStats')
  };

  let state = loadState();

  function loadState(){
    try{
      const raw = localStorage.getItem(STORAGE_KEY);
      if(raw){
        const parsed = JSON.parse(raw);
        if(parsed.habits && parsed.records) return parsed;
      }
    }catch(e){}
    return {habits:[], records:{}};
  }

  function saveState(){
    localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
  }

  function todayStr(){
    return formatDate(new Date());
  }

  function formatDate(date){
    return date.toISOString().slice(0,10);
  }

  function humanDate(dateStr){
    const d = new Date(dateStr);
    return `${d.getMonth()+1}/${d.getDate()}`;
  }

  function weekdayShort(dateStr){
    return ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'][new Date(dateStr).getDay()];
  }

  function pastDays(n){
    const arr=[];
    const now = new Date();
    for(let i=n-1;i>=0;i--){
      const d=new Date(now);
      d.setDate(now.getDate()-i);
      arr.push(formatDate(d));
    }
    return arr;
  }

  const dateWindow = pastDays(DAY_COUNT);

  function addHabit(){
    const name = elements.input.value.trim();
    if(!name) return;
    const habit = {id: Date.now().toString(), name, created: todayStr()};
    state.habits.push(habit);
    saveState();
    elements.input.value='';
    render();
  }

  function resetData(){
    if(confirm('Reset all habits and history?')) {
      state = {habits:[], records:{}};
      saveState();
      render();
    }
  }

  function toggle(habitId, date){
    if(!state.records[date]) state.records[date] = {};
    state.records[date][habitId] = !state.records[date][habitId];
    if(!state.records[date][habitId]) delete state.records[date][habitId];
    saveState();
    renderStatsOnly();
    renderGridOnly();
  }

  function removeHabit(id){
    if(!confirm('Remove habit and its history?')) return;
    state.habits = state.habits.filter(h=>h.id!==id);
    for(const d in state.records){
      if(state.records[d][id]) delete state.records[d][id];
      if(Object.keys(state.records[d]).length===0) delete state.records[d];
    }
    saveState();
    render();
  }

  function isCompleted(habitId, date){
    return !!(state.records[date] && state.records[date][habitId]);
  }

  function streakFor(habit){
    let streak=0;
    for(let i=dateWindow.length-1;i>=0;i--){
      const date=dateWindow[i];
      if(date < habit.created) continue;
      if(isCompleted(habit.id,date)) streak++;
      else break;
    }
    return streak;
  }

  function completionFor(habit){
    const eligible = dateWindow.filter(d=>d>=habit.created);
    const done = eligible.filter(d=>isCompleted(habit.id,d)).length;
    const pct = eligible.length ? Math.round((done/eligible.length)*100) : 0;
    return {done, total: eligible.length, pct};
  }

  function overallTodayCompletion(){
    const today = todayStr();
    if(state.habits.length===0) return 0;
    const done = state.habits.filter(h=>isCompleted(h.id,today)).length;
    return Math.round((done/state.habits.length)*100);
  }

  function longestStreak(){
    let max=0;
    state.habits.forEach(h=>{max=Math.max(max, streakFor(h));});
    return max;
  }

  function renderTopStats(){
    const stats = [
      {label:'Total habits', value: state.habits.length},
      {label:"Today's completion", value: overallTodayCompletion()+'%'},
      {label:'Longest streak', value: longestStreak()+' days'},
      {label:'Days visible', value: DAY_COUNT}
    ];
    elements.topStats.innerHTML = stats.map(s=>`
      <div class="stat">
        <div class="label">${s.label}</div>
        <div class="value">${s.value}</div>
      </div>
    `).join('');
  }

  function renderGrid(){
    const dates = dateWindow;
    if(state.habits.length===0){
      elements.tableWrapper.innerHTML = `<div class="empty">Add a habit to start tracking your streaks!</div>`;
      return;
    }
    const head = `
      <thead>
        <tr>
          <th>Habit / Stats</th>
          ${dates.map(d=>`<th title="${d}"><div class="day-label">${weekdayShort(d)}</div>${humanDate(d)}</th>`).join('')}
        </tr>
      </thead>`;
    const rows = state.habits.map(habit=>{
      const streak = streakFor(habit);
      const comp = completionFor(habit);
      const cells = dates.map(date=>{
        const done = isCompleted(habit.id,date);
        return `<td><div class="day-cell ${done?'done':''}" data-habit="${habit.id}" data-date="${date}" title="${habit.name} on ${date}"></div></td>`;
      }).join('');
      return `<tr>
        <td>
          <div class="habit-name">${habit.name}</div>
          <div class="meta">Streak: ${streak} â€¢ ${comp.pct}% (${comp.done}/${comp.total})</div>
          <div class="progress"><div class="bar" style="width:${comp.pct}%;"></div></div>
          <div class="actions">
            <small class="meta">Added ${habit.created}</small>
            <button class="remove" data-remove="${habit.id}">Remove</button>
          </div>
        </td>
        ${cells}
      </tr>`;
    }).join('');
    elements.tableWrapper.innerHTML = `<table>${head}<tbody>${rows}</tbody></table>`;
    attachCellHandlers();
  }

  function attachCellHandlers(){
    const cells = elements.tableWrapper.querySelectorAll('.day-cell');
    cells.forEach(cell=>{
      cell.onclick = ()=> toggle(cell.dataset.habit, cell.dataset.date);
    });
    const removeBtns = elements.tableWrapper.querySelectorAll('[data-remove]');
    removeBtns.forEach(btn=>{
      btn.onclick = ()=> removeHabit(btn.dataset.remove);
    });
  }

  function render(){
    renderTopStats();
    renderGrid();
  }

  function renderStatsOnly(){
    renderTopStats();
  }
  function renderGridOnly(){
    renderGrid();
  }

  elements.addBtn.onclick = addHabit;
  elements.input.addEventListener('keypress', e=>{
    if(e.key==='Enter') addHabit();
  });
  elements.clearBtn.onclick = resetData;

  render();
})();
</script>
</body>
</html>