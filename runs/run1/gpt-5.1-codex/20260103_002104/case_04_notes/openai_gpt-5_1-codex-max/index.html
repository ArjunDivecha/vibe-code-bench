<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Minimal Notes</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
:root {
  --bg: #f7f8fb;
  --card: #ffffff;
  --accent: #3f88ff;
  --text: #1f2733;
  --muted: #6b7280;
  --border: #e5e7eb;
}
* { box-sizing: border-box; }
body {
  margin: 0;
  font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
  background: var(--bg);
  color: var(--text);
}
header {
  padding: 20px;
  display: flex;
  align-items: center;
  gap: 12px;
  justify-content: space-between;
  flex-wrap: wrap;
}
h1 { margin: 0; font-weight: 700; letter-spacing: -0.5px; }
.controls {
  display: flex; gap: 8px; flex: 1; justify-content: flex-end; flex-wrap: wrap;
}
input[type="text"] {
  border: 1px solid var(--border);
  border-radius: 10px;
  padding: 10px 12px;
  font-size: 14px;
  width: 220px;
  background: #fff;
}
button {
  border: none;
  border-radius: 10px;
  padding: 10px 14px;
  background: var(--accent);
  color: #fff;
  font-weight: 600;
  cursor: pointer;
  box-shadow: 0 6px 16px rgba(63,136,255,0.18);
  transition: transform 0.1s ease, box-shadow 0.2s ease;
}
button:hover { transform: translateY(-1px); }
button:active { transform: translateY(0); box-shadow: 0 3px 10px rgba(63,136,255,0.25); }
#app { max-width: 1100px; margin: 0 auto 60px; padding: 0 20px 30px; }
form {
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: 14px;
  padding: 16px;
  margin: 0 20px 20px;
  display: none;
  box-shadow: 0 12px 35px rgba(0,0,0,0.04);
}
form.visible { display: block; }
label { display: block; font-size: 13px; color: var(--muted); margin-bottom: 4px; }
#title {
  width: 100%;
  padding: 12px 14px;
  border-radius: 10px;
  border: 1px solid var(--border);
  font-size: 15px;
}
.toolbar {
  display: flex; align-items: center; gap: 8px; margin: 12px 0 6px;
}
.toolbar button {
  padding: 8px 10px;
  background: #f0f4ff;
  color: var(--accent);
  box-shadow: none;
}
#content {
  border: 1px solid var(--border);
  border-radius: 10px;
  min-height: 160px;
  padding: 12px;
  font-size: 15px;
  background: #fff;
  overflow-y: auto;
}
#content:focus { outline: 2px solid rgba(63,136,255,0.2); }
.actions {
  margin-top: 14px;
  display: flex;
  gap: 10px;
}
.actions .secondary {
  background: #fff;
  color: var(--text);
  border: 1px solid var(--border);
  box-shadow: none;
}
.actions .danger {
  background: #ff6b6b;
  box-shadow: 0 6px 16px rgba(255,107,107,0.25);
}
.grid {
  display: grid;
  grid-template-columns: repeat(auto-fill,minmax(240px,1fr));
  gap: 14px;
  padding: 0 20px;
}
.card {
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 14px;
  cursor: pointer;
  position: relative;
  box-shadow: 0 10px 30px rgba(0,0,0,0.03);
  transition: transform 0.08s ease, box-shadow 0.2s ease;
}
.card:hover { transform: translateY(-2px); box-shadow: 0 16px 35px rgba(0,0,0,0.05); }
.card h3 {
  margin: 0 0 6px; font-size: 16px; line-height: 1.2;
}
.card p {
  margin: 0; color: var(--muted); font-size: 14px; line-height: 1.4;
  max-height: 68px; overflow: hidden;
}
.time {
  margin-top: 8px;
  font-size: 12px;
  color: var(--muted);
}
.empty {
  text-align: center;
  color: var(--muted);
  padding: 30px;
}
</style>
</head>
<body>
<header>
  <h1>Notes</h1>
  <div class="controls">
    <input id="search" type="text" placeholder="Search notes...">
    <button id="newNote">New note</button>
  </div>
</header>

<div id="app">
  <form id="noteForm">
    <div>
      <label for="title">Title</label>
      <input id="title" type="text" placeholder="Note title">
    </div>
    <div class="toolbar" aria-label="Formatting">
      <button type="button" data-cmd="bold"><b>B</b></button>
      <button type="button" data-cmd="italic"><i>I</i></button>
      <button type="button" data-cmd="underline"><u>U</u></button>
    </div>
    <div id="content" contenteditable="true" aria-label="Note content"></div>
    <div class="actions">
      <button type="submit">Save</button>
      <button type="button" class="secondary" id="cancel">Cancel</button>
      <button type="button" class="danger" id="deleteBtn" style="margin-left:auto; display:none;">Delete</button>
    </div>
  </form>

  <div id="notesGrid" class="grid"></div>
</div>

<script>
(() => {
  const storageKey = 'simple-notes-app';
  const form = document.getElementById('noteForm');
  const titleInput = document.getElementById('title');
  const contentDiv = document.getElementById('content');
  const searchInput = document.getElementById('search');
  const grid = document.getElementById('notesGrid');
  const newNoteBtn = document.getElementById('newNote');
  const cancelBtn = document.getElementById('cancel');
  const deleteBtn = document.getElementById('deleteBtn');
  let currentId = null;

  const loadNotes = () => {
    try {
      const data = JSON.parse(localStorage.getItem(storageKey));
      return Array.isArray(data) ? data : [];
    } catch (e) {
      console.warn('Failed to parse saved notes', e);
      return [];
    }
  };

  const saveNotes = (notes) => {
    localStorage.setItem(storageKey, JSON.stringify(notes));
  };

  const formatDate = (ts) => {
    const d = new Date(ts);
    return d.toLocaleDateString(undefined, { month: 'short', day: 'numeric' }) + ' Â· ' +
           d.toLocaleTimeString(undefined, { hour: '2-digit', minute: '2-digit' });
  };

  const renderNotes = () => {
    const filter = searchInput.value.toLowerCase().trim();
    const notes = loadNotes().sort((a,b) => b.updatedAt - a.updatedAt);
    grid.innerHTML = '';
    const filtered = notes.filter(n => 
      n.title.toLowerCase().includes(filter) || stripHtml(n.content).toLowerCase().includes(filter)
    );
    if (!filtered.length) {
      grid.innerHTML = `<div class="empty">No notes ${filter ? 'match your search.' : 'yet. Create one!'}</div>`;
      return;
    }
    filtered.forEach(note => {
      const card = document.createElement('div');
      card.className = 'card';
      card.dataset.id = note.id;
      card.innerHTML = `
        <h3>${escapeHtml(note.title || 'Untitled')}</h3>
        <p>${escapeHtml(stripHtml(note.content)).slice(0,160) || 'No content'}</p>
        <div class="time">${formatDate(note.updatedAt)}</div>
      `;
      card.addEventListener('click', () => openNote(note.id));
      grid.appendChild(card);
    });
  };

  const stripHtml = (html) => {
    const div = document.createElement('div');
    div.innerHTML = html;
    return div.textContent || '';
  };

  const escapeHtml = (str) => {
    return str.replace(/[&<>]/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;'}[c]));
  };

  const resetForm = () => {
    currentId = null;
    titleInput.value = '';
    contentDiv.innerHTML = '';
    deleteBtn.style.display = 'none';
  };

  const openForm = () => form.classList.add('visible');
  const closeForm = () => form.classList.remove('visible');

  const openNote = (id) => {
    const note = loadNotes().find(n => n.id === id);
    if (!note) return;
    currentId = id;
    titleInput.value = note.title;
    contentDiv.innerHTML = note.content;
    deleteBtn.style.display = 'inline-block';
    openForm();
    titleInput.focus();
  };

  newNoteBtn.addEventListener('click', () => {
    resetForm();
    openForm();
    titleInput.focus();
  });

  cancelBtn.addEventListener('click', () => {
    resetForm();
    closeForm();
  });

  form.addEventListener('submit', (e) => {
    e.preventDefault();
    const title = titleInput.value.trim() || 'Untitled';
    const content = contentDiv.innerHTML.trim();
    const notes = loadNotes();
    const now = Date.now();
    if (currentId) {
      const idx = notes.findIndex(n => n.id === currentId);
      if (idx !== -1) {
        notes[idx] = { ...notes[idx], title, content, updatedAt: now };
      }
    } else {
      notes.push({ id: cryptoId(), title, content, createdAt: now, updatedAt: now });
    }
    saveNotes(notes);
    resetForm();
    closeForm();
    renderNotes();
  });

  deleteBtn.addEventListener('click', () => {
    if (!currentId) return;
    if (!confirm('Delete this note?')) return;
    const notes = loadNotes().filter(n => n.id !== currentId);
    saveNotes(notes);
    resetForm();
    closeForm();
    renderNotes();
  });

  searchInput.addEventListener('input', () => renderNotes());

  document.querySelectorAll('.toolbar button').forEach(btn => {
    btn.addEventListener('click', () => {
      contentDiv.focus();
      document.execCommand(btn.dataset.cmd, false, null);
    });
  });

  const cryptoId = () => 'note-' + Math.random().toString(36).slice(2,9) + Date.now().toString(36);

  // Initialize
  renderNotes();
})();
</script>
</body>
</html>