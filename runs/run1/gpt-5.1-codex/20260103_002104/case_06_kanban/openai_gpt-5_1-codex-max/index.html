<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Simple Kanban Board</title>
<style>
    * { box-sizing: border-box; }
    body {
        margin: 0;
        font-family: Arial, sans-serif;
        background: #f4f6f8;
        color: #333;
    }
    header {
        background: #0069d9;
        color: #fff;
        padding: 16px 24px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        flex-wrap: wrap;
    }
    header h1 {
        margin: 0;
        font-size: 20px;
    }
    .add-form {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
    }
    .add-form input, .add-form select, .add-form button {
        padding: 8px 10px;
        border-radius: 4px;
        border: none;
        font-size: 14px;
    }
    .add-form input, .add-form select {
        background: #fff;
        color: #333;
        min-width: 160px;
    }
    .add-form button {
        background: #28a745;
        color: white;
        cursor: pointer;
    }
    .add-form button:hover { background: #218838; }
    .board {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 16px;
        padding: 16px;
        height: calc(100vh - 88px);
    }
    .column {
        background: #e9ecef;
        border-radius: 6px;
        display: flex;
        flex-direction: column;
        overflow: hidden;
    }
    .column h2 {
        margin: 0;
        padding: 12px 14px;
        background: #dee2e6;
        font-size: 16px;
        border-bottom: 1px solid #d1d5d9;
    }
    .card-list {
        padding: 10px;
        flex: 1;
        overflow-y: auto;
    }
    .card {
        padding: 10px;
        margin-bottom: 10px;
        border-radius: 6px;
        background: white;
        box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        cursor: grab;
        border: 2px solid transparent;
    }
    .card:hover { box-shadow: 0 2px 6px rgba(0,0,0,0.12); }
    .card.dragging {
        opacity: 0.5;
    }
    .drop-target {
        outline: 2px dashed #6c757d;
        outline-offset: -6px;
    }
    .priority {
        display: inline-block;
        width: 10px;
        height: 10px;
        border-radius: 50%;
        margin-right: 6px;
    }
    .priority.low { background: #28a745; }
    .priority.medium { background: #ffc107; }
    .priority.urgent { background: #dc3545; }
    .card-title { display: inline; }
    .empty-text {
        color: #6c757d;
        font-size: 13px;
        text-align: center;
        margin-top: 20px;
    }
    @media (max-width: 900px) {
        .board { grid-template-columns: 1fr; height: auto; }
    }
</style>
</head>
<body>
<header>
    <h1>Kanban Board</h1>
    <form class="add-form" id="addForm">
        <input type="text" id="titleInput" placeholder="Card title" required>
        <select id="priorityInput" required>
            <option value="urgent">Urgent (Red)</option>
            <option value="medium" selected>Medium (Yellow)</option>
            <option value="low">Low (Green)</option>
        </select>
        <select id="columnInput">
            <option value="todo" selected>To Do</option>
            <option value="inprogress">In Progress</option>
            <option value="done">Done</option>
        </select>
        <button type="submit">Add Card</button>
    </form>
</header>

<div class="board" id="board">
    <div class="column" data-column="todo">
        <h2>To Do</h2>
        <div class="card-list" data-list="todo"></div>
    </div>
    <div class="column" data-column="inprogress">
        <h2>In Progress</h2>
        <div class="card-list" data-list="inprogress"></div>
    </div>
    <div class="column" data-column="done">
        <h2>Done</h2>
        <div class="card-list" data-list="done"></div>
    </div>
</div>

<script>
(function(){
    const STORAGE_KEY = 'simple_kanban_board_v1';
    let state = loadState();

    const boardEl = document.getElementById('board');
    const addForm = document.getElementById('addForm');
    const titleInput = document.getElementById('titleInput');
    const priorityInput = document.getElementById('priorityInput');
    const columnInput = document.getElementById('columnInput');

    function loadState() {
        try {
            const raw = localStorage.getItem(STORAGE_KEY);
            if (!raw) return defaultState();
            const parsed = JSON.parse(raw);
            if (!parsed || typeof parsed !== 'object') return defaultState();
            ['todo','inprogress','done'].forEach(col => {
                if (!Array.isArray(parsed[col])) parsed[col] = [];
            });
            return parsed;
        } catch (e) {
            console.warn('Failed to load state, using default.', e);
            return defaultState();
        }
    }

    function defaultState() {
        return { todo: [], inprogress: [], done: [] };
    }

    function saveState() {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
    }

    function render() {
        const lists = document.querySelectorAll('.card-list');
        lists.forEach(list => {
            const col = list.dataset.list;
            list.innerHTML = '';
            if (!state[col] || state[col].length === 0) {
                const empty = document.createElement('div');
                empty.className = 'empty-text';
                empty.textContent = 'No cards';
                list.appendChild(empty);
                return;
            }
            state[col].forEach(card => {
                const cardEl = document.createElement('div');
                cardEl.className = 'card';
                cardEl.setAttribute('draggable', 'true');
                cardEl.dataset.id = card.id;
                cardEl.dataset.column = col;

                const dot = document.createElement('span');
                dot.className = 'priority ' + card.priority;
                cardEl.appendChild(dot);

                const title = document.createElement('span');
                title.className = 'card-title';
                title.textContent = card.title;
                cardEl.appendChild(title);

                cardEl.addEventListener('dragstart', onDragStart);
                cardEl.addEventListener('dragend', onDragEnd);
                cardEl.addEventListener('click', () => openEdit(card.id, col));
                list.appendChild(cardEl);
            });
        });
    }

    function addCard(title, priority, column) {
        const card = {
            id: 'c_' + Date.now().toString(36) + Math.random().toString(36).slice(2,6),
            title: title.trim(),
            priority
        };
        state[column].push(card);
        saveState();
        render();
    }

    function findCard(cardId) {
        for (const col of ['todo','inprogress','done']) {
            const idx = state[col].findIndex(c => c.id === cardId);
            if (idx !== -1) return { col, idx, card: state[col][idx] };
        }
        return null;
    }

    function moveCard(cardId, newCol) {
        const found = findCard(cardId);
        if (!found || found.col === newCol) return;
        const card = state[found.col].splice(found.idx, 1)[0];
        state[newCol].push(card);
        saveState();
        render();
    }

    function onDragStart(e) {
        e.dataTransfer.effectAllowed = 'move';
        e.dataTransfer.setData('text/plain', e.target.dataset.id);
        e.target.classList.add('dragging');
    }

    function onDragEnd(e) {
        e.target.classList.remove('dragging');
        document.querySelectorAll('.card-list').forEach(list => list.classList.remove('drop-target'));
    }

    boardEl.querySelectorAll('.card-list').forEach(list => {
        list.addEventListener('dragover', e => {
            e.preventDefault();
            list.classList.add('drop-target');
        });
        list.addEventListener('dragleave', () => list.classList.remove('drop-target'));
        list.addEventListener('drop', e => {
            e.preventDefault();
            list.classList.remove('drop-target');
            const cardId = e.dataTransfer.getData('text/plain');
            if (!cardId) return;
            moveCard(cardId, list.dataset.list);
        });
    });

    function openEdit(cardId, column) {
        const found = findCard(cardId);
        if (!found) return;
        const card = found.card;
        const newTitle = prompt('Edit title (leave empty to delete):', card.title);
        if (newTitle === null) return; // cancel
        const trimmed = newTitle.trim();
        if (trimmed === '') {
            const confirmDelete = confirm('Delete this card?');
            if (confirmDelete) {
                state[found.col].splice(found.idx, 1);
                saveState();
                render();
            }
            return;
        }
        const newPriority = prompt('Set priority: urgent (red), medium (yellow), low (green)', card.priority) || card.priority;
        const validPriorities = ['urgent','medium','low'];
        card.title = trimmed;
        card.priority = validPriorities.includes(newPriority.trim().toLowerCase()) ? newPriority.trim().toLowerCase() : card.priority;
        saveState();
        render();
    }

    addForm.addEventListener('submit', e => {
        e.preventDefault();
        const title = titleInput.value.trim();
        if (!title) {
            alert('Please enter a title.');
            return;
        }
        addCard(title, priorityInput.value, columnInput.value);
        titleInput.value = '';
        titleInput.focus();
    });

    // Initialize
    render();
})();
</script>
</body>
</html>