<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Vibe-Law | Legal Case Search Workspace</title>
<style>
    :root {
        --bg: #0f172a;
        --panel: #111827;
        --panel-2: #0b1220;
        --accent: #22d3ee;
        --text: #e5e7eb;
        --muted: #94a3b8;
        --border: #1f2937;
        --danger: #ef4444;
        --success: #22c55e;
        --chip: #1e293b;
    }
    * { box-sizing: border-box; }
    body {
        margin: 0;
        font-family: "Inter", system-ui, -apple-system, sans-serif;
        background: radial-gradient(120% 120% at 10% 10%, #0b1d36, #0c1424 45%, #0a0f1c);
        color: var(--text);
        min-height: 100vh;
    }
    header {
        padding: 18px 26px;
        border-bottom: 1px solid var(--border);
        display: flex;
        align-items: center;
        gap: 18px;
        background: linear-gradient(120deg, rgba(34,211,238,0.1), transparent);
    }
    .brand {
        font-weight: 700;
        letter-spacing: 0.5px;
        color: var(--text);
        font-size: 20px;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    .brand .dot {
        width: 12px; height: 12px; border-radius: 50%;
        background: var(--accent);
        box-shadow: 0 0 18px rgba(34,211,238,0.7);
    }
    .search-bar {
        position: relative;
        flex: 1;
    }
    .search-bar input {
        width: 100%;
        padding: 12px 16px 12px 44px;
        background: var(--panel);
        border: 1px solid var(--border);
        border-radius: 10px;
        color: var(--text);
        font-size: 15px;
        outline: none;
        transition: border 0.15s, box-shadow 0.15s;
    }
    .search-bar input:focus {
        border-color: var(--accent);
        box-shadow: 0 0 0 3px rgba(34,211,238,0.15);
    }
    .search-bar svg {
        position: absolute;
        top: 50%; left: 14px;
        transform: translateY(-50%);
        width: 18px; height: 18px;
        stroke: var(--muted);
    }
    main {
        display: grid;
        grid-template-columns: 34% 66%;
        min-height: calc(100vh - 80px);
    }
    .column {
        padding: 18px 18px 24px;
        overflow: hidden;
    }
    .panel {
        background: var(--panel-2);
        border: 1px solid var(--border);
        border-radius: 12px;
        height: 100%;
        display: flex;
        flex-direction: column;
        box-shadow: 0 10px 30px rgba(0,0,0,0.28);
    }
    .panel-header {
        padding: 14px 16px;
        border-bottom: 1px solid var(--border);
        display: flex;
        align-items: center;
        justify-content: space-between;
    }
    .panel-header h3 {
        margin: 0;
        font-size: 15px;
        letter-spacing: 0.3px;
        color: #cbd5f5;
        text-transform: uppercase;
    }
    .case-list {
        padding: 8px 6px 10px;
        overflow-y: auto;
    }
    .case-item {
        padding: 12px 12px 10px;
        border-radius: 10px;
        border: 1px solid var(--border);
        margin: 6px 6px;
        background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0));
        cursor: pointer;
        transition: border 0.15s, transform 0.1s, background 0.15s;
    }
    .case-item:hover {
        border-color: rgba(34,211,238,0.3);
        transform: translateY(-2px);
        background: rgba(34,211,238,0.02);
    }
    .case-item.active {
        border-color: var(--accent);
        background: rgba(34,211,238,0.05);
        box-shadow: 0 8px 24px rgba(34,211,238,0.12);
    }
    .case-title { font-weight: 600; margin: 0 0 4px; color: #e2e8f0; }
    .meta { font-size: 13px; color: var(--muted); display: flex; gap: 10px; margin-bottom: 6px; }
    .snippet { color: #cbd5f5; font-size: 13px; line-height: 1.45; }
    .chip {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        background: var(--chip);
        border-radius: 999px;
        padding: 6px 10px;
        color: var(--muted);
        font-size: 12px;
        border: 1px solid var(--border);
    }
    .detail-grid {
        display: grid;
        grid-template-columns: 65% 35%;
        height: 100%;
    }
    .detail-main {
        border-right: 1px solid var(--border);
        display: flex;
        flex-direction: column;
        min-height: 0;
    }
    .detail-header {
        padding: 16px 18px;
        border-bottom: 1px solid var(--border);
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 10px;
    }
    .detail-title {
        font-size: 18px;
        margin: 0;
        color: #f8fafc;
    }
    .detail-meta {
        color: var(--muted);
        display: flex;
        gap: 12px;
        font-size: 13px;
    }
    .tab-bar {
        display: flex;
        gap: 8px;
        padding: 10px 14px 0 14px;
    }
    .tab {
        padding: 10px 14px;
        border-radius: 10px 10px 0 0;
        border: 1px solid var(--border);
        border-bottom: none;
        background: var(--panel);
        color: var(--muted);
        cursor: pointer;
        font-weight: 600;
        letter-spacing: 0.3px;
        transition: color 0.15s, border 0.15s, background 0.15s;
    }
    .tab.active {
        color: var(--text);
        background: #111827;
        border-color: rgba(34,211,238,0.4);
        box-shadow: inset 0 2px 0 rgba(34,211,238,0.8);
    }
    .detail-content {
        padding: 14px 18px 18px;
        overflow-y: auto;
        background: var(--panel);
        border-top: 1px solid var(--border);
        line-height: 1.6;
        color: #dbeafe;
        flex: 1;
    }
    .detail-content p { margin: 0 0 12px; }
    .controls {
        display: flex;
        align-items: center;
        gap: 10px;
    }
    button {
        background: linear-gradient(135deg, #0ea5e9, #22d3ee);
        color: #0b1220;
        border: none;
        padding: 10px 12px;
        border-radius: 10px;
        font-weight: 700;
        letter-spacing: 0.3px;
        cursor: pointer;
        transition: transform 0.1s, box-shadow 0.15s;
        box-shadow: 0 10px 20px rgba(34,211,238,0.22);
    }
    button:hover { transform: translateY(-1px); }
    .ghost {
        background: transparent;
        color: var(--muted);
        border: 1px solid var(--border);
        box-shadow: none;
    }
    .ghost:hover { border-color: rgba(34,211,238,0.3); color: var(--text); }
    .notes {
        display: flex;
        flex-direction: column;
        height: 100%;
        background: var(--panel);
        border-radius: 0 12px 12px 0;
    }
    .notes-header {
        padding: 14px 16px;
        border-bottom: 1px solid var(--border);
        display: flex;
        align-items: center;
        justify-content: space-between;
    }
    .notes-header h4 {
        margin: 0;
        letter-spacing: 0.3px;
        text-transform: uppercase;
        font-size: 14px;
        color: #cbd5f5;
    }
    .notes-body {
        padding: 12px 14px 14px;
        display: flex;
        flex-direction: column;
        gap: 10px;
        overflow: hidden;
    }
    .notes textarea {
        width: 100%;
        background: #0c1423;
        border: 1px solid var(--border);
        border-radius: 10px;
        color: var(--text);
        padding: 10px 12px;
        resize: vertical;
        min-height: 70px;
    }
    .note-actions {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
    }
    .note-actions button {
        flex: 1;
        min-width: 120px;
    }
    .note-list {
        overflow-y: auto;
        flex: 1;
        padding-right: 2px;
    }
    .note-item {
        border: 1px solid var(--border);
        border-radius: 10px;
        padding: 10px 12px;
        margin-bottom: 8px;
        background: rgba(255,255,255,0.02);
    }
    .note-meta {
        font-size: 12px;
        color: var(--muted);
        display: flex;
        justify-content: space-between;
        gap: 8px;
        margin-bottom: 6px;
    }
    .note-text { color: #e5e7eb; white-space: pre-wrap; line-height: 1.45; }
    .pill {
        padding: 4px 8px;
        border-radius: 999px;
        background: rgba(34,211,238,0.12);
        color: var(--accent);
        font-weight: 700;
        font-size: 11px;
        letter-spacing: 0.4px;
    }
    .highlight {
        background: rgba(34,211,238,0.18);
        border-radius: 4px;
        padding: 1px 3px;
        color: #e0f2fe;
    }
    .empty-state {
        text-align: center;
        color: var(--muted);
        padding: 20px 8px;
        font-size: 14px;
    }
    .badge-count {
        background: rgba(34,211,238,0.2);
        color: var(--accent);
        padding: 4px 10px;
        border-radius: 999px;
        font-size: 12px;
        font-weight: 700;
    }
    @media (max-width: 1100px) {
        main { grid-template-columns: 1fr; }
        .detail-grid { grid-template-columns: 1fr; }
        .detail-main { border-right: none; }
        .notes { border-radius: 0 0 12px 12px; border-top: 1px solid var(--border); }
    }
</style>
</head>
<body>
<header>
    <div class="brand"><span class="dot"></span>Vibe-Law Workspace</div>
    <div class="search-bar">
        <svg viewBox="0 0 24 24" fill="none" stroke-width="2">
            <circle cx="11" cy="11" r="7" stroke="currentColor"/>
            <line x1="16.65" y1="16.65" x2="21" y2="21" stroke="currentColor"/>
        </svg>
        <input id="searchInput" type="search" placeholder="Search case title, court, or keywords...">
    </div>
</header>
<main>
    <section class="column">
        <div class="panel">
            <div class="panel-header">
                <h3>Case Results</h3>
                <span class="badge-count" id="resultCount">0</span>
            </div>
            <div class="case-list" id="caseList"></div>
        </div>
    </section>
    <section class="column">
        <div class="panel">
            <div class="detail-grid">
                <div class="detail-main">
                    <div class="detail-header">
                        <div>
                            <p class="detail-title" id="detailTitle">Select a case to view details</p>
                            <div class="detail-meta" id="detailMeta"></div>
                        </div>
                        <div class="controls">
                            <button class="ghost" id="toggleHighlightBtn" disabled>Extract Entities</button>
                        </div>
                    </div>
                    <div class="tab-bar">
                        <div class="tab active" data-tab="summary">Summary</div>
                        <div class="tab" data-tab="full">Full Text</div>
                    </div>
                    <div class="detail-content" id="detailContent">
                        <div class="empty-state">Choose a case from the left to preview its summary or full opinion text.</div>
                    </div>
                </div>
                <aside class="notes">
                    <div class="notes-header">
                        <h4>Notes & Snippets</h4>
                        <button class="ghost" id="clearNotesBtn">Clear</button>
                    </div>
                    <div class="notes-body">
                        <textarea id="noteInput" placeholder="Type a note or highlight text in the opinion, then click “Save Selection”."></textarea>
                        <div class="note-actions">
                            <button id="saveTypedBtn">Save Typed Note</button>
                            <button class="ghost" id="saveSelectionBtn">Save Selection</button>
                        </div>
                        <div class="note-list" id="noteList"></div>
                    </div>
                </aside>
            </div>
        </div>
    </section>
</main>
<script>
const caseData = [
    {
        title: "United States v. Harper",
        court: "U.S. Court of Appeals, Ninth Circuit",
        date: "March 2, 2022",
        snippet: "Analysis of warrant scope and digital devices seized during a narcotics investigation.",
        summary: "The Ninth Circuit affirmed the district court's suppression ruling in part, holding that the warrant's language did not authorize a wholesale search of all digital devices seized. The court reiterated that particularity requirements apply equally to modern smartphones and laptops, referencing Riley v. California. Harper's conviction was vacated and remanded for further proceedings.",
        fullText: "In United States v. Harper, the panel considered whether the government's search of Harper's smartphone exceeded the scope of the warrant. The warrant authorized seizure of devices but did not include limiting protocols. Citing Riley v. California and United States v. Comprehensive Drug Testing, the court held that investigators must employ search protocols that narrow access to relevant categories. Because Agent Collins accessed unrelated photo archives dated March 2020, the panel found a Fourth Amendment violation. The conviction was vacated and the matter remanded for a new trial without the tainted evidence."
    },
    {
        title: "Garcia v. City of Portland",
        court: "U.S. District Court, District of Oregon",
        date: "July 14, 2021",
        snippet: "Protest-related excessive force claims under §1983 and qualified immunity.",
        summary: "Judge Albright denied the officers' motion for summary judgment on excessive force claims brought by demonstrators. Video evidence showed Garcia was struck with impact munitions while posing no immediate threat. The court found clearly established law prohibiting such force against non-violent protestors, defeating qualified immunity.",
        fullText: "During a series of July 2020 demonstrations, Plaintiff Maria Garcia alleged that Officers Delaney and Cho discharged less-lethal munitions without warning. Footage captured on July 18, 2020, depicted Garcia standing with hands raised. Relying on Deorle v. Rutherford, the court concluded that warning requirements were well-established. Because factual disputes existed and the officers' conduct could violate clearly established rights, qualified immunity was denied."
    },
    {
        title: "State v. Patel",
        court: "Supreme Court of Washington",
        date: "November 9, 2020",
        snippet: "Use of automated license plate readers and Article I, Section 7 privacy protections.",
        summary: "The court held that long-term aggregation of license plate reader data constituted a search under the state constitution. Patel's motion to suppress was granted, emphasizing heightened privacy protections against pervasive surveillance. The ruling distinguished federal Fourth Amendment doctrine, relying instead on independent state grounds.",
        fullText: "Washington's Article I, Section 7 provides broader privacy protections than the Fourth Amendment. Over a period exceeding 90 days, law enforcement compiled thousands of scans of Patel's vehicle using automated license plate readers. The majority, authored by Justice Nguyen, concluded that this persistent tracking invaded private affairs. The state failed to demonstrate a valid warrant or exception. Consequently, evidence derived from the scans was suppressed and charges dismissed."
    },
    {
        title: "Johnson v. Redwood Health",
        court: "California Court of Appeal, Fourth District",
        date: "May 5, 2023",
        snippet: "HIPAA preemption and state medical confidentiality claims.",
        summary: "The appellate court reversed dismissal of Johnson's complaint, finding that HIPAA did not preempt California's Confidentiality of Medical Information Act. Johnson plausibly alleged unauthorized disclosures to third-party advertisers. The matter was remanded for discovery.",
        fullText: "Plaintiff Sarah Johnson alleged that Redwood Health shared patient portal activity with third-party analytics vendors. The trial court dismissed, concluding HIPAA preempted state law claims. The Court of Appeal disagreed, citing Brown v. Mortensen, and clarified that HIPAA establishes a federal floor, not a ceiling. Because Johnson alleged concrete privacy harms in April 2021, the complaint stated viable causes of action."
    },
    {
        title: "People v. Ortega",
        court: "New York Court of Appeals",
        date: "December 1, 2019",
        snippet: "Admissibility of cell-site location information obtained without a warrant.",
        summary: "The Court of Appeals held that obtaining seven days of historical CSLI without a warrant violated the New York Constitution. Applying Carpenter's reasoning, the court suppressed the records and vacated Ortega's conviction. The opinion underscored the need for judicial oversight in digital surveillance.",
        fullText: "Detectives obtained Ortega's CSLI covering October 2–9, 2017 via a court order under the Stored Communications Act. The court found this method insufficient under Article I, Section 12. Chief Judge Rivera wrote that prolonged access to location data revealed intimate details of Ortega's life. The conviction was vacated and the case remanded."
    },
    {
        title: "Mendez v. Horizon Insurance",
        court: "U.S. Court of Appeals, Fifth Circuit",
        date: "August 16, 2022",
        snippet: "Bad-faith denial of hurricane damage claims and appraisal clauses.",
        summary: "The Fifth Circuit affirmed judgment in favor of Mendez, holding Horizon acted in bad faith by delaying appraisal for over 120 days after Hurricane Laura. The insurer's reliance on an internal engineer's report was found pretextual. Damages and attorney's fees were upheld.",
        fullText: "After Hurricane Laura struck in August 2020, Mendez submitted claims for wind damage. Horizon Insurance delayed appraisal until January 2021. The panel noted internal emails from October 12, 2020 showing intent to postpone payment. Applying Texas Insurance Code §542, the court affirmed statutory interest and fees. The judgment was affirmed in full."
    },
    {
        title: "In re Quantum Devices",
        court: "U.S. Bankruptcy Court, District of Delaware",
        date: "February 10, 2023",
        snippet: "DIP financing approval and challenge period extensions.",
        summary: "The bankruptcy court approved debtor-in-possession financing with a modified challenge period. The creditors' committee obtained an additional 30 days to investigate liens asserted by Apex Capital. The court balanced liquidity needs against the integrity of lien investigations.",
        fullText: "Quantum Devices filed Chapter 11 on January 4, 2023. The proposed DIP facility from Apex Capital included a 45-day challenge period. The committee argued this was insufficient to review liens recorded in 2018 and 2019. Judge Feldman extended the challenge period to 75 days, noting the complexity of prepetition transactions while emphasizing the debtor's immediate need for liquidity."
    },
    {
        title: "Anderson v. GreenTech Solar",
        court: "U.S. District Court, Northern District of California",
        date: "October 4, 2022",
        snippet: "Shareholder derivative action alleging oversight failures under Caremark.",
        summary: "The court dismissed without prejudice, finding plaintiffs failed to plead particularized facts showing board knowledge of regulatory violations. However, emails dated June 2021 suggested possible awareness, warranting limited leave to amend. Demand futility was not sufficiently alleged.",
        fullText: "Derivative plaintiffs claimed GreenTech Solar's directors ignored warning letters from the Department of Energy. Applying Delaware's Caremark standard, Judge Lin noted that mere receipt of agency letters did not show conscious disregard. Still, emails dated June 14, 2021 hinted at board-level discussions. The complaint was dismissed with leave to amend within 30 days."
    },
    {
        title: "Commonwealth v. Hayes",
        court: "Supreme Judicial Court of Massachusetts",
        date: "January 12, 2021",
        snippet: "Sufficiency of evidence in a homicide conviction resting on circumstantial proof.",
        summary: "The SJC affirmed Hayes's conviction, concluding that the circumstantial evidence—timing, motive, and forensic traces—met the Commonwealth's burden. The court clarified the standard for excluding reasonable hypotheses of innocence, emphasizing deference to juries.",
        fullText: "Hayes challenged the sufficiency of the evidence connecting him to the June 3, 2018 shooting. The court noted surveillance footage placing Hayes near the scene at 10:47 p.m., testimony regarding a prior dispute, and gunshot residue on his jacket. The opinion reaffirmed that circumstantial evidence can be as probative as direct evidence."
    },
    {
        title: "Rivers v. Apex Logistics",
        court: "U.S. District Court, Southern District of New York",
        date: "April 8, 2023",
        snippet: "Employment discrimination, remote work accommodation, and retaliation.",
        summary: "Judge Morales denied in part Apex's motion to dismiss ADA and retaliation claims. Rivers plausibly alleged that remote work was a reasonable accommodation given her autoimmune condition and that adverse actions followed shortly after her request. FMLA claims were dismissed without prejudice.",
        fullText: "Plaintiff Dana Rivers requested remote work on February 7, 2022 due to lupus. Apex Logistics denied the request and issued a performance improvement plan on March 1, 2022. The court found temporal proximity sufficient to support causation at the pleading stage. ADA and retaliation claims survived, while FMLA allegations lacked specificity."
    },
    {
        title: "Lopez v. Meridian Credit",
        court: "U.S. Court of Appeals, Seventh Circuit",
        date: "June 27, 2023",
        snippet: "Fair Credit Reporting Act inaccuracies and furnisher duties.",
        summary: "The Seventh Circuit reversed summary judgment for the furnisher, holding that Meridian failed to conduct a reasonable investigation after Lopez disputed a fraudulent account. The court stressed that automated form responses did not satisfy §1681s-2(b) obligations.",
        fullText: "Lopez notified Meridian Credit on May 5, 2020 that a tradeline opened in April 2019 was fraudulent. Meridian responded with a template verification letter and did not review underlying applications. Judge Barrett wrote that a reasonable investigation requires more than confirming internal databases. The case was remanded for trial."
    }
];

let filteredCases = [...caseData];
let currentCaseIndex = null;
let activeTab = 'summary';
let entitiesOn = false;
let notes = [];

const caseListEl = document.getElementById('caseList');
const resultCountEl = document.getElementById('resultCount');
const detailTitleEl = document.getElementById('detailTitle');
const detailMetaEl = document.getElementById('detailMeta');
const detailContentEl = document.getElementById('detailContent');
const searchInputEl = document.getElementById('searchInput');
const toggleHighlightBtn = document.getElementById('toggleHighlightBtn');
const noteInputEl = document.getElementById('noteInput');
const noteListEl = document.getElementById('noteList');
const saveSelectionBtn = document.getElementById('saveSelectionBtn');
const saveTypedBtn = document.getElementById('saveTypedBtn');
const clearNotesBtn = document.getElementById('clearNotesBtn');

function renderCases() {
    caseListEl.innerHTML = '';
    if (!filteredCases.length) {
        caseListEl.innerHTML = '<div class="empty-state">No cases match your query.</div>';
    }
    filteredCases.forEach((c, idx) => {
        const card = document.createElement('div');
        card.className = 'case-item';
        const globalIndex = caseData.indexOf(c);
        if (globalIndex === currentCaseIndex) card.classList.add('active');
        card.innerHTML = `
            <h4 class="case-title">${c.title}</h4>
            <div class="meta">
                <span>${c.court}</span>
                <span>•</span>
                <span>${c.date}</span>
            </div>
            <div class="snippet">${c.snippet}</div>
        `;
        card.addEventListener('click', () => openCase(globalIndex));
        caseListEl.appendChild(card);
    });
    resultCountEl.textContent = filteredCases.length;
}

function openCase(index) {
    currentCaseIndex = index;
    entitiesOn = false;
    toggleHighlightBtn.textContent = "Extract Entities";
    toggleHighlightBtn.disabled = false;
    const c = caseData[index];
    detailTitleEl.textContent = c.title;
    detailMetaEl.innerHTML = `
        <div class="chip">Court: ${c.court}</div>
        <div class="chip">Date: ${c.date}</div>
    `;
    renderTabs();
    renderContent();
    renderCases();
}

function renderTabs() {
    document.querySelectorAll('.tab').forEach(tab => {
        tab.classList.toggle('active', tab.dataset.tab === activeTab);
        tab.onclick = () => {
            activeTab = tab.dataset.tab;
            renderTabs();
            renderContent();
        };
    });
}

function escapeHTML(str) {
    return str.replace(/[&<>"']/g, s => ({
        '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'
    }[s]));
}

function highlightEntities(text) {
    const nameRegex = /\b([A-Z][a-z]+ [A-Z][a-z]+)\b/g;
    const dateRegex = /\b(?:January|February|March|April|May|June|July|August|September|October|November|December)\s\d{1,2},\s\d{4}\b/g;
    const yearRegex = /\b20\d{2}\b/g;
    const escaped = escapeHTML(text);
    return escaped
        .replace(nameRegex, '<span class="highlight">$1</span>')
        .replace(dateRegex, '<span class="highlight">$&</span>')
        .replace(yearRegex, '<span class="highlight">$&</span>');
}

function renderContent() {
    if (currentCaseIndex === null) {
        detailContentEl.innerHTML = '<div class="empty-state">Choose a case from the left to preview its summary or full opinion text.</div>';
        return;
    }
    const c = caseData[currentCaseIndex];
    const bodyText = activeTab === 'summary' ? c.summary : c.fullText;
    const rendered = entitiesOn ? highlightEntities(bodyText) : escapeHTML(bodyText);
    detailContentEl.innerHTML = `<p>${rendered.replace(/\n/g, '</p><p>')}</p>`;
}

searchInputEl.addEventListener('input', () => {
    const q = searchInputEl.value.trim().toLowerCase();
    filteredCases = caseData.filter(c => {
        return [c.title, c.court, c.snippet, c.summary, c.fullText].some(field =>
            field.toLowerCase().includes(q)
        );
    });
    renderCases();
});

toggleHighlightBtn.addEventListener('click', () => {
    if (currentCaseIndex === null) return;
    entitiesOn = !entitiesOn;
    toggleHighlightBtn.textContent = entitiesOn ? "Entities Highlighted" : "Extract Entities";
    renderContent();
});

function loadNotes() {
    try {
        const raw = localStorage.getItem('vibelaw_notes');
        notes = raw ? JSON.parse(raw) : [];
    } catch {
        notes = [];
    }
}

function saveNotes() {
    localStorage.setItem('vibelaw_notes', JSON.stringify(notes));
}

function renderNotes() {
    noteListEl.innerHTML = '';
    if (!notes.length) {
        noteListEl.innerHTML = '<div class="empty-state">No notes yet. Highlight text in the opinion or type a note.</div>';
        return;
    }
    notes.slice().sort((a,b)=>b.id-a.id).forEach(n => {
        const item = document.createElement('div');
        item.className = 'note-item';
        const dateStr = new Date(n.ts || n.id).toLocaleString();
        item.innerHTML = `
            <div class="note-meta">
                <span class="pill">${n.caseTitle || 'Untitled'}</span>
                <span>${dateStr}</span>
            </div>
            <div class="note-text">${escapeHTML(n.text)}</div>
            <div style="margin-top:8px; display:flex; justify-content:flex-end;">
                <button class="ghost" style="padding:6px 10px;" data-id="${n.id}">Delete</button>
            </div>
        `;
        item.querySelector('button').onclick = () => {
            notes = notes.filter(x => x.id !== n.id);
            saveNotes();
            renderNotes();
        };
        noteListEl.appendChild(item);
    });
}

function addNote(text) {
    const trimmed = text.trim();
    if (!trimmed) return;
    const caseTitle = currentCaseIndex !== null ? caseData[currentCaseIndex].title : 'General';
    notes.push({ id: Date.now(), caseTitle, text: trimmed, ts: new Date().toISOString() });
    saveNotes();
    renderNotes();
    noteInputEl.value = '';
}

saveTypedBtn.addEventListener('click', () => {
    addNote(noteInputEl.value || '');
});

saveSelectionBtn.addEventListener('click', () => {
    const sel = window.getSelection();
    if (sel && sel.toString().trim()) {
        addNote(sel.toString());
    } else {
        alert('Select text in the opinion area to save it as a snippet.');
    }
});

clearNotesBtn.addEventListener('click', () => {
    if (confirm('Clear all saved notes?')) {
        notes = [];
        saveNotes();
        renderNotes();
    }
});

document.addEventListener('keydown', (e) => {
    if (e.key === '/' && document.activeElement !== searchInputEl) {
        e.preventDefault();
        searchInputEl.focus();
    }
});

loadNotes();
renderCases();
renderNotes();
renderTabs();
</script>
</body>
</html>