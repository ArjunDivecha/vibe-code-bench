<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Markdown Editor</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            height: 100vh;
            overflow: hidden;
            transition: background-color 0.3s, color 0.3s;
        }

        body.light {
            background-color: #f5f5f5;
            color: #333;
        }

        body.dark {
            background-color: #1e1e1e;
            color: #f5f5f5;
        }

        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 20px;
            border-bottom: 1px solid #ddd;
            background-color: inherit;
        }

        body.dark .navbar {
            border-bottom: 1px solid #444;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: bold;
        }

        .controls {
            display: flex;
            gap: 10px;
        }

        button {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            transition: background-color 0.2s;
        }

        body.light button {
            background-color: #e0e0e0;
            color: #333;
        }

        body.light button:hover {
            background-color: #d0d0d0;
        }

        body.dark button {
            background-color: #333;
            color: #f5f5f5;
        }

        body.dark button:hover {
            background-color: #444;
        }

        .container {
            display: flex;
            height: calc(100vh - 60px);
        }

        .editor-pane, .preview-pane {
            flex: 1;
            padding: 20px;
            overflow: auto;
            height: 100%;
        }

        .editor-pane {
            border-right: 1px solid #ddd;
        }

        body.dark .editor-pane {
            border-right: 1px solid #444;
        }

        #markdown-input {
            width: 100%;
            height: 100%;
            resize: none;
            border: none;
            outline: none;
            font-family: 'Courier New', Courier, monospace;
            font-size: 16px;
            line-height: 1.5;
            background: transparent;
        }

        body.light #markdown-input {
            color: #333;
        }

        body.dark #markdown-input {
            color: #f5f5f5;
        }

        #preview {
            height: 100%;
            overflow: auto;
        }

        /* Preview styling */
        #preview h1, #preview h2, #preview h3 {
            margin: 20px 0 10px 0;
        }

        #preview p {
            margin: 10px 0;
            line-height: 1.6;
        }

        #preview strong {
            font-weight: bold;
        }

        #preview em {
            font-style: italic;
        }

        #preview ul, #preview ol {
            margin: 10px 0;
            padding-left: 20px;
        }

        #preview li {
            margin: 5px 0;
        }

        #preview a {
            color: #4285f4;
            text-decoration: none;
        }

        body.dark #preview a {
            color: #64b5f6;
        }

        #preview a:hover {
            text-decoration: underline;
        }

        #preview pre {
            background-color: #f0f0f0;
            padding: 15px;
            border-radius: 5px;
            overflow: auto;
            margin: 15px 0;
        }

        body.dark #preview pre {
            background-color: #333;
        }

        #preview code {
            font-family: 'Courier New', Courier, monospace;
            font-size: 14px;
        }

        #preview blockquote {
            border-left: 4px solid #ddd;
            padding-left: 15px;
            margin: 15px 0;
            color: #666;
        }

        body.dark #preview blockquote {
            border-left: 4px solid #444;
            color: #aaa;
        }

        body.dark #preview {
            background-color: #1e1e1e;
        }

        @media (max-width: 768px) {
            .container {
                flex-direction: column;
            }
            
            .editor-pane {
                border-right: none;
                border-bottom: 1px solid #ddd;
            }
            
            body.dark .editor-pane {
                border-bottom: 1px solid #444;
            }
        }
    </style>
</head>
<body class="light">
    <div class="navbar">
        <div class="logo">Markdown Editor</div>
        <div class="controls">
            <button id="toggle-dark-mode">Dark Mode</button>
            <button id="export-html">Export HTML</button>
        </div>
    </div>
    <div class="container">
        <div class="editor-pane">
            <textarea id="markdown-input" placeholder="Enter your markdown here..."></textarea>
        </div>
        <div class="preview-pane">
            <div id="preview"></div>
        </div>
    </div>

    <script>
        class MarkdownEditor {
            constructor() {
                this.markdownInput = document.getElementById('markdown-input');
                this.preview = document.getElementById('preview');
                this.toggleDarkModeBtn = document.getElementById('toggle-dark-mode');
                this.exportHtmlBtn = document.getElementById('export-html');
                
                this.loadFromLocalStorage();
                this.setupEventListeners();
                this.renderPreview();
            }
            
            setupEventListeners() {
                this.markdownInput.addEventListener('input', () => {
                    this.renderPreview();
                    this.saveToLocalStorage();
                });
                
                this.toggleDarkModeBtn.addEventListener('click', () => {
                    this.toggleDarkMode();
                });
                
                this.exportHtmlBtn.addEventListener('click', () => {
                    this.exportAsHtml();
                });
            }
            
            renderPreview() {
                const markdown = this.markdownInput.value;
                this.preview.innerHTML = this.markdownToHtml(markdown);
            }
            
            markdownToHtml(markdown) {
                // Escape HTML
                let html = markdown
                    .replace(/&/g, '&amp;')
                    .replace(/</g, '&lt;')
                    .replace(/>/g, '&gt;');
                
                // Code blocks (```code```)
                html = html.replace(/```([\s\S]*?)```/g, '<pre><code>$1</code></pre>');
                
                // Blockquotes (>)
                html = html.replace(/^> (.*)$/gm, '<blockquote>$1</blockquote>');
                
                // Headers (# ## ###)
                html = html.replace(/^### (.*$)/gm, '<h3>$1</h3>');
                html = html.replace(/^## (.*$)/gm, '<h2>$1</h2>');
                html = html.replace(/^# (.*$)/gm, '<h1>$1</h1>');
                
                // Links [text](url)
                html = html.replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2">$1</a>');
                
                // Bold (**text**)
                html = html.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
                
                // Italic (*text*)
                html = html.replace(/(?<!\*)\*([^\*]+?)\*(?!\*)/g, '<em>$1</em>');
                
                // Ordered lists (1. 2. 3.)
                html = html.replace(/^(\d+)\. (.*)$/gm, '<li data-line="$1">$2</li>');
                let olHtml = '';
                let inOrderedList = false;
                const lines = html.split('\n');
                html = '';
                
                for (let i = 0; i < lines.length; i++) {
                    const line = lines[i];
                    const match = line.match(/^<li data-line="(\d+)">(.*)<\/li>$/);
                    
                    if (match) {
                        if (!inOrderedList) {
                            html += '<ol>';
                            inOrderedList = true;
                        }
                        html += `<li>${match[2]}</li>`;
                    } else {
                        if (inOrderedList) {
                            html += '</ol>';
                            inOrderedList = false;
                        }
                        html += line;
                    }
                }
                
                if (inOrderedList) {
                    html += '</ol>';
                }
                
                // Unordered lists (-)
                html = html.replace(/<li data-line="\d+">/g, '<li>');
                html = html.replace(/^- (.*)$/gm, '<li>$1</li>');
                let ulHtml = '';
                let inUnorderedList = false;
                const ulLines = html.split('\n');
                html = '';
                
                for (let i = 0; i < ulLines.length; i++) {
                    const line = ulLines[i];
                    
                    if (line.match(/^<li>.*<\/li>$/) && !line.includes('<li data-line="')) {
                        if (!inUnorderedList) {
                            html += '<ul>';
                            inUnorderedList = true;
                        }
                        html += line;
                    } else {
                        if (inUnorderedList) {
                            html += '</ul>';
                            inUnorderedList = false;
                        }
                        html += line;
                    }
                }
                
                if (inUnorderedList) {
                    html += '</ul>';
                }
                
                // Paragraphs
                html = html.replace(/^\s*$(?:\n)/gm, '</p><p>');
                html = '<p>' + html + '</p>';
                html = html.replace(/<p><\/p>/g, '');
                html = html.replace(/<p><(ul|ol|blockquote|h1|h2|h3|pre)/g, '<$1');
                html = html.replace(/<\/(ul|ol|blockquote|h1|h2|h3|pre)><\/p>/g, '</$1>');
                
                return html;
            }
            
            toggleDarkMode() {
                const body = document.body;
                if (body.classList.contains('light')) {
                    body.classList.remove('light');
                    body.classList.add('dark');
                    this.toggleDarkModeBtn.textContent = 'Light Mode';
                } else {
                    body.classList.remove('dark');
                    body.classList.add('light');
                    this.toggleDarkModeBtn.textContent = 'Dark Mode';
                }
                localStorage.setItem('darkMode', body.classList.contains('dark') ? 'dark' : 'light');
            }
            
            exportAsHtml() {
                const htmlContent = `
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Exported Markdown</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        h1, h2, h3 {
            margin: 20px 0 10px 0;
        }
        p {
            margin: 10px 0;
        }
        strong {
            font-weight: bold;
        }
        em {
            font-style: italic;
        }
        ul, ol {
            margin: 10px 0;
            padding-left: 20px;
        }
        li {
            margin: 5px 0;
        }
        a {
            color: #4285f4;
            text-decoration: none;
        }
        a:hover {
            text-decoration: underline;
        }
        pre {
            background-color: #f0f0f0;
            padding: 15px;
            border-radius: 5px;
            overflow: auto;
            margin: 15px 0;
        }
        code {
            font-family: 'Courier New', Courier, monospace;
            font-size: 14px;
        }
        blockquote {
            border-left: 4px solid #ddd;
            padding-left: 15px;
            margin: 15px 0;
            color: #666;
        }
    </style>
</head>
<body>
    ${this.preview.innerHTML}
</body>
</html>
                `.trim();
                
                const blob = new Blob([htmlContent], { type: 'text/html' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'markdown-export.html';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }
            
            saveToLocalStorage() {
                localStorage.setItem('markdownContent', this.markdownInput.value);
            }
            
            loadFromLocalStorage() {
                const savedContent = localStorage.getItem('markdownContent');
                if (savedContent) {
                    this.markdownInput.value = savedContent;
                }
                
                const darkMode = localStorage.getItem('darkMode');
                if (darkMode === 'dark') {
                    document.body.classList.remove('light');
                    document.body.classList.add('dark');
                    this.toggleDarkModeBtn.textContent = 'Light Mode';
                }
            }
        }
        
        // Initialize the editor when the page loads
        document.addEventListener('DOMContentLoaded', () => {
            new MarkdownEditor();
        });
    </script>
</body>
</html>