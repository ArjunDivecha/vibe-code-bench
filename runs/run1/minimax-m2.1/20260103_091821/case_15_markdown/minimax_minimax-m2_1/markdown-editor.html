<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Markdown Editor</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #ffffff;
            --bg-secondary: #f5f5f5;
            --bg-editor: #fafafa;
            --text-primary: #333333;
            --text-secondary: #666666;
            --border-color: #e0e0e0;
            --accent-color: #4a90d9;
            --code-bg: #f0f0f0;
            --blockquote-border: #4a90d9;
            --preview-bg: #ffffff;
        }

        [data-theme="dark"] {
            --bg-primary: #1a1a2e;
            --bg-secondary: #16213e;
            --bg-editor: #0f0f23;
            --text-primary: #e0e0e0;
            --text-secondary: #a0a0a0;
            --border-color: #333333;
            --accent-color: #6c9bff;
            --code-bg: #252542;
            --blockquote-border: #6c9bff;
            --preview-bg: #1a1a2e;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .toolbar {
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
            padding: 12px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }

        .toolbar h1 {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .toolbar-actions {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 500;
            transition: all 0.2s ease;
            background: var(--accent-color);
            color: white;
        }

        .btn:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: transparent;
            border: 1px solid var(--border-color);
            color: var(--text-primary);
        }

        .btn-secondary:hover {
            background: var(--bg-secondary);
        }

        .editor-container {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        .pane {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .pane-header {
            background: var(--bg-secondary);
            padding: 10px 20px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--text-secondary);
            border-bottom: 1px solid var(--border-color);
        }

        .editor-pane {
            border-right: 1px solid var(--border-color);
        }

        #markdown-input {
            flex: 1;
            padding: 20px;
            border: none;
            outline: none;
            resize: none;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 0.9rem;
            line-height: 1.6;
            background: var(--bg-editor);
            color: var(--text-primary);
        }

        #preview {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background: var(--preview-bg);
            line-height: 1.6;
        }

        /* Markdown Styles */
        #preview h1 {
            font-size: 2rem;
            margin: 0.67em 0;
            padding-bottom: 0.3em;
            border-bottom: 1px solid var(--border-color);
        }

        #preview h2 {
            font-size: 1.5rem;
            margin: 0.83em 0;
            padding-bottom: 0.3em;
            border-bottom: 1px solid var(--border-color);
        }

        #preview h3 {
            font-size: 1.25rem;
            margin: 1em 0;
        }

        #preview h4 {
            font-size: 1rem;
            margin: 1.33em 0;
        }

        #preview h5 {
            font-size: 0.875rem;
            margin: 1.67em 0;
        }

        #preview h6 {
            font-size: 0.75rem;
            margin: 2.33em 0;
            color: var(--text-secondary);
        }

        #preview p {
            margin: 1em 0;
        }

        #preview strong {
            font-weight: 600;
        }

        #preview em {
            font-style: italic;
        }

        #preview ul, #preview ol {
            margin: 1em 0;
            padding-left: 2em;
        }

        #preview li {
            margin: 0.5em 0;
        }

        #preview blockquote {
            margin: 1em 0;
            padding: 0.5em 1em;
            border-left: 4px solid var(--blockquote-border);
            background: var(--bg-secondary);
            color: var(--text-secondary);
        }

        #preview code {
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 0.875em;
            background: var(--code-bg);
            padding: 0.2em 0.4em;
            border-radius: 3px;
        }

        #preview pre {
            margin: 1em 0;
            padding: 1em;
            background: var(--code-bg);
            border-radius: 6px;
            overflow-x: auto;
        }

        #preview pre code {
            background: none;
            padding: 0;
        }

        #preview a {
            color: var(--accent-color);
            text-decoration: none;
        }

        #preview a:hover {
            text-decoration: underline;
        }

        #preview hr {
            margin: 2em 0;
            border: none;
            border-top: 1px solid var(--border-color);
        }

        .status-bar {
            background: var(--bg-secondary);
            border-top: 1px solid var(--border-color);
            padding: 6px 20px;
            font-size: 0.75rem;
            color: var(--text-secondary);
            display: flex;
            justify-content: space-between;
        }

        @media (max-width: 768px) {
            .editor-container {
                flex-direction: column;
            }
            
            .editor-pane {
                border-right: none;
                border-bottom: 1px solid var(--border-color);
            }
            
            .pane {
                min-height: 40vh;
            }
        }
    </style>
</head>
<body>
    <header class="toolbar">
        <h1>üìù Markdown Editor</h1>
        <div class="toolbar-actions">
            <button class="btn btn-secondary" id="theme-toggle">üåô Dark Mode</button>
            <button class="btn btn-secondary" id="load-btn">üìÇ Load</button>
            <button class="btn" id="save-btn">üíæ Save</button>
            <button class="btn btn-secondary" id="export-btn">üì§ Export HTML</button>
        </div>
    </header>

    <main class="editor-container">
        <section class="pane editor-pane">
            <header class="pane-header">Markdown</header>
            <textarea id="markdown-input" placeholder="Enter your markdown here...

# Welcome to Markdown Editor!

Try typing some markdown:
- **Bold text**
- *Italic text*
- `Code`

## Features
- Live preview
- Save/Load
- Dark mode
- Export HTML"></textarea>
        </section>

        <section class="pane preview-pane">
            <header class="pane-header">Preview</header>
            <div id="preview"></div>
        </section>
    </main>

    <footer class="status-bar">
        <span id="status">Ready</span>
        <span id="char-count">0 characters</span>
    </footer>

    <script>
        // DOM Elements
        const markdownInput = document.getElementById('markdown-input');
        const preview = document.getElementById('preview');
        const themeToggle = document.getElementById('theme-toggle');
        const saveBtn = document.getElementById('save-btn');
        const loadBtn = document.getElementById('load-btn');
        const exportBtn = document.getElementById('export-btn');
        const status = document.getElementById('status');
        const charCount = document.getElementById('char-count');

        // Storage key
        const STORAGE_KEY = 'markdown-editor-content';
        const THEME_KEY = 'markdown-editor-theme';

        // Simple Markdown Parser
        class MarkdownParser {
            constructor() {
                this.text = '';
            }

            parse(text) {
                this.text = text;
                let html = this.escapeHtml(text);
                
                // Code blocks (must be before inline code)
                html = html.replace(/```(\w*)\n([\s\S]*?)```/g, (match, lang, code) => {
                    return `<pre><code>${this.escapeHtml(code.trim())}</code></pre>`;
                });

                // Headers
                html = html.replace(/^### (.+)$/gm, '<h3>$1</h3>');
                html = html.replace(/^## (.+)$/gm, '<h2>$1</h2>');
                html = html.replace(/^# (.+)$/gm, '<h1>$1</h1>');
                html = html.replace(/^#### (.+)$/gm, '<h4>$1</h4>');
                html = html.replace(/^##### (.+)$/gm, '<h5>$1</h5>');
                html = html.replace(/^###### (.+)$/gm, '<h6>$1</h6>');

                // Horizontal rule
                html = html.replace(/^---$/gm, '<hr>');

                // Blockquotes
                html = html.replace(/^&gt; (.+)$/gm, '<blockquote>$1</blockquote>');

                // Bold and italic (order matters - bold first)
                html = html.replace(/\*\*\*(.+?)\*\*\*/g, '<strong><em>$1</em></strong>');
                html = html.replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>');
                html = html.replace(/\*(.+?)\*/g, '<em>$1</em>');
                html = html.replace(/___(.+?)___/g, '<strong><em>$1</em></strong>');
                html = html.replace(/__(.+?)__/g, '<strong>$1</strong>');
                html = html.replace(/_(.+?)_/g, '<em>$1</em>');

                // Inline code
                html = html.replace(/`(.+?)`/g, '<code>$1</code>');

                // Links
                html = html.replace(/\[(.+?)\]\((.+?)\)/g, '<a href="$2" target="_blank">$1</a>');

                // Ordered lists
                html = html.replace(/^\d+\. (.+)$/gm, '<li>$1</li>');
                
                // Unordered lists
                html = html.replace(/^- (.+)$/gm, '<li>$1</li>');

                // Convert list items to proper list structure
                html = this.wrapLists(html);

                // Line breaks
                html = html.replace(/\n\n/g, '</p><p>');
                html = html.replace(/\n/g, '<br>');

                // Wrap in paragraph if needed
                if (html && !html.startsWith('<')) {
                    html = '<p>' + html + '</p>';
                }

                // Clean up empty paragraphs
                html = html.replace(/<p>\s*<\/p>/g, '');
                html = html.replace(/<p>(<[hulo])/g, '$1');
                html = html.replace(/(<\/[hulo]>)<\/p>/g, '$1');
                html = html.replace(/<blockquote>/g, '</p><blockquote>');
                html = html.replace(/<\/blockquote>/g, '</blockquote><p>');

                return html;
            }

            wrapLists(html) {
                // Wrap consecutive list items in ul/ol tags
                const lines = html.split('\n');
                let result = '';
                let inList = false;
                let listType = '';
                
                for (let i = 0; i < lines.length; i++) {
                    const line = lines[i];
                    
                    if (line.startsWith('<li>')) {
                        const isOrdered = /^\d+\./.test(line);
                        const currentType = isOrdered ? 'ol' : 'ul';
                        
                        if (!inList) {
                            if (result && !result.endsWith('</p>')) {
                                result += '</p>';
                            }
                            result += '<' + currentType + '>';
                            inList = true;
                            listType = currentType;
                        } else if (listType !== currentType) {
                            result += '</' + listType + '>';
                            result += '<' + currentType + '>';
                            listType = currentType;
                        }
                        
                        result += line;
                    } else {
                        if (inList) {
                            result += '</' + listType + '>';
                            inList = false;
                            listType = '';
                            if (line && !line.startsWith('<')) {
                                result += '<p>' + line;
                            } else {
                                result += line;
                            }
                        } else {
                            result += line;
                        }
                    }
                }
                
                if (inList) {
                    result += '</' + listType + '>';
                }
                
                return result;
            }

            escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }
        }

        const parser = new MarkdownParser();

        // Update preview
        function updatePreview() {
            const text = markdownInput.value;
            preview.innerHTML = parser.parse(text);
            charCount.textContent = `${text.length} characters`;
        }

        // Save to localStorage
        function saveContent() {
            localStorage.setItem(STORAGE_KEY, markdownInput.value);
            showStatus('Saved to localStorage!');
        }

        // Load from localStorage
        function loadContent() {
            const saved = localStorage.getItem(STORAGE_KEY);
            if (saved !== null) {
                markdownInput.value = saved;
                updatePreview();
                showStatus('Loaded from localStorage!');
            } else {
                showStatus('No saved content found');
            }
        }

        // Export as HTML
        function exportHtml() {
            const fullHtml = `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Markdown Export</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 40px 20px;
            line-height: 1.6;
            color: #333;
        }
        h1, h2, h3, h4, h5, h6 {
            margin-top: 1.5em;
            margin-bottom: 0.5em;
        }
        h1 { font-size: 2em; border-bottom: 1px solid #eee; padding-bottom: 0.3em; }
        h2 { font-size: 1.5em; border-bottom: 1px solid #eee; padding-bottom: 0.3em; }
        h3 { font-size: 1.25em; }
        code { background: #f0f0f0; padding: 0.2em 0.4em; border-radius: 3px; font-size: 0.9em; }
        pre { background: #f0f0f0; padding: 1em; border-radius: 6px; overflow-x: auto; }
        pre code { background: none; padding: 0; }
        blockquote { border-left: 4px solid #4a90d9; margin: 1em 0; padding: 0.5em 1em; background: #f5f5f5; color: #666; }
        a { color: #4a90d9; }
        ul, ol { padding-left: 2em; }
        li { margin: 0.5em 0; }
    </style>
</head>
<body>
${preview.innerHTML}
</body>
</html>`;

            const blob = new Blob([fullHtml], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'markdown-export.html';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            showStatus('HTML exported!');
        }

        // Theme toggle
        function toggleTheme() {
            const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
            document.documentElement.setAttribute('data-theme', isDark ? 'light' : 'dark');
            themeToggle.textContent = isDark ? 'üåô Dark Mode' : '‚òÄÔ∏è Light Mode';
            localStorage.setItem(THEME_KEY, isDark ? 'light' : 'dark');
        }

        // Show status message
        function showStatus(message) {
            status.textContent = message;
            setTimeout(() => {
                status.textContent = 'Ready';
            }, 2000);
        }

        // Initialize theme
        function initTheme() {
            const savedTheme = localStorage.getItem(THEME_KEY) || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
            themeToggle.textContent = savedTheme === 'dark' ? '‚òÄÔ∏è Light Mode' : 'üåô Dark Mode';
        }

        // Event listeners
        markdownInput.addEventListener('input', updatePreview);
        saveBtn.addEventListener('click', saveContent);
        loadBtn.addEventListener('click', loadContent);
        exportBtn.addEventListener('click', exportHtml);
        themeToggle.addEventListener('click', toggleTheme);

        // Auto-save every 30 seconds
        setInterval(() => {
            if (markdownInput.value.trim()) {
                localStorage.setItem(STORAGE_KEY, markdownInput.value);
            }
        }, 30000);

        // Initialize
        initTheme();
        loadContent();
        updatePreview();
    </script>
</body>
</html>