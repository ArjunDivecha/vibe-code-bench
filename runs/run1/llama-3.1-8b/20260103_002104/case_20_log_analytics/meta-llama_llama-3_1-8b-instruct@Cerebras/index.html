<!DOCTYPE html>
<html>
<head>
    <title>Log Analytics Dashboard</title>
    <style>
        table {
            border-collapse: collapse;
            width: 100%;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: left;
        }
        th {
            background-color: #f0f0f0;
        }
    </style>
</head>
<body>
    <h1>Log Analytics Dashboard</h1>
    <button id="filter-button">Filter by Level</button>
    <table id="log-table">
        <thead>
            <tr>
                <th>Timestamp</th>
                <th>Level</th>
                <th>Message</th>
            </tr>
        </thead>
        <tbody id="log-body">
        </tbody>
    </table>

    <script>
        const levels = ['INFO', 'WARN', 'ERROR', 'CRITICAL'];
        const filterButton = document.getElementById('filter-button');
        const logTable = document.getElementById('log-table');
        const logBody = document.getElementById('log-body');

        let filteredLevel = 'All';

        filterButton.addEventListener('click', () => {
            filteredLevel = prompt('Enter level to filter (INFO, WARN, ERROR, CRITICAL)');
        });

        function drawLog(level) {
            logBody.innerHTML = '';
            fetch('/log?level=' + level)
                .then(response => response.json())
                .then(data => {
                    data.forEach(log => {
                        const row = document.createElement('tr');
                        const timestampCell = document.createElement('td');
                        timestampCell.textContent = log.timestamp;
                        const levelCell = document.createElement('td');
                        levelCell.textContent = log.level;
                        const messageCell = document.createElement('td');
                        messageCell.textContent = log.message;
                        row.appendChild(timestampCell);
                        row.appendChild(levelCell);
                        row.appendChild(messageCell);
                        logBody.appendChild(row);
                    });
                });
        }

        drawLog(filteredLevel);

        fetch('/levels')
            .then(response => response.json())
            .then(levels => {
                const levelChart = document.getElementById('level-chart');
                levelChart.innerHTML = '';
                levels.forEach((level, i) => {
                    const rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                    rect.setAttributeNS(null, 'x', i * 100);
                    rect.setAttributeNS(null, 'y', 200 - level * 100);
                    rect.setAttributeNS(null, 'width', 100);
                    rect.setAttributeNS(null, 'height', level * 100);
                    levelChart.appendChild(rect);
                });
            });

        fetch('/errors')
            .then(response => response.json())
            .then(errors => {
                const errorChart = document.getElementById('error-chart');
                errorChart.innerHTML = '';
                const maxHour = Math.max(...Object.keys(errors));
                const maxCount = Math.max(...Object.values(errors));
                Object.keys(errors).forEach(hour => {
                    const rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                    rect.setAttributeNS(null, 'x', parseInt(hour) * 50);
                    rect.setAttributeNS(null, 'y', 200 - errors[hour] * 100 / maxCount);
                    rect.setAttributeNS(null, 'width', 50);
                    rect.setAttributeNS(null, 'height', errors[hour] * 100 / maxCount);
                    errorChart.appendChild(rect);
                });
            });

        fetch('/criticals')
            .then(response => response.json())
            .then(criticals => {
                const criticalList = document.getElementById('critical-list');
                criticalList.innerHTML = '';
                criticals.forEach(message => {
                    const listElement = document.createElement('li');
                    listElement.textContent = message;
                    criticalList.appendChild(listElement);
                });
            });
    </script>
    <svg id="level-chart" width="100%" height="200"></svg>
    <svg id="error-chart" width="100%" height="200"></svg>
    <ul id="critical-list"></ul>

    <script>
        function drawBarChart(chart, data, x, y) {
            chart.innerHTML = '';
            data.forEach((value, i) => {
                const rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                rect.setAttributeNS(null, 'x', i * x);
                rect.setAttributeNS(null, 'y', 200 - value * y);
                rect.setAttributeNS(null, 'width', x);
                rect.setAttributeNS(null, 'height', value * y);
                chart.appendChild(rect);
            });
        }

        fetch('/levels')
            .then(response => response.json())
            .then(levels => {
                drawBarChart(document.getElementById('level-chart'), Object.values(levels), 100, 100);
            })
            .then(() => {
                fetch('/errors')
                    .then(response => response.json())
                    .then(errors => {
                        drawBarChart(document.getElementById('error-chart'), Object.values(errors), 50, 100);
                    });
            });
    </script>
</body>
</html>