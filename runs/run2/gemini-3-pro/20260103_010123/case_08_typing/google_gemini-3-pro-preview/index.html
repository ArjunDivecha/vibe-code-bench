<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Typing Speed Test</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;500;700&family=Poppins:wght@400;600&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }

        body {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background: #eef2f3;
            color: #333;
        }

        .container {
            width: 800px;
            background: #fff;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            position: relative;
        }

        h2 {
            text-align: center;
            margin-bottom: 20px;
            font-size: 24px;
            color: #2c3e50;
        }

        .stats-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #f8f9fa;
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 25px;
            border: 1px solid #e9ecef;
        }

        .stat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .stat-label {
            font-size: 12px;
            color: #7f8c8d;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .stat-value {
            font-size: 20px;
            font-weight: 600;
            color: #2c3e50;
        }

        #timer {
            color: #e74c3c;
        }

        .text-display {
            font-family: 'Roboto Mono', monospace;
            font-size: 20px;
            line-height: 1.6;
            margin-bottom: 25px;
            color: #95a5a6;
            user-select: none;
            max-height: 250px;
            overflow-y: auto;
            padding: 15px;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            background: #fafafa;
        }

        .text-display span {
            position: relative;
        }

        .text-display span.correct {
            color: #2ecc71;
        }

        .text-display span.incorrect {
            color: #e74c3c;
            background: rgba(231, 76, 60, 0.1);
            border-radius: 2px;
        }

        .text-display span.active {
            color: #3498db;
        }

        .text-display span.active::before {
            content: "";
            position: absolute;
            left: 0;
            bottom: 0;
            width: 100%;
            height: 2px;
            background: #3498db;
            animation: blink 1s infinite;
        }

        @keyframes blink {
            50% { opacity: 0; }
        }

        .input-area {
            position: relative;
        }

        .input-field {
            width: 100%;
            padding: 15px;
            border-radius: 8px;
            border: 2px solid #ddd;
            font-family: 'Roboto Mono', monospace;
            font-size: 18px;
            outline: none;
            transition: border-color 0.3s;
            resize: none;
            height: 80px;
        }

        .input-field:focus {
            border-color: #3498db;
        }

        .btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
            font-family: 'Poppins', sans-serif;
        }

        .btn:hover {
            background: #2980b9;
        }

        .refresh-btn {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        /* Modal Overlay */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }

        .modal-overlay.show {
            opacity: 1;
            pointer-events: auto;
        }

        .modal-content {
            background: white;
            padding: 40px;
            border-radius: 12px;
            text-align: center;
            width: 400px;
            box-shadow: 0 15px 30px rgba(0,0,0,0.2);
            transform: translateY(20px);
            transition: transform 0.3s;
        }

        .modal-overlay.show .modal-content {
            transform: translateY(0);
        }

        .modal-title {
            font-size: 24px;
            margin-bottom: 20px;
            color: #2c3e50;
        }

        .result-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .result-item h4 {
            font-size: 14px;
            color: #7f8c8d;
            margin-bottom: 5px;
        }

        .result-item p {
            font-size: 28px;
            font-weight: 700;
            color: #2c3e50;
        }

    </style>
</head>
<body>

<div class="container">
    <h2>Typing Speed Test</h2>
    
    <div class="stats-bar">
        <div class="stat-item">
            <span class="stat-label">Time Left</span>
            <span class="stat-value"><span id="timer">30</span>s</span>
        </div>
        <div class="stat-item">
            <span class="stat-label">WPM</span>
            <span class="stat-value" id="wpm">0</span>
        </div>
        <div class="stat-item">
            <span class="stat-label">Accuracy</span>
            <span class="stat-value"><span id="accuracy">100</span>%</span>
        </div>
        <button class="btn refresh-btn" onclick="resetGame()">Try Again</button>
    </div>

    <div class="text-display" id="text-display">
        <!-- Text will be injected here -->
    </div>

    <div class="input-area">
        <textarea id="input-field" class="input-field" placeholder="Start typing here..."></textarea>
    </div>
</div>

<!-- Result Modal -->
<div class="modal-overlay" id="result-modal">
    <div class="modal-content">
        <h3 class="modal-title">Time's Up!</h3>
        <div class="result-grid">
            <div class="result-item">
                <h4>WPM</h4>
                <p id="final-wpm">0</p>
            </div>
            <div class="result-item">
                <h4>Accuracy</h4>
                <p id="final-accuracy">0%</p>
            </div>
            <div class="result-item">
                <h4>CPM</h4>
                <p id="final-cpm">0</p>
            </div>
            <div class="result-item">
                <h4>Errors</h4>
                <p id="final-errors">0</p>
            </div>
        </div>
        <button class="btn" onclick="closeModal()">Try Again</button>
    </div>
</div>

<script>
    const paragraphs = [
        "The quick brown fox jumps over the lazy dog. This is a classic sentence that contains every letter of the alphabet, making it a perfect pangram for testing typewriters and keyboards.",
        "Technology is best when it brings people together. It allows us to connect with friends and family across the globe, share ideas instantly, and collaborate on projects that were once impossible.",
        "Success is not final, failure is not fatal: it is the courage to continue that counts. Many of life's failures are people who did not realize how close they were to success when they gave up.",
        "In the middle of difficulty lies opportunity. The best way to predict the future is to create it. Do not wait for the perfect moment, take the moment and make it perfect.",
        "To be or not to be, that is the question. Whether 'tis nobler in the mind to suffer the slings and arrows of outrageous fortune, or to take arms against a sea of troubles and by opposing end them.",
        "A journey of a thousand miles begins with a single step. You must be the change you wish to see in the world. Happiness is not something ready made. It comes from your own actions.",
        "Artificial intelligence is transforming the way we live and work. From self-driving cars to intelligent virtual assistants, AI is reshaping industries and creating new possibilities for the future.",
        "The only way to do great work is to love what you do. If you haven't found it yet, keep looking. Don't settle. As with all matters of the heart, you'll know when you find it.",
        "Nature does not hurry, yet everything is accomplished. Look deep into nature, and then you will understand everything better. The earth has music for those who listen.",
        "Coding is the language of the future. It empowers us to build software, websites, and applications that solve real-world problems. Learning to code opens up a world of creativity and logic."
    ];

    const textDisplay = document.getElementById("text-display");
    const inputField = document.getElementById("input-field");
    const timerTag = document.getElementById("timer");
    const wpmTag = document.getElementById("wpm");
    const accuracyTag = document.getElementById("accuracy");
    const modal = document.getElementById("result-modal");
    const finalWpm = document.getElementById("final-wpm");
    const finalAccuracy = document.getElementById("final-accuracy");
    const finalCpm = document.getElementById("final-cpm");
    const finalErrors = document.getElementById("final-errors");

    let timer;
    let maxTime = 30;
    let timeLeft = maxTime;
    let charIndex = 0;
    let mistakes = 0;
    let isTyping = false;

    function loadParagraph() {
        const randIndex = Math.floor(Math.random() * paragraphs.length);
        textDisplay.innerHTML = "";
        paragraphs[randIndex].split("").forEach(char => {
            let span = `<span>${char}</span>`;
            textDisplay.innerHTML += span;
        });
        textDisplay.querySelectorAll("span")[0].classList.add("active");
        
        // Focus input on load
        inputField.focus();
        
        // Ensure text display scrolls to top
        textDisplay.scrollTop = 0;
    }

    function initTyping() {
        const characters = textDisplay.querySelectorAll("span");
        let typedChar = inputField.value.split("")[charIndex];

        if(charIndex < characters.length && timeLeft > 0) {
            if(!isTyping) {
                timer = setInterval(initTimer, 1000);
                isTyping = true;
            }

            // Handle backspace
            if(inputField.value.length < charIndex) {
                 charIndex--; // Move back
                 if(characters[charIndex].classList.contains("incorrect")) {
                     mistakes--;
                 }
                 characters[charIndex].classList.remove("correct", "incorrect");
            } 
            // Handle typing
            else {
                if(characters[charIndex].innerText === typedChar) {
                    characters[charIndex].classList.add("correct");
                } else {
                    mistakes++;
                    characters[charIndex].classList.add("incorrect");
                }
                charIndex++;
            }

            // Update active character class
            characters.forEach(span => span.classList.remove("active"));
            if(charIndex < characters.length) {
                characters[charIndex].classList.add("active");
                
                // Auto scroll if active char is near bottom
                let activeChar = characters[charIndex];
                if(activeChar.offsetTop > textDisplay.clientHeight - 20) {
                   // This is a simple scroll logic, can be improved but works for standard flow
                   // textDisplay.scrollTop = activeChar.offsetTop; 
                   // Actually, let's just let the user scroll or handle it if needed. 
                   // With max-height 250px, these paragraphs fit mostly or scroll slightly.
                   activeChar.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            }

            // Real-time stats
            // Accuracy: correct chars / total typed chars (current length)
            // Note: inputField.value.length is total typed currently
            // But mistakes is total errors made? No, mistakes is current errors. 
            // Let's calculate accuracy based on current correct vs total typed length
            
            let wpm = Math.round(((charIndex - mistakes)  / 5) / ((maxTime - timeLeft) / 60));
            wpm = wpm < 0 || !wpm || wpm === Infinity ? 0 : wpm;
            
            wpmTag.innerText = wpm;
            
            let accuracy = Math.floor(((charIndex - mistakes) / charIndex) * 100);
            accuracy = accuracy < 0 || !accuracy || accuracy === Infinity ? 100 : accuracy;
            accuracyTag.innerText = accuracy;
        } else if (charIndex >= characters.length) {
            // Finished text before time
            clearInterval(timer);
            finishGame();
        }
    }

    function initTimer() {
        if(timeLeft > 0) {
            timeLeft--;
            timerTag.innerText = timeLeft;
            
            // Recalculate WPM as time moves even if not typing
            let wpm = Math.round(((charIndex - mistakes)  / 5) / ((maxTime - timeLeft) / 60));
            wpm = wpm < 0 || !wpm || wpm === Infinity ? 0 : wpm;
            wpmTag.innerText = wpm;
        } else {
            clearInterval(timer);
            finishGame();
        }
    }

    function finishGame() {
        inputField.value = ""; // Clear input to prevent further typing
        inputField.disabled = true;
        
        let wpm = Math.round(((charIndex - mistakes)  / 5) / ((maxTime - timeLeft) / 60));
        wpm = wpm < 0 || !wpm || wpm === Infinity ? 0 : wpm;
        
        let accuracy = Math.floor(((charIndex - mistakes) / charIndex) * 100);
        accuracy = accuracy < 0 || !accuracy || accuracy === Infinity ? 100 : accuracy;

        finalWpm.innerText = wpm;
        finalAccuracy.innerText = accuracy + "%";
        finalCpm.innerText = charIndex; // Characters Per Minute / Total Chars
        finalErrors.innerText = mistakes;

        modal.classList.add("show");
    }

    function resetGame() {
        loadParagraph();
        clearInterval(timer);
        timeLeft = maxTime;
        charIndex = 0;
        mistakes = 0;
        isTyping = false;
        inputField.value = "";
        inputField.disabled = false;
        timerTag.innerText = timeLeft;
        wpmTag.innerText = 0;
        accuracyTag.innerText = 100;
        modal.classList.remove("show");
    }

    function closeModal() {
        resetGame();
    }

    // Event Listeners
    inputField.addEventListener("input", () => {
        // Fix to handle diff between input length and charIndex (e.g. if user pastes or types fast)
        // We only process if input length changed by 1 or -1 normally, but here we just check current state
        // To make it robust:
        // If input length > charIndex: user typed char(s)
        // If input length < charIndex: user backspaced
        
        const valLen = inputField.value.length;
        if (valLen > charIndex) {
            // Loop in case of fast typing or paste (though paste might not be accuracy friendly)
            // Just handle the last char typed for simple logic, or loop if diff > 1
            // For this simple app, we assume 1 char at a time or just catch up
            // Let's just run logic for the current charIndex
            initTyping();
        } else if (valLen < charIndex) {
            // Backspace
            initTyping();
        }
    });

    // Prevent pasting to ensure typing
    inputField.addEventListener("paste", (e) => {
        e.preventDefault();
        alert("Pasting is not allowed!");
    });

    // Initial Load
    loadParagraph();
</script>

</body>
</html>