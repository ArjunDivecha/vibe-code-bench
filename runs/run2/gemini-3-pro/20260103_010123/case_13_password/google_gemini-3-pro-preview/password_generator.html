<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secure Password Generator</title>
    <style>
        /* CSS Variables & Reset */
        :root {
            --primary: #4f46e5;
            --primary-hover: #4338ca;
            --bg: #f3f4f6;
            --card-bg: #ffffff;
            --text: #1f2937;
            --text-light: #6b7280;
            --border: #e5e7eb;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }

        body {
            background-color: var(--bg);
            color: var(--text);
            display: flex;
            justify-content: center;
            min-height: 100vh;
            padding: 2rem;
        }

        .container {
            width: 100%;
            max-width: 600px;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        h1 { text-align: center; color: var(--text); margin-bottom: 0.5rem; }
        p.subtitle { text-align: center; color: var(--text-light); margin-bottom: 1.5rem; }

        .card {
            background: var(--card-bg);
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        /* Controls */
        .control-group { margin-bottom: 1.5rem; }
        .control-header { display: flex; justify-content: space-between; margin-bottom: 0.5rem; }
        .control-label { font-weight: 600; font-size: 0.9rem; }
        .control-value { font-weight: 700; color: var(--primary); }

        input[type="range"] {
            width: 100%;
            height: 6px;
            background: var(--border);
            border-radius: 5px;
            outline: none;
            -webkit-appearance: none;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--primary);
            cursor: pointer;
            transition: background .15s ease-in-out;
            box-shadow: 0 1px 3px rgba(0,0,0,0.3);
        }
        input[type="range"]::-webkit-slider-thumb:hover { background: var(--primary-hover); }

        .checkbox-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }
        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
            user-select: none;
        }
        input[type="checkbox"] {
            width: 1.2rem;
            height: 1.2rem;
            accent-color: var(--primary);
            cursor: pointer;
        }

        .number-input {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid var(--border);
            border-radius: 0.5rem;
            font-size: 1rem;
            outline-color: var(--primary);
        }

        /* Strength Meter */
        .strength-container { margin-top: 1rem; }
        .strength-bar-bg {
            height: 8px;
            background: var(--border);
            border-radius: 4px;
            overflow: hidden;
            margin-top: 0.5rem;
        }
        .strength-bar-fill {
            height: 100%;
            width: 0%;
            transition: width 0.3s ease, background-color 0.3s ease;
        }
        .strength-text { font-size: 0.85rem; margin-top: 0.25rem; text-align: right; font-weight: 600; }

        /* Generate Button */
        .btn-generate {
            width: 100%;
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 1rem;
            border-radius: 0.5rem;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: background-color 0.2s;
            margin-top: 1rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            box-shadow: 0 4px 6px -1px rgba(79, 70, 229, 0.2);
        }
        .btn-generate:hover { background-color: var(--primary-hover); }
        .btn-generate:active { transform: translateY(1px); }

        /* Output Area */
        .output-list {
            margin-top: 2rem;
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }
        .password-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--bg);
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            border: 1px solid var(--border);
            font-family: 'Courier New', Courier, monospace;
            font-weight: 600;
            word-break: break-all;
            transition: border-color 0.2s;
        }
        .password-item:hover { border-color: var(--primary); }
        .password-text { font-size: 1.1rem; letter-spacing: 0.05em; color: var(--text); }
        
        .copy-btn {
            background: white;
            border: 1px solid var(--border);
            color: var(--text-light);
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 0.25rem;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-left: 1rem;
            flex-shrink: 0;
        }
        .copy-btn:hover { color: var(--primary); border-color: var(--primary); background: rgba(79, 70, 229, 0.05); }
        .copy-btn svg { width: 20px; height: 20px; }

        /* History */
        .history-section { margin-top: 2rem; }
        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--border);
        }
        .history-title { font-size: 1.1rem; font-weight: 600; }
        .clear-btn {
            font-size: 0.85rem;
            color: var(--text-light);
            text-decoration: underline;
            border: none;
            background: none;
            cursor: pointer;
        }
        .clear-btn:hover { color: var(--danger); }
        .history-list {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            max-height: 250px;
            overflow-y: auto;
            padding-right: 0.5rem;
        }
        /* Custom scrollbar for history */
        .history-list::-webkit-scrollbar { width: 6px; }
        .history-list::-webkit-scrollbar-track { background: var(--bg); }
        .history-list::-webkit-scrollbar-thumb { background: #d1d5db; border-radius: 3px; }

        .history-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.9rem;
            padding: 0.5rem;
            border-radius: 0.25rem;
            background: var(--bg);
        }
        .history-time { font-size: 0.75rem; color: var(--text-light); margin-right: 1rem; min-width: 60px; }
        .history-pwd { font-family: monospace; font-weight: 600; color: var(--text); overflow: hidden; text-overflow: ellipsis; white-space: nowrap; max-width: 250px; }

        /* Toast */
        .toast {
            position: fixed;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%);
            background: #333;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 2rem;
            font-size: 0.9rem;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
            z-index: 100;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
        }
        .toast.show { opacity: 1; }

        @media (max-width: 480px) {
            body { padding: 1rem; }
            .checkbox-grid { grid-template-columns: 1fr; }
            .history-pwd { max-width: 150px; }
        }
    </style>
</head>
<body>

<div class="container">
    <div>
        <h1>Password Generator</h1>
        <p class="subtitle">Create strong and secure passwords instantly</p>
    </div>

    <div class="card">
        <!-- Length Slider -->
        <div class="control-group">
            <div class="control-header">
                <span class="control-label">Password Length</span>
                <span class="control-value" id="lengthVal">16</span>
            </div>
            <input type="range" id="lengthRange" min="8" max="32" value="16">
        </div>

        <!-- Options -->
        <div class="control-group">
            <div class="control-header"><span class="control-label">Settings</span></div>
            <div class="checkbox-grid">
                <label class="checkbox-item">
                    <input type="checkbox" id="includeUppercase" checked> Uppercase (A-Z)
                </label>
                <label class="checkbox-item">
                    <input type="checkbox" id="includeLowercase" checked> Lowercase (a-z)
                </label>
                <label class="checkbox-item">
                    <input type="checkbox" id="includeNumbers" checked> Numbers (0-9)
                </label>
                <label class="checkbox-item">
                    <input type="checkbox" id="includeSymbols" checked> Symbols (!@#$)
                </label>
            </div>
        </div>

        <!-- Quantity -->
        <div class="control-group">
            <div class="control-header"><span class="control-label">Quantity to Generate</span></div>
            <input type="number" id="quantity" class="number-input" min="1" max="50" value="1">
        </div>

        <!-- Strength Meter (Preview based on settings) -->
        <div class="strength-container">
            <div class="control-header">
                <span class="control-label">Security Strength</span>
                <span class="strength-text" id="strengthText">Strong</span>
            </div>
            <div class="strength-bar-bg">
                <div class="strength-bar-fill" id="strengthBar"></div>
            </div>
        </div>

        <button class="btn-generate" id="generateBtn">Generate Passwords</button>

        <!-- Output -->
        <div class="output-list" id="outputList"></div>
    </div>

    <!-- History -->
    <div class="card history-section" id="historyCard" style="display:none;">
        <div class="history-header">
            <span class="history-title">Recent History</span>
            <button class="clear-btn" id="clearHistory">Clear History</button>
        </div>
        <div class="history-list" id="historyList"></div>
    </div>
</div>

<div class="toast" id="toast">Copied to clipboard!</div>

<script>
    // DOM Elements
    const lengthRange = document.getElementById('lengthRange');
    const lengthVal = document.getElementById('lengthVal');
    const includeUppercase = document.getElementById('includeUppercase');
    const includeLowercase = document.getElementById('includeLowercase');
    const includeNumbers = document.getElementById('includeNumbers');
    const includeSymbols = document.getElementById('includeSymbols');
    const quantityInput = document.getElementById('quantity');
    const generateBtn = document.getElementById('generateBtn');
    const outputList = document.getElementById('outputList');
    const strengthBar = document.getElementById('strengthBar');
    const strengthText = document.getElementById('strengthText');
    const historyList = document.getElementById('historyList');
    const historyCard = document.getElementById('historyCard');
    const clearHistoryBtn = document.getElementById('clearHistory');
    const toast = document.getElementById('toast');

    // Charsets
    const CHARS_UPPER = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
    const CHARS_LOWER = 'abcdefghijklmnopqrstuvwxyz';
    const CHARS_NUMBER = '0123456789';
    const CHARS_SYMBOL = '!@#$%^&*()_+~`|}{[]:;?><,./-=';

    // State
    let history = [];

    // Initialization
    updateStrengthMeter();
    
    // Attempt to load from localStorage
    try {
        const saved = localStorage.getItem('pwd_history');
        if (saved) history = JSON.parse(saved);
    } catch(e) { console.log('Storage access denied'); }
    
    renderHistory();

    // Event Listeners
    lengthRange.addEventListener('input', () => {
        lengthVal.textContent = lengthRange.value;
        updateStrengthMeter();
    });

    [includeUppercase, includeLowercase, includeNumbers, includeSymbols].forEach(el => {
        el.addEventListener('change', updateStrengthMeter);
    });

    generateBtn.addEventListener('click', generatePasswords);
    clearHistoryBtn.addEventListener('click', clearHistory);

    // Functions

    function calculateEntropy(length, poolSize) {
        if (poolSize === 0) return 0;
        return length * Math.log2(poolSize);
    }

    function updateStrengthMeter() {
        const length = parseInt(lengthRange.value);
        let poolSize = 0;
        
        if (includeUppercase.checked) poolSize += 26;
        if (includeLowercase.checked) poolSize += 26;
        if (includeNumbers.checked) poolSize += 10;
        if (includeSymbols.checked) poolSize += 30;

        const entropy = calculateEntropy(length, poolSize);
        
        let strength = 0; // 0 to 4
        let label = 'Very Weak';
        let color = 'var(--danger)';

        if (poolSize === 0) {
            strength = 0;
        } else {
            // Adjusted thresholds for 8-32 length range
            if (entropy < 40) {
                strength = 1; label = 'Weak'; color = '#ef4444';
            } else if (entropy < 60) {
                strength = 2; label = 'Fair'; color = '#f59e0b';
            } else if (entropy < 80) {
                strength = 3; label = 'Good'; color = '#10b981';
            } else {
                strength = 4; label = 'Strong'; color = '#059669';
            }
        }

        const percentage = (strength / 4) * 100;
        strengthBar.style.width = `${Math.max(5, percentage)}%`;
        strengthBar.style.backgroundColor = color;
        strengthText.textContent = label;
        strengthText.style.color = color;
    }

    function generateSinglePassword(length) {
        let pool = '';
        const mandatory = [];
        
        if (includeUppercase.checked) {
            pool += CHARS_UPPER;
            mandatory.push(CHARS_UPPER);
        }
        if (includeLowercase.checked) {
            pool += CHARS_LOWER;
            mandatory.push(CHARS_LOWER);
        }
        if (includeNumbers.checked) {
            pool += CHARS_NUMBER;
            mandatory.push(CHARS_NUMBER);
        }
        if (includeSymbols.checked) {
            pool += CHARS_SYMBOL;
            mandatory.push(CHARS_SYMBOL);
        }

        if (!pool) return '';

        let passwordChars = [];
        const cryptoObj = window.crypto;

        // Add one from each mandatory set to ensure variety
        mandatory.forEach(set => {
            const randIndex = cryptoObj.getRandomValues(new Uint32Array(1))[0] % set.length;
            passwordChars.push(set[randIndex]);
        });

        // Fill remaining
        const remaining = length - passwordChars.length;
        if (remaining > 0) {
            const randVals = new Uint32Array(remaining);
            cryptoObj.getRandomValues(randVals);
            for(let i=0; i<remaining; i++) {
                passwordChars.push(pool[randVals[i] % pool.length]);
            }
        } else if (remaining < 0) {
            // Should not happen given min length 8 and max types 4
            passwordChars = passwordChars.slice(0, length);
        }

        // Shuffle using Fisher-Yates
        for (let i = passwordChars.length - 1; i > 0; i--) {
            const j = cryptoObj.getRandomValues(new Uint32Array(1))[0] % (i + 1);
            [passwordChars[i], passwordChars[j]] = [passwordChars[j], passwordChars[i]];
        }

        return passwordChars.join('');
    }

    function generatePasswords() {
        if (!includeUppercase.checked && !includeLowercase.checked && !includeNumbers.checked && !includeSymbols.checked) {
            showToast('Please select at least one character type.');
            return;
        }

        const length = parseInt(lengthRange.value);
        let qty = parseInt(quantityInput.value);
        if (isNaN(qty) || qty < 1) qty = 1;
        if (qty > 50) qty = 50; 

        outputList.innerHTML = '';
        const newPasswords = [];

        for (let i = 0; i < qty; i++) {
            const pwd = generateSinglePassword(length);
            newPasswords.push(pwd);
            createPasswordElement(pwd);
        }

        addToHistory(newPasswords);
        
        // Scroll to output if nice
        if (window.innerWidth < 600) {
            outputList.scrollIntoView({ behavior: 'smooth' });
        }
    }

    function createPasswordElement(pwd) {
        const item = document.createElement('div');
        item.className = 'password-item';
        
        const text = document.createElement('span');
        text.className = 'password-text';
        text.textContent = pwd;

        const btn = document.createElement('button');
        btn.className = 'copy-btn';
        btn.innerHTML = `
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
            </svg>
        `;
        btn.title = "Copy to Clipboard";
        btn.onclick = () => copyToClipboard(pwd);

        item.appendChild(text);
        item.appendChild(btn);
        outputList.appendChild(item);
    }

    function copyToClipboard(text) {
        navigator.clipboard.writeText(text).then(() => {
            showToast('Copied to clipboard!');
        }).catch(err => {
            console.error('Failed to copy: ', err);
            const textArea = document.createElement("textarea");
            textArea.value = text;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand("Copy");
            textArea.remove();
            showToast('Copied to clipboard!');
        });
    }

    function showToast(msg) {
        toast.textContent = msg;
        toast.classList.add('show');
        setTimeout(() => {
            toast.classList.remove('show');
        }, 2000);
    }

    function addToHistory(passwords) {
        const timestamp = new Date().toLocaleTimeString('en-US', { hour12: false, hour: "2-digit", minute: "2-digit" });
        
        // Add in reverse order of generation to put newest on top
        for (let i = passwords.length - 1; i >= 0; i--) {
            history.unshift({ pwd: passwords[i], time: timestamp });
        }

        // Keep last 20
        if (history.length > 20) {
            history = history.slice(0, 20);
        }
        
        saveHistory();
        renderHistory();
    }

    function renderHistory() {
        historyList.innerHTML = '';
        if (history.length === 0) {
            historyCard.style.display = 'none';
            return;
        }
        historyCard.style.display = 'block';

        history.forEach(item => {
            const div = document.createElement('div');
            div.className = 'history-item';
            
            const infoDiv = document.createElement('div');
            infoDiv.style.display = 'flex';
            infoDiv.style.alignItems = 'center';
            infoDiv.style.overflow = 'hidden';

            const timeSpan = document.createElement('span');
            timeSpan.className = 'history-time';
            timeSpan.textContent = item.time;
            
            const pwdSpan = document.createElement('span');
            pwdSpan.className = 'history-pwd';
            pwdSpan.textContent = item.pwd;

            infoDiv.appendChild(timeSpan);
            infoDiv.appendChild(pwdSpan);

            const copyBtn = document.createElement('button');
            copyBtn.className = 'copy-btn';
            copyBtn.style.padding = '0.25rem';
            copyBtn.style.marginLeft = '0.5rem';
            copyBtn.innerHTML = `
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" style="width:16px;height:16px;">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
                </svg>
            `;
            copyBtn.onclick = () => copyToClipboard(item.pwd);

            div.appendChild(infoDiv);
            div.appendChild(copyBtn);
            historyList.appendChild(div);
        });
    }

    function clearHistory() {
        history = [];
        saveHistory();
        renderHistory();
    }
    
    function saveHistory() {
        try {
            localStorage.setItem('pwd_history', JSON.stringify(history));
        } catch(e) {}
    }

</script>
</body>
</html>