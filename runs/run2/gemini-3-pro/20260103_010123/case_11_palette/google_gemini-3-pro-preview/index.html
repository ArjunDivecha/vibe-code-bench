<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChromaGen - Color Palette Generator</title>
    <style>
        :root {
            --bg-color: #1a1a1a;
            --text-color: #ffffff;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --font-main: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: var(--font-main);
            background-color: var(--bg-color);
            color: var(--text-color);
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* Header / Nav */
        header {
            padding: 1rem 2rem;
            background: #fff;
            color: #333;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--shadow);
            z-index: 10;
        }

        h1 {
            font-size: 1.5rem;
            font-weight: 700;
            letter-spacing: -1px;
        }

        .controls {
            display: flex;
            gap: 1rem;
        }

        button {
            cursor: pointer;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 8px;
            font-weight: 600;
            transition: transform 0.1s, opacity 0.2s;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        button:active {
            transform: scale(0.95);
        }

        .btn-primary {
            background-color: #333;
            color: #fff;
        }

        .btn-secondary {
            background-color: #f0f0f0;
            color: #333;
            border: 1px solid #ddd;
        }

        /* Palette Container */
        .palette {
            flex: 1;
            display: flex;
            width: 100%;
            height: 100%;
        }

        .color-col {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: relative;
            transition: background-color 0.3s ease;
            height: 100%;
        }

        .color-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            background: rgba(0, 0, 0, 0.1); /* fallback */
            padding: 1rem;
            border-radius: 12px;
            backdrop-filter: blur(5px); /* glassmorphism if supported */
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s;
        }
        
        /* Adjust text color dynamically based on background brightness */
        .color-col.light-bg .color-content {
            color: #333;
            background: rgba(255, 255, 255, 0.4);
        }
        
        .color-col.dark-bg .color-content {
            color: #fff;
            background: rgba(0, 0, 0, 0.2);
        }

        .color-col:hover .color-content {
            transform: scale(1.05);
        }

        .color-hex {
            font-size: 1.8rem;
            font-weight: 700;
            cursor: pointer;
            user-select: none;
            text-transform: uppercase;
        }

        .color-name {
            font-size: 1rem;
            font-weight: 500;
            opacity: 0.9;
        }

        .lock-btn {
            background: transparent;
            border: none;
            padding: 0.5rem;
            margin-top: 1rem;
            opacity: 0.5;
            transition: opacity 0.2s, transform 0.2s;
            color: inherit;
        }

        .lock-btn:hover {
            opacity: 1;
            transform: scale(1.2);
        }

        .lock-btn.locked {
            opacity: 1;
        }

        .lock-btn svg {
            width: 24px;
            height: 24px;
            fill: currentColor;
        }

        /* Toast Notification */
        .toast {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background-color: #333;
            color: #fff;
            padding: 1rem 2rem;
            border-radius: 50px;
            font-weight: 600;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            z-index: 100;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .toast.show {
            transform: translateX(-50%) translateY(0);
        }

        .toast-color-sample {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            border: 2px solid #fff;
        }

        /* Library / Favorites Modal */
        .library-panel {
            position: fixed;
            top: 0;
            right: 0;
            width: 350px;
            height: 100%;
            background: #fff;
            color: #333;
            box-shadow: -5px 0 15px rgba(0,0,0,0.1);
            transform: translateX(100%);
            transition: transform 0.3s ease;
            z-index: 20;
            display: flex;
            flex-direction: column;
        }

        .library-panel.open {
            transform: translateX(0);
        }

        .library-header {
            padding: 1.5rem;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .close-library {
            background: transparent;
            padding: 0;
            font-size: 1.5rem;
        }

        .library-content {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
        }

        .saved-palette {
            background: #f9f9f9;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .saved-palette:hover {
            transform: translateY(-2px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .saved-palette-preview {
            display: flex;
            height: 40px;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 0.5rem;
        }

        .mini-color {
            flex: 1;
        }

        .saved-palette-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.9rem;
            color: #666;
        }

        .delete-btn {
            background: transparent;
            color: #ff4757;
            padding: 4px;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .palette {
                flex-direction: column;
            }
            .color-col {
                flex-direction: row;
                justify-content: space-between;
                padding: 0 2rem;
            }
            .color-content {
                flex-direction: row;
                background: none;
                box-shadow: none;
                backdrop-filter: none;
            }
            .color-col.light-bg .color-content,
            .color-col.dark-bg .color-content {
                background: transparent;
            }
            .lock-btn {
                margin-top: 0;
            }
            .color-name {
                display: none; /* hide name on mobile to save space */
            }
        }
    </style>
</head>
<body>

    <header>
        <h1>ChromaGen</h1>
        <div class="controls">
            <button class="btn-secondary" id="libraryBtn">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"></path>
                </svg>
                Library
            </button>
            <button class="btn-primary" id="generateBtn">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M23 4v6h-6"></path>
                    <path d="M1 20v-6h6"></path>
                    <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path>
                </svg>
                Generate
            </button>
            <button class="btn-secondary" id="saveBtn">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
                    <polyline points="17 21 17 13 7 13 7 21"></polyline>
                    <polyline points="7 3 7 8 15 8"></polyline>
                </svg>
                Save
            </button>
        </div>
    </header>

    <div class="palette" id="palette">
        <!-- Columns injected by JS -->
    </div>

    <!-- Library Slide-out -->
    <div class="library-panel" id="libraryPanel">
        <div class="library-header">
            <h2>Saved Palettes</h2>
            <button class="close-library" id="closeLibrary">&times;</button>
        </div>
        <div class="library-content" id="libraryContent">
            <!-- Saved items injected here -->
            <p style="text-align:center; color:#999; margin-top:2rem;" id="emptyMsg">No saved palettes yet.</p>
        </div>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast">
        <div class="toast-color-sample" id="toastColor"></div>
        <span id="toastMsg">Color copied!</span>
    </div>

    <script>
        // --- Data & State ---
        const cols = 5;
        let colors = [];
        let savedPalettes = JSON.parse(localStorage.getItem('chromagen_palettes') || '[]');

        // Simple list of named colors for nearest match
        const colorNames = {
            "#000000": "Black", "#ffffff": "White", "#ff0000": "Red", "#00ff00": "Lime", "#0000ff": "Blue",
            "#ffff00": "Yellow", "#00ffff": "Cyan", "#ff00ff": "Magenta", "#c0c0c0": "Silver", "#808080": "Gray",
            "#800000": "Maroon", "#808000": "Olive", "#008000": "Green", "#800080": "Purple", "#008080": "Teal",
            "#000080": "Navy", "#ffa500": "Orange", "#ffc0cb": "Pink", "#4b0082": "Indigo", "#f0e68c": "Khaki",
            "#e6e6fa": "Lavender", "#add8e6": "Light Blue", "#90ee90": "Light Green", "#ffb6c1": "Light Pink",
            "#ffffe0": "Light Yellow", "#20b2aa": "Light Sea Green", "#87cefa": "Light Sky Blue", "#778899": "Light Slate Gray",
            "#b0c4de": "Light Steel Blue", "#ff7f50": "Coral", "#6495ed": "Cornflower Blue", "#dc143c": "Crimson",
            "#00ced1": "Dark Turquoise", "#9400d3": "Dark Violet", "#ff1493": "Deep Pink", "#00bfff": "Deep Sky Blue",
            "#696969": "Dim Gray", "#1e90ff": "Dodger Blue", "#b22222": "Fire Brick", "#228b22": "Forest Green",
            "#dcdcdc": "Gainsboro", "#ffd700": "Gold", "#daa520": "Golden Rod", "#adff2f": "Green Yellow",
            "#f0fff0": "Honey Dew", "#ff69b4": "Hot Pink", "#cd5c5c": "Indian Red", "#f0e68c": "Khaki",
            "#e0ffff": "Light Cyan", "#fafad2": "Light Golden Rod Yellow", "#d3d3d3": "Light Gray", "#ff6347": "Tomato",
            "#40e0d0": "Turquoise", "#ee82ee": "Violet", "#f5deb3": "Wheat", "#f5f5f5": "White Smoke", 
            "#32cd32": "Lime Green", "#faf0e6": "Linen", "#66cdaa": "Medium Aquamarine", "#0000cd": "Medium Blue",
            "#ba55d3": "Medium Orchid", "#9370db": "Medium Purple", "#3cb371": "Medium Sea Green", "#7b68ee": "Medium Slate Blue",
            "#00fa9a": "Medium Spring Green", "#48d1cc": "Medium Turquoise", "#c71585": "Medium Violet Red", "#191970": "Midnight Blue",
            "#f5fffa": "Mint Cream", "#ffe4e1": "Misty Rose", "#ffe4b5": "Moccasin", "#ffdead": "Navajo White",
            "#fdf5e6": "Old Lace", "#6b8e23": "Olive Drab", "#ff4500": "Orange Red", "#da70d6": "Orchid",
            "#eee8aa": "Pale Golden Rod", "#98fb98": "Pale Green", "#afeeee": "Pale Turquoise", "#db7093": "Pale Violet Red",
            "#ffefd5": "Papaya Whip", "#ffdab9": "Peach Puff", "#cd853f": "Peru", "#b0e0e6": "Powder Blue",
            "#bc8f8f": "Rosy Brown", "#4169e1": "Royal Blue", "#8b4513": "Saddle Brown", "#fa8072": "Salmon",
            "#f4a460": "Sandy Brown", "#2e8b57": "Sea Green", "#fff5ee": "Sea Shell", "#a0522d": "Sienna",
            "#87ceeb": "Sky Blue", "#6a5acd": "Slate Blue", "#708090": "Slate Gray", "#fffafa": "Snow",
            "#00ff7f": "Spring Green", "#4682b4": "Steel Blue", "#d2b48c": "Tan", "#d8bfd8": "Thistle",
        };

        // --- Helpers ---

        function generateRandomColor() {
            // Using HSL for better vibrancy control
            const h = Math.floor(Math.random() * 360);
            const s = Math.floor(Math.random() * 40) + 60; // 60-100% saturation
            const l = Math.floor(Math.random() * 50) + 25; // 25-75% lightness
            return hslToHex(h, s, l);
        }

        function hslToHex(h, s, l) {
            l /= 100;
            const a = s * Math.min(l, 1 - l) / 100;
            const f = n => {
                const k = (n + h / 30) % 12;
                const color = l - a * Math.max(Math.min(k - 3, 9 - k, 1), -1);
                return Math.round(255 * color).toString(16).padStart(2, '0');
            };
            return `#${f(0)}${f(8)}${f(4)}`;
        }

        function getContrastYIQ(hexcolor){
            hexcolor = hexcolor.replace("#", "");
            var r = parseInt(hexcolor.substr(0,2),16);
            var g = parseInt(hexcolor.substr(2,2),16);
            var b = parseInt(hexcolor.substr(4,2),16);
            var yiq = ((r*299)+(g*587)+(b*114))/1000;
            return (yiq >= 128) ? 'black' : 'white';
        }

        function hexToRgb(hex) {
            var result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
            return result ? {
                r: parseInt(result[1], 16),
                g: parseInt(result[2], 16),
                b: parseInt(result[3], 16)
            } : null;
        }

        function getColorName(hex) {
            // Find closest color in our list
            let minDistance = Infinity;
            let closestName = "Color";
            
            const rgb1 = hexToRgb(hex);
            
            for (const [key, name] of Object.entries(colorNames)) {
                const rgb2 = hexToRgb(key);
                // Euclidean distance
                const d = Math.sqrt(
                    Math.pow(rgb1.r - rgb2.r, 2) +
                    Math.pow(rgb1.g - rgb2.g, 2) +
                    Math.pow(rgb1.b - rgb2.b, 2)
                );
                
                if (d < minDistance) {
                    minDistance = d;
                    closestName = name;
                }
            }
            return closestName;
        }

        // --- Core Functions ---

        function init() {
            const paletteContainer = document.getElementById('palette');
            
            // Initialize state if empty
            if (colors.length === 0) {
                for (let i = 0; i < cols; i++) {
                    colors.push({
                        hex: generateRandomColor(),
                        locked: false
                    });
                }
            }

            // Create DOM elements
            paletteContainer.innerHTML = '';
            colors.forEach((col, index) => {
                const colDiv = document.createElement('div');
                colDiv.className = 'color-col';
                colDiv.id = `col-${index}`;
                
                const contentDiv = document.createElement('div');
                contentDiv.className = 'color-content';

                const nameText = document.createElement('span');
                nameText.className = 'color-name';
                
                const hexText = document.createElement('h2');
                hexText.className = 'color-hex';
                hexText.onclick = () => copyToClipboard(col.hex);

                const lockBtn = document.createElement('button');
                lockBtn.className = 'lock-btn';
                lockBtn.innerHTML = getLockIcon(col.locked);
                lockBtn.onclick = (e) => toggleLock(index, e.currentTarget);

                contentDiv.appendChild(hexText);
                contentDiv.appendChild(nameText);
                contentDiv.appendChild(lockBtn);
                colDiv.appendChild(contentDiv);
                paletteContainer.appendChild(colDiv);
            });

            updatePaletteUI();
            updateLibraryUI();
        }

        function updatePaletteUI() {
            colors.forEach((colObj, index) => {
                const colDiv = document.getElementById(`col-${index}`);
                const hexText = colDiv.querySelector('.color-hex');
                const nameText = colDiv.querySelector('.color-name');
                const lockBtn = colDiv.querySelector('.lock-btn');

                // Update Background
                colDiv.style.backgroundColor = colObj.hex;
                
                // Update Text
                hexText.innerText = colObj.hex;
                nameText.innerText = getColorName(colObj.hex);

                // Update Contrast Class
                const contrast = getContrastYIQ(colObj.hex);
                colDiv.classList.remove('light-bg', 'dark-bg');
                colDiv.classList.add(contrast === 'black' ? 'light-bg' : 'dark-bg');

                // Update Lock Icon
                lockBtn.innerHTML = getLockIcon(colObj.locked);
                if (colObj.locked) {
                    lockBtn.classList.add('locked');
                } else {
                    lockBtn.classList.remove('locked');
                }
            });
        }

        function generatePalette() {
            colors.forEach((col, index) => {
                if (!col.locked) {
                    col.hex = generateRandomColor();
                }
            });
            updatePaletteUI();
        }

        function toggleLock(index, btn) {
            colors[index].locked = !colors[index].locked;
            updatePaletteUI();
        }

        function getLockIcon(isLocked) {
            if (isLocked) {
                // Closed Lock
                return `<svg viewBox="0 0 24 24"><path d="M19 11H5a2 2 0 0 0-2 2v7a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7a2 2 0 0 0-2-2zm-7-7a4 4 0 0 1 4 4v3h-8V8a4 4 0 0 1 4-4z"></path></svg>`;
            } else {
                // Open Lock
                return `<svg viewBox="0 0 24 24"><path d="M19 11H5a2 2 0 0 0-2 2v7a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7a2 2 0 0 0-2-2zm-7-7a4 4 0 0 1 4 4v3h-2V8a2 2 0 0 0-4 0v3H8V8a4 4 0 0 1 4-4z"></path></svg>`;
            }
        }

        function copyToClipboard(hex) {
            navigator.clipboard.writeText(hex).then(() => {
                showToast(hex);
            });
        }

        function showToast(hex) {
            const toast = document.getElementById('toast');
            const toastColor = document.getElementById('toastColor');
            const toastMsg = document.getElementById('toastMsg');
            
            toastColor.style.backgroundColor = hex;
            toastMsg.innerText = `Copied ${hex} to clipboard!`;
            
            toast.classList.add('show');
            setTimeout(() => {
                toast.classList.remove('show');
            }, 2000);
        }

        // --- Library Functions ---

        function savePalette() {
            const paletteToSave = {
                id: Date.now(),
                colors: colors.map(c => c.hex),
                date: new Date().toLocaleDateString()
            };
            savedPalettes.unshift(paletteToSave); // Add to top
            localStorage.setItem('chromagen_palettes', JSON.stringify(savedPalettes));
            updateLibraryUI();
            
            // Open library to show success
            document.getElementById('libraryPanel').classList.add('open');
        }

        function deletePalette(id, event) {
            event.stopPropagation();
            savedPalettes = savedPalettes.filter(p => p.id !== id);
            localStorage.setItem('chromagen_palettes', JSON.stringify(savedPalettes));
            updateLibraryUI();
        }

        function loadPalette(paletteObj) {
            // Unlock all to apply new palette cleanly or keep locks? 
            // Usually loading a palette overwrites everything.
            colors = paletteObj.colors.map(hex => ({
                hex: hex,
                locked: false
            }));
            updatePaletteUI();
            document.getElementById('libraryPanel').classList.remove('open');
        }

        function updateLibraryUI() {
            const content = document.getElementById('libraryContent');
            const emptyMsg = document.getElementById('emptyMsg');
            
            // Clear current list (keeping the empty msg element reference is tricky if we wipe innerHTML, so let's rebuild)
            content.innerHTML = '';

            if (savedPalettes.length === 0) {
                content.appendChild(emptyMsg);
                emptyMsg.style.display = 'block';
                return;
            } else {
                // We create a new empty msg just in case or hide the old one if we didn't wipe it
                // simpler to just wipe and check length
            }

            savedPalettes.forEach(p => {
                const item = document.createElement('div');
                item.className = 'saved-palette';
                item.onclick = () => loadPalette(p);

                const preview = document.createElement('div');
                preview.className = 'saved-palette-preview';
                
                p.colors.forEach(c => {
                    const div = document.createElement('div');
                    div.className = 'mini-color';
                    div.style.backgroundColor = c;
                    preview.appendChild(div);
                });

                const info = document.createElement('div');
                info.className = 'saved-palette-info';
                
                const dateSpan = document.createElement('span');
                dateSpan.innerText = p.date;

                const delBtn = document.createElement('button');
                delBtn.className = 'delete-btn';
                delBtn.innerHTML = `<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>`;
                delBtn.onclick = (e) => deletePalette(p.id, e);

                info.appendChild(dateSpan);
                info.appendChild(delBtn);

                item.appendChild(preview);
                item.appendChild(info);
                content.appendChild(item);
            });
        }

        // --- Event Listeners ---

        document.getElementById('generateBtn').addEventListener('click', generatePalette);
        
        document.getElementById('saveBtn').addEventListener('click', savePalette);

        document.getElementById('libraryBtn').addEventListener('click', () => {
            document.getElementById('libraryPanel').classList.add('open');
        });

        document.getElementById('closeLibrary').addEventListener('click', () => {
            document.getElementById('libraryPanel').classList.remove('open');
        });

        document.body.addEventListener('keydown', (e) => {
            if (e.code === 'Space') {
                e.preventDefault(); // prevent scrolling
                generatePalette();
            }
        });

        // Initialize
        init();

    </script>
</body>
</html>