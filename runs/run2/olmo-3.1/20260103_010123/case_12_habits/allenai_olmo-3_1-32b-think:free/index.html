<!DOCTYPE html>
<html>
<head>
    <title>Habit Tracker</title>
    <style>
        body { font-family: Arial; max-width: 800px; margin: 0 auto; padding: 20px; }
        .container { display: flex; flex-wrap: wrap; gap: 20px; }
        .habit-box { border: 1px solid #ddd; padding: 10px; margin: 10px; border-radius: 5px; }
        .habit-box input[type="checkbox"] { margin-right: 5px; }
        .calendar { width: 100%; border-collapse: collapse; }
        .calendar th, .calendar td { border: 1px solid #ddd; padding: 8px; text-align: center; }
        .calendar th { background-color: #f2f2f2; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Habit Tracker</h1>
        <div id="add-habit">
            <form onsubmit="addHabit(); return false;">
                <input type="text" id="habit-input" placeholder="Add a new habit">
                <button type="submit">Add</button>
            </form>
        </div>
        
        <div id="habits-list">
        </div>
        
        <div id="calendar-view">
            <h2>Calendar View (Last 30 Days)</h2>
            <table id="calendar-table">
                <thead>
                    <tr>
                        <th>Date</th>
                    </tr>
                </thead>
                <tbody id="calendar-body">
                </tbody>
            </table>
        </div>
    </div>

    <script>
        let habits = [];
        let lastUpdated = null;

        function loadHabits() {
            const storedHabits = localStorage.getItem('habits');
            if (storedHabits) {
                habits = JSON.parse(storedHabits);
            } else {
                habits = [];
            }
        }

        function getToday() {
            const today = new Date();
            return today.toISOString().split('T')[0];
        }

        function addHabit() {
            const input = document.getElementById('habit-input');
            const habitName = input.value.trim();
            if (habitName) {
                const newHabit = {
                    id: habits.length + 1,
                    name: habitName,
                    completedDays: []
                };
                habits.push(newHabit);
                localStorage.setItem('habits', JSON.stringify(habits));
                updateAll(); // Fixed: call updateAll instead of renderHabits
                input.value = '';
            }
        }

        function markHabitCompleted(habitId) {
            const today = getToday();
            const habit = habits.find(h => h.id === habitId);
            if (!habit) return;
            if (!habit.completedDays.includes(today)) {
                habit.completedDays.push(today);
                localStorage.setItem('habits', JSON.stringify(habits));
                updateAll();
            }
        }

        function calculateStreak(habit) {
            const today = getToday();
            if (!habit.completedDays.includes(today)) {
                return 0;
            }
            let streak = 1;
            let currentDate = new Date(today);
            currentDate.setDate(currentDate.getDate() - 1);
            while (habit.completedDays.includes(currentDate.toISOString().split('T')[0])) {
                streak++;
                currentDate.setDate(currentDate.getDate() -1);
            }
            return streak;
        }

        function calculateCompletion(habit) {
            const today = new Date(getToday());
            const thirtyDaysAgo = new Date(today);
            thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 29);
            let count = 0;
            let currentDate = new Date(thirtyDaysAgo);
            for (let i = 0; i < 30; i++) {
                const dateString = currentDate.toISOString().split('T')[0];
                if (habit.completedDays.includes(dateString)) {
                    count++;
                }
                currentDate.setDate(currentDate.getDate() +1);
            }
            const percentage = Math.round((count /30) * 100);
            return percentage + '%';
        }

        function renderHabits() {
            const habitsList = document.getElementById('habits-list');
            habitsList.innerHTML = '';
            habits.forEach(habit => {
                const today = getToday();
                const checked = habit.completedDays.includes(today) ? 'checked' : '';
                habitsList.innerHTML += `
                <div class="habit-box">
                    <input type="checkbox" ${checked} onclick="markHabitCompleted(${habit.id})" />
                    ${habit.name}
                    <span>Streak: ${calculateStreak(habit)}</span>
                    <span>Completion: ${calculateCompletion(habit)}</span>
                </div>
                `;
            });
        }

        function renderCalendar() {
            const calendarBody = document.getElementById('calendar-body');
            calendarBody.innerHTML = '';
            const days = [];
            const today = new Date(getToday());
            let currentDate = new Date(today);
            currentDate.setDate(currentDate.getDate() - 29);
            for (let i = 0; i < 30; i++) {
                days.push(currentDate.toISOString().split('T')[0]);
                currentDate.setDate(currentDate.getDate() +1);
            }
            
            days.forEach(day => {
                const row = document.createElement('tr');
                const dateCell = document.createElement('td');
                const dateObj = new Date(day);
                dateCell.textContent = dateObj.toLocaleDateString('en-US', { weekday: 'long', day: 'numeric', month: 'short' });
                row.appendChild(dateCell);
                
                habits.forEach(habit => {
                    const completed = habit.completedDays.includes(day);
                    const cell = document.createElement('td');
                    cell.textContent = completed ? '✓' : '✗';
                    row.appendChild(cell);
                });
                calendarBody.appendChild(row);
            });
        }

        function updateAll() {
            renderHabits();
            renderCalendar();
        }

        document.getElementById('add-habit').addEventListener('submit', function(e) {
            e.preventDefault();
            addHabit();
        });

        loadHabits();
        updateAll();
    </script>
</body>
</html>