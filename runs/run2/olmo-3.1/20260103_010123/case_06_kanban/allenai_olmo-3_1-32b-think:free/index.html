<!DOCTYPE html>
<html>
<head>
    <title>Kanban Board</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 1000;
        }

        .column {
            display: flex;
            flex: 1;
            margin: 10px;
            border: 1px solid #ddd;
            padding: 10px;
            box-sizing: border-box;
        }

        .column h2 {
            margin-bottom: 10px;
        }

        ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        li {
            padding: 10px;
            margin-bottom: 10px;
            border-bottom: 1px solid #eee;
            cursor: move;
        }

        .card {
            background: white;
            padding: 15px;
            margin: 5px;
            border-radius: 5px;
            text-align: center;
            cursor: grab;
            user-select: none;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .card-red { background-color: red; }
        .card-yellow { background-color: yellow; }
        .card-green { background-color: green; }

        .card-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
        }

        .card-content h3 {
            font-size: 1.2em;
        }

        button {
            padding: 5px 10px;
            margin: 5px;
            cursor: pointer;
        }

        button.edit-btn {
            background-color: #4CAF50;
            color: white;
        }

        button.delete-btn {
            background-color: #f44336;
            color: white;
        }

        input[type="text"] {
            width: 100%;
            padding: 8px;
            margin: 5px;
            font-size: 1em;
        }

        button {
            margin-left: 10px;
        }
    </style>
</head>
<body>
    <h1>Kanban Board</h1>
    <form id="add-card-form">
        <input type="text" id="card-title" placeholder="Enter card title" required>
        <select id="priority">
            <option value="red">Urgent (Red)</option>
            <option value="yellow">Medium (Yellow)</option>
            <option value="green">Low (Green)</option>
        </select>
        <button type="submit">Add Card</button>
    </form>

    <div class="board">
        <div class="column to-do">
            <h2>To Do</h2>
            <ul id="to-do-list"></ul>
        </div>
        <div class="column in-progress">
            <h2>In Progress</h2>
            <ul id="in-progress-list"></ul>
        </div>
        <div class="column done">
            <h2>Done</h2>
            <ul id="done-list"></ul>
        </div>
    </div>

    <script>
        const columnMapping = {
            'to-do': 'toDo',
            'in-progress': 'inProgress',
            'done': 'done'
        };

        let state = { toDo: [], inProgress: [], done: [] };
        let nextId = 1;

        function saveState() {
            localStorage.setItem('kanbanState', JSON.stringify(state));
        }

        function loadState() {
            const savedState = localStorage.getItem('kanbanState');
            if (savedState) {
                state = JSON.parse(savedState);
                const allIds = [];
                for (const column of Object.values(state)) {
                    for (const card of column) {
                        allIds.push(card.id);
                    }
                }
                if (allIds.length > 0) {
                    nextId = Math.max(...allIds) + 1;
                }
            }
            render();
        }

        function findCardInState(state, id) {
            for (const colName in state) {
                for (const card of state[colName]) {
                    if (card.id === parseInt(id)) {
                        return card;
                    }
                }
            }
            return null;
        }

        function findCardColumn(card) {
            for (const col in state) {
                if (state[col].some(c => c.id === card.id)) {
                    return col;
                }
            }
            return null;
        }

        function moveCard(card, targetColumn) {
            const currentColumn = findCardColumn(card);
            if (currentColumn && currentColumn !== targetColumn) {
                state[targetColumn].push(card);
                state[currentColumn].splice(state[currentColumn].indexOf(card), 1);
                saveState();
                render();
            }
        }

        function deleteCard(card) {
            const column = findCardColumn(card);
            if (column) {
                state[column].splice(state[column].indexOf(card), 1);
                saveState();
                render();
            }
        }

        function editCard(card) {
            const editInput = document.createElement('input');
            editInput.value = card.title;
            editInput.focus();
            
            const saveBtn = document.createElement('button');
            saveBtn.textContent = 'Save';
            saveBtn.addEventListener('click', function() {
                card.title = editInput.value.trim();
                saveState();
                render();
                document.body.removeChild(editInput);
                document.body.removeChild(saveBtn);
            });
            
            const cancelBtn = document.createElement('button');
            cancelBtn.textContent = 'Cancel';
            cancelBtn.addEventListener('click', function() {
                document.body.removeChild(editInput);
                document.body.removeChild(saveBtn);
            });
            
            document.body.appendChild(editInput);
            document.body.appendChild(saveBtn);
            document.body.appendChild(cancelBtn);
        }

        function addCard(e) {
            e.preventDefault();
            const titleInput = document.getElementById('card-title');
            const title = titleInput.value.trim();
            if (!title) return;
            const colorSelect = document.getElementById('priority');
            const color = colorSelect.value;
            
            const newCard = { id: nextId++, title, color };
            state.toDo.push(newCard);
            saveState();
            render();
            titleInput.value = '';
            colorSelect.selectedIndex = 2; // Default to green
        }

        function render() {
            const lists = [
                { selector: '#to-do-list', column: 'toDo' },
                { selector: '#in-progress-list', column: 'inProgress' },
                { selector: '#done-list', column: 'done' }
            ];
            
            lists.forEach(listConfig => {
                const ul = document.querySelector(listConfig.selector);
                ul.innerHTML = '';
                const cards = state[listConfig.column];
                cards.forEach(card => {
                    const li = document.createElement('li');
                    const cardDiv = document.createElement('div');
                    cardDiv.className = `card-${card.color}`;  // Fixed class naming
                    cardDiv.draggable = true;
                    cardDiv.dataset.id = card.id.toString();
                    
                    cardDiv.innerHTML = `
                        <div class="card-content">
                            <h3>${card.title}</h3>
                            <button class="edit-btn">Edit</button>
                            <button class="delete-btn">Delete</button>
                        </div>
                    `;
                    
                    cardDiv.addEventListener('dragstart', function(e) {
                        e.dataTransfer.setData('text/plain', this.dataset.id);
                    });
                    
                    cardDiv.addEventListener('click', function(e) {
                        if (e.target.classList.contains('edit-btn')) {
                            editCard(card);
                        } else if (e.target.classList.contains('delete-btn')) {
                            deleteCard(card);
                        }
                    });
                    
                    li.appendChild(cardDiv);
                    ul.appendChild(li);
                });
                
                ul.addEventListener('drop', function(e) {
                    e.preventDefault();
                    const cardId = e.dataTransfer.getData('text/plain');
                    const card = findCardInState(state, cardId);
                    if (card) {
                        const targetColumnClass = this.closest('.column').classList[1];
                        const targetStateKey = columnMapping[targetColumnClass];
                        if (targetStateKey) {
                            moveCard(card, targetStateKey);
                        }
                    }
                });
                
                ul.addEventListener('dragover', function(e) {
                    e.preventDefault();
                    e.dataTransfer.dropEffect = 'move';
                });
            });
        }

        document.addEventListener('DOMContentLoaded', function() {
            loadState();
            document.getElementById('add-card-form').addEventListener('submit', addCard);
        });
    </script>
</body>
</html>