<!DOCTYPE html>
<html>
<head>
    <title>Expense Tracker</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .container { display: flex; flex-direction: column; }
        .form-section { margin-bottom: 20px; }
        form { display: flex; flex-direction: column; width: 100%; }
        label, input, select, textarea { margin: 5px 0; }
        textarea { width: 100%; min-height: 100px; }
        .expenses-table { border-collapse: collapse; width: 100%; margin-top: 20px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        .filter-section { margin-top: 20px; }
        .total-section { margin-top: 20px; }
        canvas { border: 1px solid #ddd; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Expense Tracker</h1>
        
        <div class="form-section">
            <form id="expenseForm">
                <label>Amount: </label>
                <input type="number" id="amount" required>
                <label>Category: </label>
                <select id="category">
                    <option value="Food">Food</option>
                    <option value="Transport">Transport</option>
                    <option value="Entertainment">Entertainment</option>
                    <option value="Bills">Bills</option>
                    <option value="Shopping">Shopping</option>
                    <option value="Other">Other</option>
                </select>
                <label>Description: </label>
                <textarea id="description" required></textarea>
                <label>Date: </label>
                <input type="date" id="date" required>
                <button type="submit">Add Expense</button>
            </form>
        </div>

        <div class="filter-section">
            <label>Filter by date:</label>
            <input type="date" id="dateFrom">
            <input type="date" id="dateTo">
            <label>Filter by category:</label>
            <select id="categoryFilter">
                <option value="All">All</option>
                <option value="Food">Food</option>
                <option value="Transport">Transport</option>
                <option value="Entertainment">Entertainment</option>
                <option value="Bills">Bills</option>
                <option value="Shopping">Shopping</option>
                <option value="Other">Other</option>
            </select>
        </div>

        <table id="expensesTable">
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Category</th>
                    <th>Description</th>
                    <th>Amount</th>
                    <th></th>
                </tr>
            </thead>
            <tbody id="expensesTableBody"></tbody>
        </table>

        <div class="total-section">
            <h3>Total Spending: $<span id="totalAmount">0</span></h3>
            <table id="categoryBreakdown">
                <thead>
                    <tr>
                        <th>Category</th>
                        <th>Amount</th>
                    </tr>
                </thead>
                <tbody id="breakdownTableBody"></tbody>
            </table>
        </div>

        <canvas id="pieChart" width="200" height="200"></canvas>
    </div>

    <script>
let expenses = [];
let filterFromDate = null;
let filterToDate = null;
let filterCategory = 'All';

const categoryColors = {
    'Food': '#ff6b6b',
    'Transport': '#4ecdc4',
    'Entertainment': '#45b7d1',
    'Bills': '#96ce93',
    'Shopping': '#f7d1b2',
    'Other': '#e74c3c'
};

function loadExpenses() {
    const savedExpenses = localStorage.getItem('expenses');
    if (savedExpenses) {
        expenses = JSON.parse(savedExpenses);
    }
}

function saveExpenses() {
    localStorage.setItem('expenses', JSON.stringify(expenses));
}

function applyFilters() {
    const fromDate = filterFromDate;
    const toDate = filterToDate;
    const category = filterCategory;

    const filtered = [];
    for (let i = 0; i < expenses.length; i++) {
        const expense = expenses[i];
        const expenseDate = new Date(expense.date);
        let matches = true;

        if (fromDate) {
            const fromDateObj = new Date(fromDate);
            if (expenseDate < fromDateObj) matches = false;
        }
        if (toDate) {
            const toDateObj = new Date(toDate);
            if (expenseDate > toDateObj) matches = false;
        }
        if (category !== 'All' && expense.category !== category) matches = false;

        if (matches) filtered.push({ expense, originalIndex: i });
    }
    return filtered;
}

function deleteExpense(index) {
    if (index < 0 || index >= expenses.length) return;
    expenses.splice(index, 1);
    saveExpenses();
    updateTable();
}

function updateTable() {
    const filteredWithIndex = applyFilters();
    const tableBody = document.getElementById('expensesTableBody');
    tableBody.innerHTML = '';

    filteredWithIndex.forEach(item => {
        const { expense, originalIndex } = item;
        const row = document.createElement('tr');
        row.innerHTML = `
            <td>${expense.date}</td>
            <td>${expense.category}</td>
            <td>${expense.description}</td>
            <td>$${expense.amount.toFixed(2)}</td>
            <td><button onclick="deleteExpense(${originalIndex})">Delete</button></td>
        `;
        tableBody.appendChild(row);
    });
    updateTotals();
    updateChart();
}

function updateTotals() {
    const filtered = applyFilters();
    const totalAmount = filtered.reduce((sum, { expense }) => sum + expense.amount, 0);
    document.getElementById('totalAmount').textContent = totalAmount.toFixed(2);

    const breakdownTableBody = document.getElementById('breakdownTableBody');
    breakdownTableBody.innerHTML = '';
    const categoryTotals = {};
    filtered.forEach(item => {
        const cat = item.expense.category;
        categoryTotals[cat] = (categoryTotals[cat] || 0) + item.expense.amount;
    });

    Object.entries(categoryTotals).forEach(([cat, total]) => {
        const row = document.createElement('tr');
        row.innerHTML = `<td>${cat}</td><td>$${total.toFixed(2)}</td>`;
        breakdownTableBody.appendChild(row);
    });
}

function updateChart() {
    const ctx = document.getElementById('pieChart').getContext('2d');
    const filtered = applyFilters();
    const categoryTotals = {};
    filtered.forEach(item => {
        const cat = item.expense.category;
        categoryTotals[cat] = (categoryTotals[cat] || 0) + item.expense.amount;
    });

    if (Object.keys(categoryTotals).length === 0) return;

    const total = Object.values(categoryTotals).reduce((a, b) => a + b, 0);
    const categories = Object.keys(categoryTotals);
    categories.sort();

    ctx.clearRect(0, 0, 200, 200);
    let startAngle = 0;
    categories.forEach(cat => {
        const angle = (categoryTotals[cat] / total) * 2 * Math.PI;
        ctx.beginPath();
        ctx.moveTo(100, 100);
        ctx.arc(100, 100, 90, startAngle, startAngle + angle);
        ctx.lineTo(100, 100);
        ctx.fillStyle = categoryColors[cat] || '#000000';
        ctx.fill();
        ctx.closePath();
        startAngle += angle;
    });
}

document.addEventListener('DOMContentLoaded', function() {
    loadExpenses();

    document.getElementById('expenseForm').addEventListener('submit', function(e) {
        e.preventDefault();
        const amountInput = document.getElementById('amount');
        const categoryInput = document.getElementById('category');
        const descriptionInput = document.getElementById('description');
        const dateInput = document.getElementById('date');

        const amount = parseFloat(amountInput.value);
        const category = categoryInput.value;
        const description = descriptionInput.value.trim();
        const date = dateInput.value;

        if (isNaN(amount) || amount <= 0 || !description) {
            alert('Please enter a valid amount and description.');
            return;
        }

        expenses.push({ amount, category, description, date });
        saveExpenses();
        updateTable();
        amountInput.value = '';
        categoryInput.value = '';
        descriptionInput.value = '';
        dateInput.value = '';
    });

    document.getElementById('dateFrom').addEventListener('change', updateTable);
    document.getElementById('dateTo').addEventListener('change', updateTable);
    document.getElementById('categoryFilter').addEventListener('change', updateTable);

    updateTable();
});
    </script>
</body>
</html>