<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Expense Tracker</title>
<style>
    :root {
        --bg: #f4f6fb;
        --card: #ffffff;
        --primary: #4f46e5;
        --text: #1f2937;
        --muted: #6b7280;
        --border: #e5e7eb;
    }
    * { box-sizing: border-box; }
    body {
        font-family: "Inter", system-ui, -apple-system, sans-serif;
        background: var(--bg);
        margin: 0;
        color: var(--text);
        line-height: 1.5;
    }
    header {
        background: linear-gradient(135deg, #4f46e5, #6366f1);
        color: #fff;
        padding: 32px 20px 40px;
        box-shadow: 0 6px 18px rgba(0,0,0,0.1);
    }
    h1 {
        margin: 0;
        font-size: 28px;
        font-weight: 700;
    }
    .container {
        max-width: 1100px;
        margin: -60px auto 40px;
        padding: 0 16px;
    }
    .grid {
        display: grid;
        gap: 16px;
    }
    .grid-2 {
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    }
    .card {
        background: var(--card);
        border-radius: 16px;
        padding: 18px 18px 14px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.08);
        border: 1px solid var(--border);
    }
    label {
        display: block;
        font-weight: 600;
        margin-bottom: 6px;
        color: var(--muted);
        font-size: 13px;
    }
    input, select, button, textarea {
        width: 100%;
        padding: 11px 12px;
        border-radius: 10px;
        border: 1px solid var(--border);
        font-size: 14px;
        transition: 0.2s ease;
        font-family: inherit;
        background: #fff;
    }
    input:focus, select:focus, textarea:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(79,70,229,0.12);
    }
    button {
        cursor: pointer;
        background: var(--primary);
        border: none;
        color: #fff;
        font-weight: 700;
        letter-spacing: 0.2px;
    }
    button.secondary {
        background: #fff;
        color: var(--text);
        border: 1px solid var(--border);
    }
    .flex {
        display: flex;
        gap: 10px;
        align-items: center;
    }
    .flex-between {
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    .expense-list {
        margin-top: 14px;
        max-height: 380px;
        overflow: auto;
    }
    .expense-item {
        border: 1px solid var(--border);
        border-radius: 12px;
        padding: 12px 12px 10px;
        margin-bottom: 10px;
        display: grid;
        grid-template-columns: 1fr auto;
        gap: 6px;
        background: #fff;
    }
    .expense-item .meta {
        color: var(--muted);
        font-size: 13px;
    }
    .badge {
        background: rgba(79,70,229,0.1);
        color: var(--primary);
        padding: 6px 10px;
        border-radius: 999px;
        font-size: 12px;
        font-weight: 700;
    }
    .amount {
        font-weight: 800;
        font-size: 16px;
        color: #111827;
    }
    .stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
        gap: 12px;
        margin-top: 12px;
    }
    .stat-card {
        background: rgba(79,70,229,0.04);
        border: 1px solid var(--border);
        padding: 14px 12px;
        border-radius: 14px;
    }
    .stat-title {
        color: var(--muted);
        font-size: 12px;
        letter-spacing: 0.3px;
        margin-bottom: 6px;
    }
    .stat-value {
        font-size: 20px;
        font-weight: 800;
    }
    canvas { width: 100%; height: 260px; }
    .filters .flex { flex-wrap: wrap; }
    .filters input, .filters select { flex: 1; min-width: 160px; }
    .empty {
        text-align: center;
        color: var(--muted);
        padding: 20px;
    }
    footer {
        text-align: center;
        color: var(--muted);
        padding-bottom: 16px;
        font-size: 13px;
    }
</style>
</head>
<body>
<header>
    <div style="max-width:1100px;margin:0 auto;">
        <h1>Expense Tracker</h1>
        <p style="margin:6px 0 0; color: rgba(255,255,255,0.85);">
            Track spending, filter by date and category, and see where your money goes.
        </p>
    </div>
</header>

<div class="container">
    <div class="grid grid-2">
        <!-- Add Expense -->
        <div class="card">
            <h3 style="margin:0 0 12px;">Add Expense</h3>
            <form id="expense-form" class="grid" style="gap:10px;">
                <div>
                    <label>Amount ($)</label>
                    <input type="number" step="0.01" min="0" required id="amount">
                </div>
                <div>
                    <label>Category</label>
                    <select id="category" required>
                        <option value="">Select category</option>
                        <option>Food</option>
                        <option>Transport</option>
                        <option>Entertainment</option>
                        <option>Bills</option>
                        <option>Shopping</option>
                        <option>Other</option>
                    </select>
                </div>
                <div>
                    <label>Description</label>
                    <textarea id="description" rows="2" placeholder="Optional"></textarea>
                </div>
                <div>
                    <label>Date</label>
                    <input type="date" id="date" required>
                </div>
                <button type="submit">Add Expense</button>
            </form>
        </div>

        <!-- Stats + Chart -->
        <div class="card">
            <div class="flex-between">
                <h3 style="margin:0;">Overview</h3>
                <button class="secondary" id="clear-all" style="width:auto;padding:8px 12px;font-size:13px;">Clear All</button>
            </div>
            <div class="stats" id="stats"></div>
            <canvas id="chart"></canvas>
        </div>
    </div>

    <div class="card filters" style="margin-top:16px;">
        <div class="flex-between" style="margin-bottom:8px;">
            <h3 style="margin:0;">Filters</h3>
            <button class="secondary" id="reset-filters" style="width:auto;padding:8px 12px;font-size:13px;">Reset</button>
        </div>
        <div class="flex" style="gap:10px;">
            <select id="filter-category">
                <option value="">All Categories</option>
                <option>Food</option>
                <option>Transport</option>
                <option>Entertainment</option>
                <option>Bills</option>
                <option>Shopping</option>
                <option>Other</option>
            </select>
            <input type="date" id="filter-from" placeholder="From">
            <input type="date" id="filter-to" placeholder="To">
            <button style="width:auto;padding:10px 14px;" id="apply-filters">Apply</button>
        </div>
    </div>

    <div class="card">
        <div class="flex-between">
            <h3 style="margin:0;">Expenses</h3>
            <div id="count" class="muted"></div>
        </div>
        <div id="expense-list" class="expense-list"></div>
    </div>
</div>

<footer>Data saved in your browser (localStorage)</footer>

<script>
(function(){
    const STORAGE_KEY = 'expense-tracker-data-v1';
    const categories = ['Food','Transport','Entertainment','Bills','Shopping','Other'];
    const form = document.getElementById('expense-form');
    const amountEl = document.getElementById('amount');
    const categoryEl = document.getElementById('category');
    const descEl = document.getElementById('description');
    const dateEl = document.getElementById('date');
    const listEl = document.getElementById('expense-list');
    const statsEl = document.getElementById('stats');
    const chartEl = document.getElementById('chart');
    const countEl = document.getElementById('count');
    const filterCategory = document.getElementById('filter-category');
    const filterFrom = document.getElementById('filter-from');
    const filterTo = document.getElementById('filter-to');
    const applyBtn = document.getElementById('apply-filters');
    const resetFiltersBtn = document.getElementById('reset-filters');
    const clearAllBtn = document.getElementById('clear-all');

    let expenses = loadData();
    let filters = { category:'', from:'', to:'' };

    init();

    function init(){
        // set default date
        dateEl.value = new Date().toISOString().slice(0,10);
        render();
    }

    form.addEventListener('submit', e=>{
        e.preventDefault();
        const amount = parseFloat(amountEl.value);
        if(isNaN(amount) || amount <= 0){
            alert('Please enter a valid amount');
            return;
        }
        const category = categoryEl.value;
        const description = descEl.value.trim();
        const date = dateEl.value;
        if(!category || !date){
            alert('Category and date are required');
            return;
        }
        const item = {
            id: Date.now(),
            amount,
            category,
            description,
            date
        };
        expenses.push(item);
        saveData();
        form.reset();
        dateEl.value = new Date().toISOString().slice(0,10);
        render();
    });

    applyBtn.addEventListener('click', ()=>{
        filters.category = filterCategory.value;
        filters.from = filterFrom.value;
        filters.to = filterTo.value;
        render();
    });

    resetFiltersBtn.addEventListener('click', ()=>{
        filters = {category:'', from:'', to:''};
        filterCategory.value = '';
        filterFrom.value = '';
        filterTo.value = '';
        render();
    });

    clearAllBtn.addEventListener('click', ()=>{
        if(!expenses.length) return;
        if(confirm('Clear all expenses?')){
            expenses = [];
            saveData();
            render();
        }
    });

    function loadData(){
        try{
            const raw = localStorage.getItem(STORAGE_KEY);
            return raw ? JSON.parse(raw) : [];
        }catch(err){
            console.error(err);
            return [];
        }
    }

    function saveData(){
        localStorage.setItem(STORAGE_KEY, JSON.stringify(expenses));
    }

    function applyFilters(items){
        return items.filter(item=>{
            if(filters.category && item.category !== filters.category) return false;
            if(filters.from && item.date < filters.from) return false;
            if(filters.to && item.date > filters.to) return false;
            return true;
        });
    }

    function render(){
        const filtered = applyFilters(expenses);
        renderList(filtered);
        renderStats(filtered);
        renderChart(filtered);
    }

    function renderList(items){
        listEl.innerHTML = '';
        countEl.textContent = items.length ? `${items.length} item(s)` : '';
        if(!items.length){
            listEl.innerHTML = `<div class="empty">No expenses yet</div>`;
            return;
        }
        // sort by date desc then id desc
        items.slice().sort((a,b)=>{
            if(a.date === b.date) return b.id - a.id;
            return a.date < b.date ? 1 : -1;
        }).forEach(item=>{
            const div = document.createElement('div');
            div.className = 'expense-item';
            const desc = item.description ? `<div>${escapeHtml(item.description)}</div>` : '';
            div.innerHTML = `
                <div>
                    <div class="flex" style="gap:8px;align-items:center;">
                        <span class="badge">${item.category}</span>
                        <span class="amount">$${item.amount.toFixed(2)}</span>
                    </div>
                    ${desc}
                    <div class="meta">${item.date}</div>
                </div>
                <div class="flex" style="justify-content:flex-end; align-self:center; gap:6px;">
                    <button class="secondary" style="padding:6px 8px;width:auto;font-size:12px;" data-id="${item.id}" onclick="deleteExpense(${item.id})">Delete</button>
                </div>
            `;
            listEl.appendChild(div);
        });
    }

    window.deleteExpense = function(id){
        if(!confirm('Delete this expense?')) return;
        expenses = expenses.filter(e=>e.id !== id);
        saveData();
        render();
    }

    function renderStats(items){
        const total = items.reduce((sum,x)=>sum + x.amount, 0);
        const byCat = {};
        categories.forEach(c=>byCat[c]=0);
        items.forEach(i=>{ byCat[i.category] = (byCat[i.category]||0) + i.amount; });
        statsEl.innerHTML = `
            <div class="stat-card">
                <div class="stat-title">Total Spend</div>
                <div class="stat-value">$${total.toFixed(2)}</div>
            </div>
            ${categories.map(cat=>{
                const val = byCat[cat]||0;
                return `<div class="stat-card">
                    <div class="stat-title">${cat}</div>
                    <div class="stat-value">$${val.toFixed(2)}</div>
                </div>`
            }).join('')}
        `;
    }

    function renderChart(items){
        const ctx = chartEl.getContext('2d');
        const width = chartEl.width = chartEl.clientWidth;
        const height = chartEl.height = 260;
        ctx.clearRect(0,0,width,height);
        const byCat = categories.map(cat=>{
            return {cat, amount: items.filter(i=>i.category===cat).reduce((s,x)=>s+x.amount,0)}
        }).filter(x=>x.amount>0);
        const total = byCat.reduce((s,x)=>s+x.amount,0);
        if(total === 0){
            ctx.fillStyle = '#9ca3af';
            ctx.font = '14px sans-serif';
            ctx.fillText('Add expenses to see chart', 14, 30);
            return;
        }
        const colors = ['#4f46e5','#22c55e','#f97316','#10b981','#ef4444','#a855f7'];
        let start = -Math.PI/2;
        byCat.forEach((entry, idx)=>{
            const slice = entry.amount / total * Math.PI*2;
            ctx.beginPath();
            ctx.moveTo(width/2, height/2);
            ctx.arc(width/2, height/2, Math.min(width,height)/2 - 20, start, start+slice);
            ctx.fillStyle = colors[idx % colors.length];
            ctx.fill();
            start += slice;
        });
        // legend
        const legendX = 14, legendY = 14;
        ctx.font = '13px sans-serif';
        byCat.forEach((entry, idx)=>{
            ctx.fillStyle = colors[idx % colors.length];
            ctx.fillRect(legendX, legendY + idx*22, 14, 14);
            ctx.fillStyle = '#111827';
            const perc = (entry.amount/total*100).toFixed(1);
            ctx.fillText(`${entry.cat} - $${entry.amount.toFixed(2)} (${perc}%)`, legendX + 20, legendY + 11 + idx*22);
        });
    }

    function escapeHtml(str){
        return str.replace(/[&<>"']/g, c => ({
            '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'
        }[c]));
    }
})();
</script>
</body>
</html>