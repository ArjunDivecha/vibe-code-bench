<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vibe-Law | Legal Intelligence Workspace</title>
    <style>
        :root {
            --bg-dark: #0f172a;
            --bg-card: #1e293b;
            --accent: #38bdf8;
            --accent-hover: #0ea5e9;
            --text-main: #f1f5f9;
            --text-dim: #94a3b8;
            --border: #334155;
            --highlight: #fbbf24;
            --sidebar-w: 350px;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; }

        body {
            background-color: var(--bg-dark);
            color: var(--text-main);
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* Header */
        header {
            padding: 1rem 2rem;
            background: #020617;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 800;
            letter-spacing: -1px;
            color: var(--accent);
        }

        .search-container {
            flex: 1;
            max-width: 600px;
            margin: 0 2rem;
            position: relative;
        }

        #search-input {
            width: 100%;
            padding: 0.75rem 1rem;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: white;
            outline: none;
        }

        #search-input:focus { border-color: var(--accent); }

        /* Main Workspace */
        main {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        /* Results List */
        #results-pane {
            width: 40%;
            min-width: 400px;
            border-right: 1px solid var(--border);
            overflow-y: auto;
            background: #0f172a;
        }

        .case-card {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border);
            cursor: pointer;
            transition: background 0.2s;
        }

        .case-card:hover { background: #1e293b; }
        .case-card.active { background: #1e293b; border-left: 4px solid var(--accent); }

        .case-meta { font-size: 0.75rem; color: var(--accent); text-transform: uppercase; margin-bottom: 0.5rem; }
        .case-title { font-size: 1.1rem; font-weight: 600; margin-bottom: 0.5rem; line-height: 1.3; }
        .case-snippet { font-size: 0.85rem; color: var(--text-dim); display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }

        /* Detail View */
        #detail-pane {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: #020617;
            position: relative;
        }

        .tabs {
            display: flex;
            background: #1e293b;
            padding: 0 1rem;
            border-bottom: 1px solid var(--border);
        }

        .tab {
            padding: 1rem 1.5rem;
            cursor: pointer;
            font-size: 0.9rem;
            border-bottom: 2px solid transparent;
            color: var(--text-dim);
        }

        .tab.active {
            color: var(--accent);
            border-bottom-color: var(--accent);
        }

        .detail-content {
            flex: 1;
            padding: 2rem;
            overflow-y: auto;
            line-height: 1.6;
        }

        .detail-actions {
            padding: 1rem 2rem;
            border-bottom: 1px solid var(--border);
            display: flex;
            gap: 1rem;
        }

        button {
            padding: 0.5rem 1rem;
            background: var(--bg-card);
            border: 1px solid var(--border);
            color: white;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.85rem;
        }

        button:hover { background: var(--border); }
        button.primary { background: var(--accent); border-color: var(--accent); color: #020617; font-weight: 600; }

        .entity-date { background: rgba(56, 189, 248, 0.2); border-bottom: 2px solid var(--accent); }
        .entity-name { background: rgba(251, 191, 36, 0.2); border-bottom: 2px solid var(--highlight); }

        /* Notes Sidebar */
        #notes-pane {
            width: var(--sidebar-w);
            border-left: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            background: #0f172a;
        }

        .notes-header { padding: 1rem; font-weight: bold; border-bottom: 1px solid var(--border); font-size: 0.8rem; text-transform: uppercase; }
        #notes-list { flex: 1; overflow-y: auto; padding: 1rem; }
        .note-item {
            background: var(--bg-card);
            padding: 0.75rem;
            border-radius: 4px;
            margin-bottom: 1rem;
            font-size: 0.85rem;
            position: relative;
        }
        .note-item .delete-note { position: absolute; top: 5px; right: 5px; color: var(--text-dim); cursor: pointer; }

        .empty-state {
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-dim);
            flex-direction: column;
            text-align: center;
            padding: 2rem;
        }

        /* Selection Context Menu */
        #selection-popover {
            position: fixed;
            background: var(--accent);
            color: #000;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            display: none;
            z-index: 1000;
        }
    </style>
</head>
<body>

<header>
    <div class="logo">VIBE-LAW</div>
    <div class="search-container">
        <input type="text" id="search-input" placeholder="Search precedents, case numbers, or parties...">
    </div>
    <div style="font-size: 0.8rem; color: var(--text-dim)">Workspace v2.4.0</div>
</header>

<main>
    <div id="results-pane">
        <!-- Results injected here -->
    </div>

    <div id="detail-pane">
        <div id="no-selection" class="empty-state">
            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>
            <p style="margin-top: 1rem;">Select a case from the list to view details</p>
        </div>

        <div id="case-viewer" style="display: none; height: 100%; flex-direction: column;">
            <div class="detail-actions">
                <button class="primary" onclick="extractEntities()">Extract Entities</button>
                <button onclick="window.print()">Export PDF</button>
                <span style="flex: 1"></span>
                <span id="case-id-badge" style="color: var(--text-dim); font-family: monospace; font-size: 0.8rem; align-self: center;"></span>
            </div>
            <div class="tabs">
                <div class="tab active" onclick="switchTab('summary')">Case Summary</div>
                <div class="tab" onclick="switchTab('fulltext')">Full Opinion</div>
            </div>
            <div id="content-area" class="detail-content">
                <!-- Content injected here -->
            </div>
        </div>
    </div>

    <div id="notes-pane">
        <div class="notes-header">Research Clippings</div>
        <div id="notes-list">
            <!-- Notes injected here -->
        </div>
        <div style="padding: 1rem; font-size: 0.7rem; color: var(--text-dim); border-top: 1px solid var(--border);">
            Highlight text in the opinion to "Save to Notes".
        </div>
    </div>
</main>

<div id="selection-popover">SAVE TO NOTES</div>

<script>
    // Mock Data
    const MOCK_CASES = [
        {
            id: "2023-US-442",
            title: "Global Tech Corp v. Decentralized Systems LLC",
            court: "U.S. District Court, N.D. Cal.",
            date: "Oct 14, 2023",
            summary: "A landmark dispute over smart contract liability. The court examined whether code-as-law principles supersede traditional contract statutes in multi-jurisdictional digital agreements. The defendant argued that the autonomous nature of the contract absolved them of manual oversight obligations.",
            fulltext: "Justice Miller delivered the opinion of the Court. In this matter, Global Tech Corp (Plaintiff) alleges that Decentralized Systems LLC (Defendant) breached a fiduciary duty when a liquidity pool drain occurred on January 15, 2023. The central question is whether a software developer is liable for 'exploits' that are mathematically possible within the code. Historically, under the Securities Act of 1933, we look at the 'economic reality' of the transaction. On March 12, 2023, the parties met to discuss mediation but failed to reach an agreement...",
            entities: { names: ["Global Tech Corp", "Decentralized Systems LLC", "Justice Miller"], dates: ["January 15, 2023", "March 12, 2023", "1933"] }
        },
        {
            id: "2022-NY-881",
            title: "Estate of Sterling v. Art-Block Foundation",
            court: "Southern District of New York",
            date: "May 22, 2022",
            summary: "Copyright infringement regarding AI-generated derivatives of physical sculptures. The court ruled on the 'human authorship' requirement for federal copyright protection.",
            fulltext: "The plaintiff, Estate of Sterling, seeks a permanent injunction against Art-Block Foundation. The dispute began on July 04, 2021, when the Foundation released 10,000 algorithmic variations of Sterling's 1984 'Bronze Silence' series. We must determine if the transformation is sufficiently 'original' under the Copyright Act. Judge Sarah Vance noted that the AI model was trained on proprietary data without consent.",
            entities: { names: ["Estate of Sterling", "Art-Block Foundation", "Judge Sarah Vance", "Sterling"], dates: ["July 04, 2021", "1984"] }
        },
        {
            id: "2023-TX-102",
            title: "State of Texas v. SolarGrid Solutions",
            court: "Texas Supreme Court",
            date: "Jan 05, 2023",
            summary: "Liability for energy grid failure during the 2021 winter storm. Focuses on the 'Act of God' defense in utility infrastructure contracts.",
            fulltext: "During the catastrophic weather event of February 2021, SolarGrid Solutions failed to provide the minimum required wattage to the Houston metro area. The State of Texas brought suit on August 10, 2021. The Defendant claims the freeze was an unforeseeable force majeure. However, evidence shows that on November 12, 2019, a risk assessment report warned of these exact vulnerabilities.",
            entities: { names: ["SolarGrid Solutions", "State of Texas"], dates: ["February 2021", "August 10, 2021", "November 12, 2019"] }
        },
        {
            id: "2023-FED-99",
            title: "United States v. Thorne Intelligence",
            court: "D.C. Circuit Court of Appeals",
            date: "Dec 12, 2023",
            summary: "Privacy rights and bulk data collection by private contractors for federal agencies. Interpretation of the Fourth Amendment in the age of predictive analytics.",
            fulltext: "This appeal arises from a motion to suppress evidence gathered via Thorne Intelligence's 'EagleEye' algorithm. On September 30, 2022, federal agents utilized the software to track movements across three states. The Fourth Amendment protects citizens from unreasonable searches. Chief Judge Harold Finch delivered the dissent, arguing that digital footprints have no expectation of privacy.",
            entities: { names: ["Thorne Intelligence", "Harold Finch"], dates: ["September 30, 2022"] }
        }
    ];

    // State Management
    let currentCase = null;
    let currentTab = 'summary';
    let notes = JSON.parse(localStorage.getItem('vibelaw_notes') || '[]');

    // DOM Elements
    const resultsPane = document.getElementById('results-pane');
    const searchInput = document.getElementById('search-input');
    const caseViewer = document.getElementById('case-viewer');
    const noSelection = document.getElementById('no-selection');
    const contentArea = document.getElementById('content-area');
    const notesList = document.getElementById('notes-list');
    const popover = document.getElementById('selection-popover');

    // Initialize
    function init() {
        renderResults(MOCK_CASES);
        renderNotes();
        
        searchInput.addEventListener('input', (e) => {
            const term = e.target.value.toLowerCase();
            const filtered = MOCK_CASES.filter(c => 
                c.title.toLowerCase().includes(term) || 
                c.summary.toLowerCase().includes(term) ||
                c.id.toLowerCase().includes(term)
            );
            renderResults(filtered);
        });

        // Text Selection Logic
        contentArea.addEventListener('mouseup', handleSelection);
        popover.addEventListener('click', saveSelectedNote);
    }

    function renderResults(cases) {
        resultsPane.innerHTML = cases.map(c => `
            <div class="case-card ${currentCase?.id === c.id ? 'active' : ''}" onclick="selectCase('${c.id}')">
                <div class="case-meta">${c.court} â€¢ ${c.date}</div>
                <div class="case-title">${c.title}</div>
                <div class="case-snippet">${c.summary}</div>
            </div>
        `).join('');
    }

    function selectCase(id) {
        currentCase = MOCK_CASES.find(c => c.id === id);
        noSelection.style.display = 'none';
        caseViewer.style.display = 'flex';
        document.getElementById('case-id-badge').innerText = currentCase.id;
        renderResults(MOCK_CASES); // Refresh active state
        switchTab('summary');
    }

    function switchTab(tab) {
        currentTab = tab;
        document.querySelectorAll('.tab').forEach(t => {
            t.classList.toggle('active', t.innerText.toLowerCase().includes(tab));
        });
        
        if (tab === 'summary') {
            contentArea.innerHTML = `<h3>Executive Summary</h3><p style="margin-top:1rem">${currentCase.summary}</p>`;
        } else {
            contentArea.innerHTML = `<h3>Opinion of the Court</h3><p style="margin-top:1rem; white-space: pre-wrap;">${currentCase.fulltext}</p>`;
        }
    }

    function extractEntities() {
        if (currentTab !== 'fulltext') switchTab('fulltext');
        
        let text = currentCase.fulltext;
        
        // Simple regex-based highlighting for simulation
        currentCase.entities.names.forEach(name => {
            const reg = new RegExp(`(${name})`, 'gi');
            text = text.replace(reg, `<span class="entity-name">$1</span>`);
        });
        
        currentCase.entities.dates.forEach(date => {
            const reg = new RegExp(`(${date})`, 'gi');
            text = text.replace(reg, `<span class="entity-date">$1</span>`);
        });

        contentArea.innerHTML = `<h3>Opinion of the Court (Analyzed)</h3><p style="margin-top:1rem; white-space: pre-wrap;">${text}</p>`;
    }

    // Notes Functionality
    function handleSelection(e) {
        const selection = window.getSelection();
        const text = selection.toString().trim();
        
        if (text && text.length > 5) {
            popover.style.display = 'block';
            popover.style.left = `${e.pageX}px`;
            popover.style.top = `${e.pageY - 40}px`;
            popover._selectedText = text;
        } else {
            popover.style.display = 'none';
        }
    }

    function saveSelectedNote() {
        const text = popover._selectedText;
        if (!text) return;

        const note = {
            id: Date.now(),
            caseTitle: currentCase.title,
            text: text
        };

        notes.unshift(note);
        localStorage.setItem('vibelaw_notes', JSON.stringify(notes));
        renderNotes();
        popover.style.display = 'none';
        window.getSelection().removeAllRanges();
    }

    function renderNotes() {
        if (notes.length === 0) {
            notesList.innerHTML = '<div style="color:var(--text-dim); font-size:0.8rem;">No saved clippings yet.</div>';
            return;
        }
        notesList.innerHTML = notes.map(n => `
            <div class="note-item">
                <span class="delete-note" onclick="deleteNote(${n.id})">&times;</span>
                <div style="font-size: 0.7rem; color: var(--accent); margin-bottom: 4px;">${n.caseTitle}</div>
                "${n.text}"
            </div>
        `).join('');
    }

    function deleteNote(id) {
        notes = notes.filter(n => n.id !== id);
        localStorage.setItem('vibelaw_notes', JSON.stringify(notes));
        renderNotes();
    }

    init();
</script>

</body>
</html>